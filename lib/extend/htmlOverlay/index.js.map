{"version":3,"file":"index.js","sources":["src/components/extend/htmlOverlay/VcHTMLOverlay.vue?rollup-plugin-vue=script.js","src/components/extend/htmlOverlay/VcHTMLOverlay.vue","src/components/extend/htmlOverlay/index.js"],"sourcesContent":["//\n//\n//\n//\n//\n//\n\nimport cmp from '../../../mixins/virtualCmp'\nimport { pixelOffset, position } from '../../../mixins/mixinProps'\nimport { makeCartesian2, makeCartesian3 } from '../../../utils/cesiumHelpers'\nexport default {\n  name: 'vc-overlay-html',\n  mixins: [cmp, pixelOffset, position],\n  props: {\n    hiddenOnBack: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data () {\n    return {\n      // nowaiting: true,\n      canRender: false\n    }\n  },\n  methods: {\n    async createCesiumObject () {\n      return this.$el\n    },\n    async mount () {\n      const { viewer, onPreRender } = this\n      viewer.scene.preRender.addEventListener(onPreRender)\n      this.canRender = true\n      return true\n    },\n    async unmount () {\n      const { viewer, onPreRender } = this\n      viewer.scene.preRender.removeEventListener(onPreRender)\n      this.canRender = false\n      return true\n    },\n    onPreRender () {\n      const { viewer, position, pixelOffset, hiddenOnBack } = this\n      const cartesian2 = makeCartesian2(pixelOffset)\n      const cartesian3 = makeCartesian3(position)\n      const scratch = {}\n      const canvasPosition = viewer.scene.cartesianToCanvasCoordinates(cartesian3, scratch)\n      if (Cesium.defined(canvasPosition)) {\n        this.$el.style.left = canvasPosition.x + cartesian2.x + 'px'\n        this.$el.style.top = canvasPosition.y + cartesian2.y + 'px'\n\n        if (hiddenOnBack) {\n          const cameraPosition = viewer.camera.position\n          const cartographicPosition = viewer.scene.globe.ellipsoid.cartesianToCartographic(cameraPosition)\n          if (Cesium.defined(cartographicPosition)) {\n            let cameraHeight = cartographicPosition.height\n            cameraHeight += 1 * viewer.scene.globe.ellipsoid.maximumRadius\n            if (Cesium.Cartesian3.distance(cameraPosition, cartesian3) > cameraHeight) {\n              this.$el.style.display = 'none'\n            } else {\n              this.$el.style.display = 'block'\n            }\n          }\n        } else {\n          this.$el.style.display = 'block'\n        }\n      }\n    },\n    onClick (e) {\n      const listener = this.$listeners.click\n      listener && this.$emit('click', e)\n    }\n  },\n  created () {\n    Object.defineProperties(this, {\n      element: {\n        enumerable: true,\n        get: () => this.cesiumObject\n      }\n    })\n  }\n}\n","<template>\n  <div @click=\"onClick\" class=\"vc-html-container\" v-if=\"canRender\">\n    <slot></slot>\n  </div>\n</template>\n\n<script>\nimport cmp from '../../../mixins/virtualCmp'\nimport { pixelOffset, position } from '../../../mixins/mixinProps'\nimport { makeCartesian2, makeCartesian3 } from '../../../utils/cesiumHelpers'\nexport default {\n  name: 'vc-overlay-html',\n  mixins: [cmp, pixelOffset, position],\n  props: {\n    hiddenOnBack: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data () {\n    return {\n      // nowaiting: true,\n      canRender: false\n    }\n  },\n  methods: {\n    async createCesiumObject () {\n      return this.$el\n    },\n    async mount () {\n      const { viewer, onPreRender } = this\n      viewer.scene.preRender.addEventListener(onPreRender)\n      this.canRender = true\n      return true\n    },\n    async unmount () {\n      const { viewer, onPreRender } = this\n      viewer.scene.preRender.removeEventListener(onPreRender)\n      this.canRender = false\n      return true\n    },\n    onPreRender () {\n      const { viewer, position, pixelOffset, hiddenOnBack } = this\n      const cartesian2 = makeCartesian2(pixelOffset)\n      const cartesian3 = makeCartesian3(position)\n      const scratch = {}\n      const canvasPosition = viewer.scene.cartesianToCanvasCoordinates(cartesian3, scratch)\n      if (Cesium.defined(canvasPosition)) {\n        this.$el.style.left = canvasPosition.x + cartesian2.x + 'px'\n        this.$el.style.top = canvasPosition.y + cartesian2.y + 'px'\n\n        if (hiddenOnBack) {\n          const cameraPosition = viewer.camera.position\n          const cartographicPosition = viewer.scene.globe.ellipsoid.cartesianToCartographic(cameraPosition)\n          if (Cesium.defined(cartographicPosition)) {\n            let cameraHeight = cartographicPosition.height\n            cameraHeight += 1 * viewer.scene.globe.ellipsoid.maximumRadius\n            if (Cesium.Cartesian3.distance(cameraPosition, cartesian3) > cameraHeight) {\n              this.$el.style.display = 'none'\n            } else {\n              this.$el.style.display = 'block'\n            }\n          }\n        } else {\n          this.$el.style.display = 'block'\n        }\n      }\n    },\n    onClick (e) {\n      const listener = this.$listeners.click\n      listener && this.$emit('click', e)\n    }\n  },\n  created () {\n    Object.defineProperties(this, {\n      element: {\n        enumerable: true,\n        get: () => this.cesiumObject\n      }\n    })\n  }\n}\n</script>\n","import VcHTMLOverlay from './VcHTMLOverlay.vue'\n\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  plugin.installed = true\n\n  Vue.component(VcHTMLOverlay.name, VcHTMLOverlay)\n}\n\nexport default plugin\n\nexport {\n  VcHTMLOverlay,\n  plugin as install\n}\n"],"names":["name","mixins","cmp","pixelOffset","position","props","hiddenOnBack","type","Boolean","default","data","canRender","methods","createCesiumObject","$el","mount","viewer","onPreRender","scene","preRender","addEventListener","unmount","removeEventListener","cartesian2","makeCartesian2","cartesian3","makeCartesian3","scratch","canvasPosition","cartesianToCanvasCoordinates","Cesium","defined","style","left","x","top","y","cameraPosition","camera","cartographicPosition","globe","ellipsoid","cartesianToCartographic","cameraHeight","height","maximumRadius","Cartesian3","distance","display","onClick","e","listener","$listeners","click","$emit","created","Object","defineProperties","element","enumerable","get","cesiumObject","plugin","Vue","installed","component","VcHTMLOverlay"],"mappings":"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"}