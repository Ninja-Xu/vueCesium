{"version":3,"file":"BaiduMapImageryProvider.js","sources":["src/exts/imageryProvider/BaiduMapImageryProvider.js"],"sourcesContent":["import BaiduMapMercatorTilingScheme from './BaiduMapTilingScheme'\n\nclass BaiduMapImageryProvider {\n  constructor (options) {\n    const { Resource, defaultValue, Credit, when, Event } = Cesium\n    this._url = options.url || `${options.protocol}://{s}.map.bdimg.com/onlinelabel/?qt=tile&styles=pl&x={x}&y={y}&z={z}`\n    const resource = Resource.createIfNeeded(this._url)\n    resource.appendForwardSlash()\n\n    this._ready = false\n    this._resource = resource\n    this._tileDiscardPolicy = options.tileDiscardPolicy\n    this._tileWidth = 256\n    this._tileHeight = 256\n    this._minimumLevel = options.maximumLevel || 0\n    this._maximumLevel = options.maximumLevel || 18\n    this._tilingScheme = new BaiduMapMercatorTilingScheme(options)\n    this._rectangle = defaultValue(options.rectangle, this._tilingScheme.rectangle)\n    let credit = options.credit\n    if (typeof credit === 'string') {\n      credit = new Credit(credit)\n    }\n    this._credit = credit\n    this.enablePickFeatures = defaultValue(options.enablePickFeatures, false)\n    this._hasAlphaChannel = defaultValue(options.hasAlphaChannel, true)\n    this._subdomains = defaultValue(options.subdomains, ['online0', 'online1', 'online2', 'online3', 'online4', 'online5', 'online6', 'online7', 'online8', 'online9'])\n    this._errorEvent = new Event()\n    this._readyPromise = when.defer()\n    this._ready = true\n    this._readyPromise.resolve(true)\n  }\n\n  get url () {\n    return this._resource._url\n  }\n\n  get proxy () {\n    return this._resource.proxy\n  }\n\n  get tileWidth () {\n    if (!this._ready) {\n      throw new Cesium.DeveloperError('tileWidth must not be called before the imagery provider is ready.')\n    }\n    return this._tileWidth\n  }\n\n  get tileHeight () {\n    if (!this._ready) {\n      throw new Cesium.DeveloperError('tileHeight must not be called before the imagery provider is ready.')\n    }\n    return this._tileHeight\n  }\n\n  get maximumLevel () {\n    if (!this._ready) {\n      throw new Cesium.DeveloperError('maximumLevel must not be called before the imagery provider is ready.')\n    }\n    return this._maximumLevel\n  }\n\n  get minimumLevel () {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError('minimumLevel must not be called before the imagery provider is ready.')\n    }\n    return this._minimumLevel\n  }\n\n  get tilingScheme () {\n    if (!this._ready) {\n      throw new Cesium.DeveloperError('tilingScheme must not be called before the imagery provider is ready.')\n    }\n    return this._tilingScheme\n  }\n\n  get rectangle () {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError('rectangle must not be called before the imagery provider is ready.')\n    }\n    return this._rectangle\n  }\n\n  get tileDiscardPolicy () {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError(\n        'tileDiscardPolicy must not be called before the imagery provider is ready.'\n      )\n    }\n    return this._tileDiscardPolicy\n  }\n\n  get errorEvent () {\n    return this._errorEvent\n  }\n\n  get ready () {\n    return this._ready\n  }\n\n  get readyPromise () {\n    return this._readyPromise.promise\n  }\n\n  get credit () {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError(\n        'credit must not be called before the imagery provider is ready.'\n      )\n    }\n    return this._credit\n  }\n\n  get hasAlphaChannel () {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError(\n        'hasAlphaChannel must not be called before the imagery provider is ready.'\n      )\n    }\n    return this._hasAlphaChannel\n  }\n\n  getTileCredits (x, y, level) {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError(\n        'getTileCredits must not be called before the imagery provider is ready.'\n      )\n    }\n    return undefined\n  }\n\n  requestImage (x, y, level, request) {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError(\n        'requestImage must not be called before the imagery provider is ready.'\n      )\n    }\n    return Cesium.ImageryProvider.loadImage(\n      this,\n      buildImageResource.call(this, x, y, level, request)\n    )\n  }\n}\n\nfunction buildImageResource (x, y, level, request) {\n  let url = this._url\n  const subdomains = this._subdomains\n  url = url.replace('{s}', subdomains[(x + y + level) % subdomains.length]).replace('{x}', x).replace('{y}', -y).replace('{z}', level)\n  const resource = this._resource.getDerivedResource({\n    url: url,\n    request: request\n  })\n  return resource\n}\n\nexport default BaiduMapImageryProvider\n"],"names":["BaiduMapImageryProvider","options","Cesium","Resource","defaultValue","Credit","when","Event","_url","url","protocol","resource","createIfNeeded","appendForwardSlash","_ready","_resource","_tileDiscardPolicy","tileDiscardPolicy","_tileWidth","_tileHeight","_minimumLevel","maximumLevel","_maximumLevel","_tilingScheme","BaiduMapMercatorTilingScheme","_rectangle","rectangle","credit","_credit","enablePickFeatures","_hasAlphaChannel","hasAlphaChannel","_subdomains","subdomains","_errorEvent","_readyPromise","defer","resolve","proxy","DeveloperError","ready","promise","x","y","level","undefined","request","ImageryProvider","loadImage","buildImageResource","call","replace","length","getDerivedResource"],"mappings":"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"}