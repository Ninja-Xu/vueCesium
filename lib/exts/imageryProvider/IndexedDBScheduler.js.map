{"version":3,"file":"IndexedDBScheduler.js","sources":["src/exts/imageryProvider/IndexedDBScheduler.js"],"sourcesContent":["/**\n * 操作状态。\n */\nconst Status = {\n  NONE: 0,\n  STORING: 1,\n  STORED: 2,\n  FAILED: 3\n}\n/**\n * 操作浏览器数据库 IndexedDB 类\n */\nclass IndexedDBScheduler {\n  /**\n   *\n   * @param {Object} options\n   */\n  constructor (options) {\n    if (!Cesium.defined(options.name)) {\n      throw new Cesium.DeveloperError('options.name is required.')\n    }\n    const deferred = Cesium.when.defer()\n    this.dbname = options.name\n    const dbRequest = window.indexedDB.open(this.dbname)\n    const that = this\n    dbRequest.onsuccess = event => {\n      that.db = event.target.result\n      that.version = that.db.version\n      that.cachestatus = that.cachestatus || {}\n      deferred.resolve(that)\n    }\n    dbRequest.onupgradeneeded = event => {\n      that.db = event.target.result\n      that.version = that.db.version\n      deferred.resolve(that)\n    }\n    dbRequest.onerror = event => {\n      that.db = null\n      deferred.reject('create database fail, error code : ' + event.target.errorcode)\n    }\n    this.layer = options.layer || null\n    this.storageType = options.storageType || 'arrayBuffer'\n    this.creatingTable = !1\n    this.cachestatus = {}\n    return deferred.promise\n  }\n\n  /**\n   * 检查对象仓库是否存在。\n   * @param {String} storeName 对象仓库（表）名称\n   */\n  checkObjectStoreExist (storeName) {\n    return Cesium.defined(this.db) ? this.db.objectStoreNames.contains(storeName) : false\n  }\n\n  /**\n  *  创建 IndexedDB 浏对象仓库，IndexedDB 是浏览器提供的本地数据库\n  * @param {String} storeName 对象仓库（表）名称\n  * @returns {Promise}\n  */\n  createObjectStore (storeName) {\n    const deferred = Cesium.when.defer()\n    if (this.creatingTable) {\n      deferred.reject(false)\n    } else {\n      if (this.db.objectStoreNames.contains(storeName)) {\n        deferred.reject(false)\n        return deferred.promise\n      }\n      this.creatingTable = true\n      const version = parseInt(this.db.version)\n      this.db.close()\n      const that = this\n      // 打开或新建 IndexedDB 数据库\n      const dbRequest = window.indexedDB.open(this.dbname, version + 1)\n      dbRequest.onupgradeneeded = event => {\n        const db = event.target.result\n        that.db = db\n        // 创建对象仓库（表）\n        const objectStore = db.createObjectStore(storeName, {\n          keyPath: 'id'\n        })\n        if (Cesium.defined(objectStore)) {\n          // 创建索引\n          objectStore.createIndex('value', 'value', {\n            unique: false\n          })\n          that.creatingTable = false\n          that.cachestatus = that.cachestatus || {}\n          that.cachestatus[storeName] = {}\n          that.db.close()\n          const dbRequest = window.indexedDB.open(that.dbname)\n          dbRequest.onsuccess = event => {\n            that.db = event.target.result\n            deferred.resolve(true)\n          }\n        } else {\n          that.creatingTable = false\n          deferred.resolve(false)\n        }\n      }\n      dbRequest.onsuccess = event => {\n        event.target.result.close()\n        deferred.resolve(true)\n      }\n      dbRequest.onerror = event => {\n        that.creatingTable = false\n        deferred.reject(false)\n      }\n    }\n    return deferred.promise\n  }\n\n  /**\n   * 向对象仓库写入数据记录。\n   * @param {String} storeName 对象仓库（表）名称\n   * @param {Number} id 主键\n   * @param {*} value 值\n   * @returns {Promise}\n   */\n  putElementInDB (storeName, id, value) {\n    const deferred = Cesium.when.defer()\n    if (!Cesium.defined(this.db)) {\n      deferred.reject(false)\n      return deferred.promise\n    }\n    const { cachestatus, db } = this\n    if (Cesium.defined(cachestatus[storeName]) && Cesium.defined(cachestatus[storeName][id] &&\n      (cachestatus[storeName][id] === Status.STORING || cachestatus[storeName][id] === Status.STORED))) {\n      deferred.resolve(false)\n      return deferred.promise\n    }\n    if (db.objectStoreNames.contains(storeName)) {\n      cachestatus[storeName] = cachestatus[storeName] || {}\n      try {\n        const request = db.transaction([storeName], 'readwrite').objectStore(storeName).add({\n          id: id,\n          value: value\n        })\n        cachestatus[storeName][id] = Status.STORING\n        request.onsuccess = event => {\n          cachestatus[storeName][id] = Status.STORED\n          deferred.resolve(true)\n        }\n        request.onerror = event => {\n          cachestatus[storeName][id] = Status.FAILED\n          deferred.resolve(false)\n        }\n      } catch (error) {\n        deferred.reject(null)\n        return deferred.promise\n      }\n    } else {\n      this.createObjectStore(storeName).then(() => {\n        const request = db.transaction([storeName], 'readwrite').objectStore(storeName).add({\n          id: id,\n          value: value\n        })\n        request.onsuccess = function (e) {\n          deferred.resolve(true)\n        }\n        request.onerror = function (e) {\n          deferred.reject(false)\n        }\n      }, () => {\n        deferred.reject(false)\n      })\n    }\n    return deferred.promise\n  }\n\n  /**\n   * 向对象仓库读取数据。\n   * @param {String} storeName 对象仓库（表）名称\n   * @param {Number} id 主键\n   * @returns {Promise}\n   */\n  getElementFromDB (storeName, id) {\n    const deferred = Cesium.when.defer()\n    const { db } = this\n    if (!Cesium.defined(db)) {\n      return null\n    }\n    if (!db.objectStoreNames.contains(storeName)) {\n      return null\n    }\n    try {\n      const transaction = db.transaction([storeName])\n      const objectStore = transaction.objectStore(storeName)\n      const request = objectStore.get(id)\n      request.onsuccess = e => {\n        return Cesium.defined(e.target.result) ? deferred.resolve(e.target.result.value) : deferred.reject(null)\n      }\n      request.onerror = e => {\n        deferred.reject(null)\n      }\n    } catch (error) {\n      deferred.reject(null)\n    }\n    return deferred.promise\n  }\n\n  /**\n   * 更新数据。\n   * @param {String} storeName\n   * @param {Number} id\n   * @param {*} value\n   * @returns {Promise}\n   */\n  updateElementInDB (storeName, id, value) {\n    const deferred = Cesium.when.defer()\n    const { db } = this\n    if (!Cesium.defined(db)) {\n      deferred.resolve(false)\n      return deferred.promise\n    }\n    if (!db.objectStoreNames.contains(storeName)) {\n      deferred.resolve(false)\n      return deferred.promise\n    }\n    try {\n      const request = db.transaction([storeName], 'readwrite')\n        .objectStore(storeName)\n        .put({ id: id, value: value })\n      request.onsuccess = () => {\n        deferred.resolve(true)\n      }\n      request.onerror = () => {\n        deferred.resolve(false)\n      }\n    } catch (e) {\n      deferred.resolve(false)\n    }\n    return deferred.promise\n  }\n\n  /**\n   * 移除数据。\n   * @param {String} storeName\n   * @param {Number} id\n   * @returns {Promise}\n   */\n  removeElementFromDB (storeName, id) {\n    const deferred = Cesium.when.defer()\n    const { db } = this\n    if (!Cesium.defined(db)) {\n      deferred.resolve(false)\n      return deferred.promise\n    }\n\n    if (!db.objectStoreNames.contains(storeName)) {\n      deferred.resolve(false)\n      return deferred.promise\n    }\n    try {\n      const request = db.transaction([storeName], 'readwrite')\n        .objectStore(storeName)\n        .delete(id)\n      request.onsuccess = () => {\n        deferred.resolve(true)\n      }\n      request.onerror = () => {\n        deferred.resolve(false)\n      }\n    } catch (e) {\n      deferred.resolve(false)\n    }\n    return deferred.promise\n  }\n\n  /**\n   *  清空对象仓库\n   * @param {String} storeName\n   */\n  clear (storeName) {\n    const deferred = Cesium.when.defer()\n    const { db } = this\n    if (!Cesium.defined(db)) {\n      deferred.resolve(false)\n      return deferred.promise\n    }\n\n    if (!db.objectStoreNames.contains(storeName)) {\n      deferred.resolve(false)\n      return deferred.promise\n    }\n\n    try {\n      const request = db.transaction([storeName], 'readwrite')\n        .objectStore(storeName)\n        .clear()\n      request.onsuccess = () => {\n        deferred.resolve(true)\n      }\n      request.onerror = () => {\n        deferred.resolve(false)\n      }\n    } catch (e) {\n      deferred.resolve(false)\n    }\n    return deferred.promise\n  }\n}\n\nexport default IndexedDBScheduler\n"],"names":["Status","NONE","STORING","STORED","FAILED","IndexedDBScheduler","options","Cesium","defined","name","DeveloperError","deferred","when","defer","dbname","dbRequest","window","indexedDB","open","that","onsuccess","event","db","target","result","version","cachestatus","resolve","onupgradeneeded","onerror","reject","errorcode","layer","storageType","creatingTable","promise","storeName","objectStoreNames","contains","close","objectStore","createObjectStore","keyPath","createIndex","unique","id","value","request","transaction","add","error","then","e","get","put","delete","clear"],"mappings":"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"}