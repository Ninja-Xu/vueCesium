{"version":3,"file":"SuperMapImageryProvider.js","sources":["src/exts/imageryProvider/SuperMapImageryProvider.js"],"sourcesContent":["import IndexedDBScheduler from './IndexedDBScheduler'\n\nclass SuperMapImageryProvider {\n  constructor (options) {\n    const { appendForwardSlash, Credit, defaultValue, defined, DeveloperError, Event, Resource, when, Math } = Cesium\n    options = defaultValue(options, {})\n    const { url } = options\n    if (!defined(url)) {\n      throw new DeveloperError('options.url is required.')\n    }\n    const rootNodeUrlRealspace3D = url.substring(0, url.indexOf('datas'))\n    this.tablename = url.substring(0, url.indexOf('datas/') + 6, url.length)\n    const that = this\n    const dbPromise = new IndexedDBScheduler({\n      name: rootNodeUrlRealspace3D + this.tablename\n    })\n    dbPromise.then((e) => {\n      that.m_indexedDBScheduler = e\n    })\n    this.m_indexedDBSetting = {\n      isOpen: false,\n      clear: () => {\n        that.m_indexedDBScheduler.clear(that.tablename)\n      }\n    }\n    this.isSci = false\n    this.isTileMap = false\n    const forwardSlashUrl = appendForwardSlash(url)\n    if (forwardSlashUrl.indexOf('rest/maps') > -1) {\n      this.isTileMap = true\n      this.layersID = options.layersID\n    } else {\n      if (!(forwardSlashUrl.indexOf('rest/realspace') > -1)) {\n        throw new DeveloperError('The url type is not supported!')\n      }\n      this.isSci = true\n    }\n    this.m_url = forwardSlashUrl\n    this.m_resource = Resource.createIfNeeded(forwardSlashUrl)\n    this.m_transparent = defaultValue(options.transparent, true)\n    this.m_name = options.name || ''\n    this.m_urlTemplate = undefined\n    this.m_errorEvent = new Event()\n    this.m_fileExtension = 'png'\n    this.m_tileWidth = 256\n    this.m_tileHeight = 256\n    this.m_minimumLevel = defaultValue(options.minimumLevel, 0)\n    this.m_maximumLevel = options.maximumLevel\n    this.m_rectangle = undefined\n    this.m_tilingScheme = undefined\n    this.m_tileDiscardPolicy = options.tileDiscardPolicy\n    this.m_fRatio = defaultValue(options.ratio, Math.DEGREES_PER_RADIAN / 6378137.0)\n    this.m_scales = []\n    this.m_coordUnit = 'DEGREE'\n    let credit = defaultValue(options.credit, new Credit('MapQuest, SuperMap iServer Imagery'))\n    if (typeof credit === 'string') {\n      credit = new Credit(credit)\n    }\n    this.m_credit = credit\n    this.m_ready = false\n    this.m_readyPromise = when.defer()\n    this.m_options = options\n    init.call(this)\n  }\n\n  get url () {\n    return this.m_url\n  }\n\n  get name () {\n    return this.m_name\n  }\n\n  set name (val) {\n    this.m_name = val\n  }\n\n  get tileWidth () {\n    if (!this.m_ready) {\n      throw new Cesium.DeveloperError('tileWidth must not be called before the imagery provider is ready.')\n    }\n    return this.m_tileWidth\n  }\n\n  get tileHeight () {\n    if (!this.m_ready) {\n      throw new Cesium.DeveloperError('tileHeight must not be called before the imagery provider is ready.')\n    }\n    return this.m_tileHeight\n  }\n\n  get maximumLevel () {\n    if (!this.m_ready) {\n      throw new Cesium.DeveloperError('maximumLevel must not be called before the imagery provider is ready.')\n    }\n    return this.m_maximumLevel\n  }\n\n  get minimumLevel () {\n    if (!this.m_ready) {\n      throw new Cesium.DeveloperError('minimumLevel must not be called before the imagery provider is ready.')\n    }\n    return this.m_minimumLevel\n  }\n\n  get tilingScheme () {\n    if (!this.m_ready) {\n      throw new Cesium.DeveloperError('tilingScheme must not be called before the imagery provider is ready.')\n    }\n    return this.m_tilingScheme\n  }\n\n  get rectangle () {\n    if (!this.m_ready) {\n      throw new Cesium.DeveloperError('rectangle must not be called before the imagery provider is ready.')\n    }\n    return this.m_rectangle\n  }\n\n  get errorEvent () {\n    return this.m_errorEvent\n  }\n\n  get ready () {\n    return this.m_ready\n  }\n\n  get credit () {\n    return this.m_credit\n  }\n\n  get hasAlphaChannel () {\n    return true\n  }\n\n  get readyPromise () {\n    return this.m_readyPromise\n  }\n\n  get ratio () {\n    return this.m_fRatio\n  }\n\n  set ratio (val) {\n    this.m_fRatio = val\n  }\n\n  get tileDiscardPolicy () {\n    return this.m_tileDiscardPolicy\n  }\n\n  getTileCredits (x, y, level) {\n    if (!this.ready) {\n      throw new Cesium.DeveloperError('getTileCredits must not be called before the imagery provider is ready.')\n    }\n    return undefined\n  }\n\n  requestImage (x, y, level, request) {\n    const { defined, DeveloperError, ImageryProvider, when } = Cesium\n    if (!this.ready) {\n      throw new DeveloperError('requestImage must not be called before the imagery provider is ready.')()\n    }\n\n    const url = buildImageResource.call(this, x, y, level)\n    const resource = this.m_resource.getDerivedResource({\n      url: url,\n      request: request\n    })\n    const that = this\n    if (this.m_indexedDBSetting.isOpen) {\n      if (defined(this.m_indexedDBScheduler)) {\n        const promise = this.m_indexedDBScheduler.getElementFromDB(this.tablename, url)\n        return defined(promise)\n          ? when(\n              promise,\n              (value) => {\n                if (defined(value)) {\n                  const image = new Image()\n                  image.src = value\n                  return image\n                }\n                return ImageryProvider.loadImage(that, resource)\n              },\n              (e) => {\n                return ImageryProvider.loadImage(that, resource)\n              }\n            )\n          : ImageryProvider.loadImage(that, resource)\n      }\n    }\n    return ImageryProvider.loadImage(this, resource)\n  }\n\n  pickFeatures () {}\n}\n\nlet previousError = {}\nconst ScaleTexts = [\n  '1.690163571602655E-9',\n  '3.3803271432053056E-9',\n  '6.760654286410611E-9',\n  '1.3521308572821242E-8',\n  '2.7042617145642484E-8',\n  '5.408523429128511E-8',\n  '1.0817046858256998E-7',\n  '2.1634093716513974E-7',\n  '4.3268187433028044E-7',\n  '8.653637486605571E-7',\n  '1.7307274973211203E-6',\n  '3.4614549946422405E-6',\n  '6.9229099892844565E-6',\n  '1.3845819978568952E-5',\n  '2.7691639957137904E-5',\n  '5.53832799142758E-5',\n  '1.107665598285516E-4',\n  '2.215331196571032E-4',\n  '4.430662393142064E-4',\n  '8.861324786284128E-4',\n  '1.772264957256826E-3',\n  '3.544529914513652E-3'\n]\nconst Scales = [\n  1.690163571602655e-9,\n  3.3803271432053056e-9,\n  6.760654286410611e-9,\n  1.3521308572821242e-8,\n  2.7042617145642484e-8,\n  5.408523429128511e-8,\n  1.0817046858256998e-7,\n  2.1634093716513974e-7,\n  4.3268187433028044e-7,\n  8.653637486605571e-7,\n  0.0000017307274973211203,\n  0.0000034614549946422405,\n  0.0000069229099892844565,\n  0.000013845819978568952,\n  0.000027691639957137904,\n  0.0000553832799142758,\n  0.0001107665598285516,\n  0.0002215331196571032,\n  0.0004430662393142064,\n  0.0008861324786284128,\n  0.001772264957256826,\n  0.003544529914513652\n]\n\nfunction buildImageResource (x, y, level) {\n  let url\n  if (this.isTileMap) {\n    if (this.m_coordUnit === 'DEGREE') {\n      const scaleText = ScaleTexts[level + 1] || ScaleTexts[level]\n      url = this.m_urlTemplate\n        .replace('{x}', x)\n        .replace('{y}', y)\n        .replace('{scale}', scaleText)\n    } else if (this.m_coordUnit === 'METER') {\n      const scaleText = ScaleTexts[level]\n      url = this.m_urlTemplate\n        .replace('{x}', x)\n        .replace('{y}', y)\n        .replace('{scale}', scaleText)\n    }\n  } else {\n    url = this.m_urlTemplate\n      .replace('{x}', x)\n      .replace('{y}', y)\n      .replace('{level}', level)\n      .replace('{fileExtension}', this.m_fileExtension)\n  }\n  return url\n}\n\nfunction init () {\n  const { Resource, when } = Cesium\n  if (this.isTileMap) {\n    const promise = Resource.fetchJsonp({\n      url: this.m_options.url + '.jsonp',\n      queryParameters: {\n        f: 'json'\n      }\n    })\n    when(promise, onFulfilledTileMap.bind(this), onRejected.bind(this))\n  } else {\n    // r(c.CREDENTIAL) && (o = c.addToken(o)),\n    when(\n      Resource.fetchText({\n        url: this.url + 'config'\n      }),\n      onFulfilledRest3D.bind(this),\n      onRejected.bind(this)\n    )\n  }\n}\nfunction getMaximumLevelbyScale (scale) {\n  for (let t = Scales.length; t--;) {\n    if (scale[t] <= scale) {\n      return t\n    }\n  }\n}\n\nfunction onFulfilledRest3D (xmlText) {\n  const options = parseConfigFromXmlText.call(this, xmlText)\n  const { defaultValue, defined, GeographicTilingScheme, Math, Rectangle } = Cesium\n  this.m_fileExtension = defaultValue(options.fileExtentName, 'png')\n  this.m_tileWidth = defaultValue(options.imageSizeWidth, 256)\n  this.m_tileHeight = defaultValue(options.imageSizeHeight, 256)\n  const levels = options.levels\n  const length = levels.length\n  this.m_minimumLevel = defaultValue(levels[0], 0)\n  this.m_maximumLevel = defaultValue(levels[length - 1], length - 1)\n  if (!defined(this.m_tilingScheme)) {\n    this.m_tilingScheme = new GeographicTilingScheme({\n      ellipsoid: this.m_options.ellipsoid\n    })\n  }\n  if (!defined(this.m_rectangle)) {\n    if (options.left && options.right && options.top && options.bottom) {\n      const left = Math.toRadians(options.left)\n      const right = Math.toRadians(options.right)\n      const bottom = Math.toRadians(options.bottom)\n      const top = Math.toRadians(options.top)\n      this.m_rectangle = new Rectangle(left, bottom, right, top)\n    }\n  }\n  const tilingScheme = this.m_tilingScheme\n  this.m_rectangle.west < tilingScheme.rectangle.west && (this.m_rectangle.west = tilingScheme.rectangle.west)\n  this.m_rectangle.east > tilingScheme.rectangle.east && (this.m_rectangle.east = tilingScheme.rectangle.east)\n  this.m_rectangle.south < tilingScheme.rectangle.south && (this.m_rectangle.south = tilingScheme.rectangle.south)\n  this.m_rectangle.north > tilingScheme.rectangle.north && (this.m_rectangle.north = tilingScheme.rectangle.north)\n\n  const swTile = tilingScheme.positionToTileXY(Rectangle.southwest(this.m_rectangle), this.m_minimumLevel)\n  const neTile = tilingScheme.positionToTileXY(Rectangle.northeast(this.m_rectangle), this.m_minimumLevel)\n  const tileCount = (window.Math.abs(neTile.x - swTile.x) + 1) * (window.Math.abs(neTile.y - swTile.y) + 1)\n  tileCount > 4 && (this.m_minimumLevel = 0)\n  this.m_tilingScheme = tilingScheme\n  this.m_urlTemplate = this.m_url + 'data/index/{y}/{x}.{fileExtension}?level={level}'\n  this.m_ready = true\n  this.m_readyPromise.resolve(true)\n}\n\nfunction parseConfigFromXmlText (xmlText) {\n  const domParser = new DOMParser()\n  xmlText = domParser.parseFromString(xmlText, 'application/xml')\n  const namespaceURI = 'http://www.supermap.com/SuperMapCache/sci3d'\n  const rootNode = xmlText.childNodes[0]\n  // let version = queryNumericAttribute(rootNode, 'Version', namespaceURI)\n  const levelsNode = queryFirstNode(rootNode, 'Levels', namespaceURI)\n  const levelsNodes = queryNodes(levelsNode, 'Level', namespaceURI)\n  const levels = []\n  for (let i = 0; i < levelsNodes.length; i++) {\n    levels.push(parseInt(levelsNodes[i].textContent, 10))\n  }\n  const boundsNode = queryFirstNode(rootNode, 'Bounds', namespaceURI)\n  const left = queryNumericAttribute(boundsNode, 'Left', namespaceURI)\n  const right = queryNumericAttribute(boundsNode, 'Right', namespaceURI)\n  const top = queryNumericAttribute(boundsNode, 'Top', namespaceURI)\n  const bottom = queryNumericAttribute(boundsNode, 'Bottom', namespaceURI)\n  const fileExtentName = queryStringValue(rootNode, 'FileExtentName', namespaceURI)\n  const cellWidth = queryNumericAttribute(rootNode, 'CellWidth', namespaceURI)\n  const cellHeight = queryNumericAttribute(rootNode, 'CellHeight', namespaceURI)\n  const cacheName = queryStringValue(rootNode, 'CacheName', namespaceURI)\n  this.m_name = cacheName || ''\n  return {\n    left: left,\n    right: right,\n    top: top,\n    bottom: bottom,\n    fileExtentName: fileExtentName,\n    levels: levels,\n    imageSizeWidth: cellWidth,\n    imageSizeHeight: cellHeight\n  }\n}\nfunction queryStringValue (xmlNode, attribute, namespaceURI) {\n  const node = queryFirstNode(xmlNode, attribute, namespaceURI)\n  return Cesium.defined(node) ? node.textContent.trim() : undefined\n}\n\nfunction queryNumericAttribute (xmlNode, attribute, namespaceURI) {\n  const node = queryFirstNode(xmlNode, attribute, namespaceURI)\n  if (Cesium.defined(node)) {\n    const number = parseFloat(node.textContent)\n    return isNaN(number) ? undefined : number\n  }\n}\nfunction queryFirstNode (xmlNode, attribute, namespaceURI) {\n  if (Cesium.defined(xmlNode)) {\n    const nodes = xmlNode.childNodes\n    const length = nodes.length\n    for (let i = 0; i < length; i++) {\n      const node = nodes[i]\n      if (node.localName === attribute && namespaceURI.indexOf(node.namespaceURI) !== -1) {\n        return node\n      }\n    }\n  }\n}\n\nfunction queryNodes (xmlNode, attribute, namespaceURI) {\n  if (Cesium.defined(xmlNode)) {\n    const nodes = []\n    const nodeList = xmlNode.getElementsByTagNameNS('*', attribute)\n    const length = nodeList.length\n    for (let i = 0; i < length; i++) {\n      const node = nodeList[i]\n      node.localName === attribute && namespaceURI.indexOf(node.namespaceURI) !== -1 && nodes.push(node)\n    }\n    return nodes\n  }\n}\n\nfunction onFulfilledTileMap (response) {\n  const { Cartesian3, defaultValue, defined, GeographicTilingScheme, Math, Rectangle, WebMercatorTilingScheme } = Cesium\n  const coordUnit = response.prjCoordSys.coordUnit\n  this.m_coordUnit = coordUnit\n  const bounds = response.bounds\n  const visibleScales = response.visibleScales\n  if (defined(visibleScales) && visibleScales.length > 1 && defined(this.m_maximumLevel)) {\n    const lastVisibleScale = visibleScales[visibleScales.length - 1]\n    this.m_maximumLevel = getMaximumLevelbyScale(lastVisibleScale)\n  }\n  if (coordUnit === 'DEGREE') {\n    this.m_tilingScheme = new GeographicTilingScheme()\n    bounds.left = Math.clamp(bounds.left, -180, 180)\n    bounds.bottom = Math.clamp(bounds.bottom, -90, 90)\n    bounds.right = Math.clamp(bounds.right, -180, 180)\n    bounds.top = Math.clamp(bounds.top, -90, 90)\n    this.m_rectangle = Rectangle.fromDegrees(bounds.left, bounds.bottom, bounds.right, bounds.top)\n    this.m_urlTemplate =\n      this.m_url +\n      'tileImage.png?transparent={transparent}&cacheEnabled=true&width=256&height=256&x={x}&y={y}&scale={scale}&redirect=false&overlapDisplayed=false&origin={\"x\":-180,\"y\":90}'\n  } else {\n    const pointLB = new Cartesian3(bounds.left, bounds.bottom, 0)\n    pointLB.x = Math.max(-20037508.342789244, pointLB.x)\n    pointLB.y = Math.max(-20037508.342789244, pointLB.y)\n    const pointRT = new Cartesian3(bounds.right, bounds.top, 0)\n    pointRT.x = Math.min(20037508.342789244, pointRT.x)\n    pointRT.y = Math.min(20037508.342789244, pointRT.y)\n    this.m_tilingScheme = new WebMercatorTilingScheme()\n    const f = this.m_tilingScheme.projection.unproject(pointLB)\n    const p = this.m_tilingScheme.projection.unproject(pointRT)\n    this.m_rectangle = new Rectangle(f.longitude, f.latitude, p.longitude, p.latitude)\n    this.m_urlTemplate =\n      this.m_url +\n      'tileImage.png?transparent={transparent}&cacheEnabled=true&width=256&height=256&x={x}&y={y}&scale={scale}&redirect=false&overlapDisplayed=false&origin={\"x\":-20037508.342789248 ,\"y\":20037508.342789095}'\n  }\n  this.m_urlTemplate = this.m_urlTemplate.replace('{transparent}', this.m_transparent)\n  this.layersID && (this.m_urlTemplate = this.m_urlTemplate + '&layersID=' + this.layersID)\n  this.m_rectangle || (this.m_rectangle = defaultValue(this.m_options.rectangle, this.m_tilingScheme.rectangle))\n  this.m_ready = true\n  this.m_readyPromise.resolve(true)\n}\n\nfunction onRejected () {\n  const { TileProviderError, RuntimeError } = Cesium\n  const message = 'An error occurred while accessing ' + this.m_url + '.'\n  previousError = TileProviderError.handleError(\n    previousError,\n    this,\n    this.m_errorEvent,\n    message,\n    undefined,\n    undefined,\n    undefined,\n    init.bind(this)\n  )\n  this.m_readyPromise.reject(new RuntimeError(message))\n}\n\nexport default SuperMapImageryProvider\n"],"names":["SuperMapImageryProvider","options","Cesium","appendForwardSlash","Credit","defaultValue","defined","DeveloperError","Event","Resource","when","Math","url","rootNodeUrlRealspace3D","substring","indexOf","tablename","length","that","dbPromise","IndexedDBScheduler","name","then","e","m_indexedDBScheduler","m_indexedDBSetting","isOpen","clear","isSci","isTileMap","forwardSlashUrl","layersID","m_url","m_resource","createIfNeeded","m_transparent","transparent","m_name","m_urlTemplate","undefined","m_errorEvent","m_fileExtension","m_tileWidth","m_tileHeight","m_minimumLevel","minimumLevel","m_maximumLevel","maximumLevel","m_rectangle","m_tilingScheme","m_tileDiscardPolicy","tileDiscardPolicy","m_fRatio","ratio","DEGREES_PER_RADIAN","m_scales","m_coordUnit","credit","m_credit","m_ready","m_readyPromise","defer","m_options","init","call","val","x","y","level","ready","request","ImageryProvider","buildImageResource","resource","getDerivedResource","promise","getElementFromDB","value","image","Image","src","loadImage","previousError","ScaleTexts","Scales","scaleText","replace","fetchJsonp","queryParameters","f","onFulfilledTileMap","bind","onRejected","fetchText","onFulfilledRest3D","getMaximumLevelbyScale","scale","t","xmlText","parseConfigFromXmlText","GeographicTilingScheme","Rectangle","fileExtentName","imageSizeWidth","imageSizeHeight","levels","ellipsoid","left","right","top","bottom","toRadians","tilingScheme","west","rectangle","east","south","north","swTile","positionToTileXY","southwest","neTile","northeast","tileCount","window","abs","resolve","domParser","DOMParser","parseFromString","namespaceURI","rootNode","childNodes","levelsNode","queryFirstNode","levelsNodes","queryNodes","i","push","textContent","boundsNode","queryNumericAttribute","queryStringValue","cellWidth","cellHeight","cacheName","xmlNode","attribute","node","trim","number","isNaN","nodes","localName","nodeList","getElementsByTagNameNS","response","Cartesian3","WebMercatorTilingScheme","coordUnit","prjCoordSys","bounds","visibleScales","lastVisibleScale","clamp","fromDegrees","pointLB","max","pointRT","min","projection","unproject","p","longitude","latitude","TileProviderError","RuntimeError","message","handleError","reject"],"mappings":"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"}