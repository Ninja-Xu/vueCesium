{"version":3,"file":"PolylineTrailMaterialProperty.js","sources":["src/exts/materialProperty/PolylineTrailMaterialProperty.js"],"sourcesContent":["class PolylineTrailMaterialProperty {\n  constructor (color, duration, imageUrl, loop) {\n    if (!Object.getOwnPropertyDescriptor(PolylineTrailMaterialProperty.prototype, 'color')) {\n      Object.defineProperties(PolylineTrailMaterialProperty.prototype, {\n        color: Cesium.createPropertyDescriptor('color')\n      })\n    }\n    this._definitionChanged = new Cesium.Event()\n    this._color = undefined\n    this.color = color\n    this._duration = duration\n    this._time = (new Date()).getTime()\n    this._imageUrl = imageUrl\n    this._loop = loop\n    this.init()\n  }\n\n  init () {\n    const PolylineTrailType = 'PolylineTrail'\n    const PolylineTrailImage = this._imageUrl\n    const PolylineTrailSource = `\n      czm_material czm_getMaterial(czm_materialInput materialInput)\n      {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n      }`\n    // material.alpha:透明度; material.diffuse：颜色;\n    Cesium.Material._materialCache.addMaterial(PolylineTrailType, {\n      fabric: {\n        type: PolylineTrailType,\n        uniforms: {\n          color: new Cesium.Color(1, 0, 0, 1),\n          image: PolylineTrailImage,\n          time: 0,\n          repeat: new Cesium.Cartesian2(1, 1),\n          axisY: false\n        },\n        source: PolylineTrailSource\n      },\n      translucent () {\n        return true\n      }\n    })\n  }\n\n  getType () {\n    return 'PolylineTrail'\n  }\n\n  getValue (time, result) {\n    if (!Cesium.defined(result)) {\n      result = {}\n    }\n\n    if (this.lastTime >= 0.99 && !this._loop) {\n      return result\n    }\n    result.color = Cesium.Property.getValueOrClonedDefault(this._color, time, Cesium.Color.WHITE, result.color)\n    result.image = this._imageUrl\n    result.time = (((new Date()).getTime() - this._time) % this._duration) / this._duration\n    this.lastTime = result.time\n    return result\n  }\n\n  equals (other) {\n    return this === other || (other instanceof PolylineTrailMaterialProperty && Cesium.Property.equals(this._color, other._other))\n  }\n\n  get isConstant () {\n    return false\n  }\n\n  get definitionChanged () {\n    return this._definitionChanged\n  }\n}\nexport default PolylineTrailMaterialProperty\n"],"names":["PolylineTrailMaterialProperty","color","duration","imageUrl","loop","prototype","Object","defineProperties","Cesium","createPropertyDescriptor","_definitionChanged","Event","_color","undefined","_duration","_time","Date","getTime","_imageUrl","_loop","init","PolylineTrailType","PolylineTrailImage","PolylineTrailSource","Material","_materialCache","addMaterial","fabric","type","uniforms","Color","image","time","repeat","Cartesian2","axisY","source","translucent","result","defined","lastTime","Property","getValueOrClonedDefault","WHITE","other","equals","_other"],"mappings":"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"}