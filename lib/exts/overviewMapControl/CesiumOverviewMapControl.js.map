{"version":3,"file":"CesiumOverviewMapControl.js","sources":["src/exts/overviewMapControl/CesiumOverviewMapControl.js"],"sourcesContent":["/**\n * @license\n *\n * OverviewMapForCesium\n *\n * See: https://github.com/leation/OverviewMapForCesium\n *\n * @author leation\n *\n *   Copyright 2019 leation\n *\n *   Licensed under the Apache License, Version 2.0 (the \"License\");\n *   you may not use this file except in compliance with the License.\n *   You may obtain a copy of the License at\n *\n *       http://www.apache.org/licenses/LICENSE-2.0\n *\n *   Unless required by applicable law or agreed to in writing, software\n *   distributed under the License is distributed on an \"AS IS\" BASIS,\n *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *   See the License for the specific language governing permissions and\n *   limitations under the License.\n *\n */\n\n// import * as L from 'leaflet'\nimport { Util, DomEvent, CRS, Map, rectangle, DomUtil, LatLngBounds, Browser, LatLng } from 'leaflet/dist/leaflet-src.esm'\n\nconst CesiumOverviewMapControl = function () {\n  this.init.apply(this, arguments)\n}\n\nCesiumOverviewMapControl.prototype = {\n  _container: null,\n  _miniMap: null,\n  _viewerMoving: false,\n  _miniMapMoving: false,\n  _userToggledDisplay: false,\n  _minimized: false,\n  vm: null,\n  viewer: null,\n  tileLayer: null,\n  options: {\n    position: 'bottomleft',\n    toggleDisplay: true,\n    zoomLevelOffset: -5,\n    zoomLevelFixed: false,\n    centerFixed: false,\n    zoomControl: false,\n    zoomAnimation: false,\n    autoToggleDisplay: false,\n    minimized: false,\n    width: 150,\n    height: 150,\n    collapsedWidth: 19,\n    collapsedHeight: 19,\n    aimingRectOptions: { color: '#ff7800', weight: 1, interactive: false },\n    shadowRectOptions: { color: '#000000', weight: 1, interactive: false, opacity: 0, fillOpacity: 0 },\n    // strings: { hideText: '隐藏鹰眼', showText: '显示鹰眼' },\n    mapOptions: {\n      toggleDisplay: true,\n      aimingRectOptions: {\n        color: '#ff1100',\n        weight: 3\n      },\n      shadowRectOptions: {\n        color: '#0000AA',\n        weight: 1,\n        opacity: 0,\n        fillOpacity: 0\n      }\n    }\n  },\n  init: function (viewer, layer, options, vm) {\n    this.viewer = viewer\n    this.tileLayer = layer\n    this._container = options.container\n    this.vm = vm\n    Util.setOptions(this, options)\n\n    this.options.aimingRectOptions.interactive = false\n    this.options.shadowRectOptions.interactive = false\n\n    this._initMap()\n    this._showInitView()\n  },\n  updateAimingRect: function () {\n    const _this = this\n    const rect = _this._getViewRange()\n    _this._aimingRect.setBounds(rect)\n  },\n  _initMap: function () {\n    const _this = this\n\n    this._container.style.width = this.options.width + 'px'\n    this._container.style.height = this.options.height + 'px'\n\n    DomEvent.disableClickPropagation(_this._container)\n    DomEvent.on(_this._container, 'mousewheel', DomEvent.stopPropagation)\n\n    let mapOptions = {\n      attributionControl: false,\n      dragging: !_this.options.centerFixed,\n      zoomControl: _this.options.zoomControl,\n      zoomAnimation: _this.options.zoomAnimation,\n      autoToggleDisplay: _this.options.autoToggleDisplay,\n      touchZoom: _this.options.centerFixed ? 'center' : !_this._isZoomLevelFixed(),\n      scrollWheelZoom: _this.options.centerFixed ? 'center' : !_this._isZoomLevelFixed(),\n      doubleClickZoom: _this.options.centerFixed ? 'center' : !_this._isZoomLevelFixed(),\n      boxZoom: !_this._isZoomLevelFixed(),\n      crs: CRS.EPSG3857,\n      center: [30, 120],\n      zoom: 1\n    }\n    mapOptions = Util.extend(_this.options.mapOptions, mapOptions) // merge\n    // with\n    // priority\n    // of\n    // the\n    // local\n    // mapOptions\n    // object.\n\n    _this._miniMap = new Map(_this._container, mapOptions)\n\n    const layer = this.tileLayer\n    _this._miniMap.addLayer(layer)\n\n    // These bools are used to prevent infinite loops of the two maps\n    // notifying each other that they've moved.\n    _this._viewerMoving = true\n    _this._miniMapMoving = false\n\n    // Keep a record of _this to prevent auto toggling when the user\n    // explicitly doesn't want it.\n    _this._userToggledDisplay = false\n    _this._minimized = false\n\n    if (this.options.toggleDisplay) {\n      this._addToggleButton()\n    }\n\n    _this._miniMap.whenReady(\n      Util.bind(function () {\n        const bounds = _this._getViewRange()\n        _this._aimingRect = rectangle(bounds, _this.options.aimingRectOptions).addTo(_this._miniMap)\n        _this._shadowRect = rectangle(bounds, _this.options.shadowRectOptions).addTo(_this._miniMap)\n\n        const camera = _this.viewer.scene.camera\n        camera.moveEnd.addEventListener(function (e) {\n          const rect = _this._getViewRange()\n          if (!_this._miniMapMoving) {\n            _this._viewerMoving = true\n            const zrect = _this._getZoomOutRange(rect)\n            _this._miniMap.fitBounds(zrect)\n            _this._setDisplay(_this._decideMinimized())\n          } else {\n            _this._miniMapMoving = false\n          }\n          _this._aimingRect.setBounds(rect)\n        })\n        camera.moveStart.addEventListener(function (e) {\n          const rect = _this._getViewRange()\n          _this._aimingRect.setBounds(rect)\n        })\n\n        _this._miniMap.on('movestart', _this._onMiniMapMoveStarted, _this)\n        _this._miniMap.on('move', _this._onMiniMapMoving, _this)\n        _this._miniMap.on('moveend', _this._onMiniMapMoved, _this)\n      }, _this)\n    )\n\n    return _this._container\n  },\n  _addToggleButton: function () {\n    this._toggleDisplayButton = this.options.toggleDisplay\n      ? this._createButton(\n          '',\n          this._toggleButtonInitialTitleText(),\n          'vc-leaflet-control-minimap-toggle-display vc-leaflet-control-minimap-toggle-display-' + this.options.position,\n          this._container,\n          this._toggleDisplayButtonClicked,\n          this\n        )\n      : undefined\n    // this._toggleDisplayButton.style.zIndex = 99999;\n    this._toggleDisplayButton.style.width = this.options.collapsedWidth + 'px'\n    this._toggleDisplayButton.style.height = this.options.collapsedHeight + 'px'\n  },\n\n  _toggleButtonInitialTitleText: function () {\n    if (!this.options.minimized) {\n      return this.vm.$vc.lang.overviewmap.hidden\n    }\n  },\n\n  _createButton: function (html, title, className, container, fn, context) {\n    const link = DomUtil.create('a', className, container)\n    link.innerHTML = html\n    link.href = '#'\n    link.title = title\n\n    const stop = DomEvent.stopPropagation\n\n    DomEvent.on(link, 'click', stop)\n      .on(link, 'mousedown', stop)\n      .on(link, 'dblclick', stop)\n      .on(link, 'click', DomEvent.preventDefault)\n      .on(link, 'click', fn, context)\n\n    return link\n  },\n\n  _toggleDisplayButtonClicked: function () {\n    this._userToggledDisplay = true\n    if (!this._minimized) {\n      this._minimize()\n    } else {\n      this._restore()\n    }\n  },\n  _showInitView: function () {\n    const rect = this._getViewRange()\n    const zrect = this._getZoomOutRange(rect)\n    this._miniMap.fitBounds(zrect)\n  },\n  _setDisplay: function (minimize) {\n    if (minimize !== this._minimized) {\n      if (!this._minimized) {\n        this._minimize()\n      } else {\n        this._restore()\n      }\n    }\n  },\n  _minimize: function () {\n    // hide the minimap\n    if (this.options.toggleDisplay) {\n      this._container.style.width = this.options.collapsedWidth + 'px'\n      this._container.style.height = this.options.collapsedHeight + 'px'\n      this._toggleDisplayButton.className += ' minimized-' + this.options.position\n      this._toggleDisplayButton.title = this.vm.$vc.lang.overviewmap.show\n    } else {\n      this._container.style.display = 'none'\n    }\n    this._minimized = true\n    this._onToggle()\n  },\n  _restore: function () {\n    if (this.options.toggleDisplay) {\n      this._container.style.width = this.options.width + 'px'\n      this._container.style.height = this.options.height + 'px'\n      this._toggleDisplayButton.className = this._toggleDisplayButton.className.replace('minimized-' + this.options.position, '')\n      this._toggleDisplayButton.title = this.vm.$vc.lang.overviewmap.hidden\n    } else {\n      this._container.style.display = 'block'\n    }\n    this._minimized = false\n    this._onToggle()\n  },\n  _onMiniMapMoveStarted: function (e) {\n    if (!this.options.centerFixed) {\n      const lastAimingRect = this._aimingRect.getBounds()\n      const sw = this._miniMap.latLngToContainerPoint(lastAimingRect.getSouthWest())\n      const ne = this._miniMap.latLngToContainerPoint(lastAimingRect.getNorthEast())\n      this._lastAimingRectPosition = { sw: sw, ne: ne }\n    }\n  },\n  _onMiniMapMoving: function (e) {\n    if (!this.options.centerFixed) {\n      if (!this._viewerMoving && this._lastAimingRectPosition) {\n        this._shadowRect.setBounds(\n          new LatLngBounds(\n            this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.sw),\n            this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.ne)\n          )\n        )\n        this._shadowRect.setStyle({ opacity: 1, fillOpacity: 0.3 })\n      }\n    }\n  },\n  _onMiniMapMoved: function (e) {\n    if (!this._viewerMoving) {\n      this._miniMapMoving = true\n\n      const rect = this._shadowRect.getBounds()\n      const west = rect.getWest()\n      const east = rect.getEast()\n      const north = rect.getNorth()\n      const south = rect.getSouth()\n      const destination = Cesium.Rectangle.fromDegrees(west, south, east, north)\n      const orientation = {\n        heading: Cesium.Math.toRadians(0),\n        pitch: Cesium.Math.toRadians(-90),\n        roll: 0.0\n      }\n      this.viewer.scene.camera.setView({\n        destination: destination,\n        orientation: orientation\n      })\n      this._shadowRect.setStyle({ opacity: 0, fillOpacity: 0 })\n    } else {\n      this._viewerMoving = false\n    }\n  },\n  _isZoomLevelFixed: function () {\n    const zoomLevelFixed = this.options.zoomLevelFixed\n    return this._isDefined(zoomLevelFixed) && this._isInteger(zoomLevelFixed)\n  },\n  _decideMinimized: function () {\n    if (this._userToggledDisplay) {\n      return this._minimized\n    }\n\n    if (this.options.autoToggleDisplay) {\n      const bounds = this._getViewRange()\n      if (bounds.contains(this._miniMap.getBounds())) {\n        return true\n      }\n      return false\n    }\n\n    return this._minimized\n  },\n  _isInteger: function (value) {\n    return typeof value === 'number'\n  },\n  _isDefined: function (value) {\n    return typeof value !== 'undefined'\n  },\n  _onToggle: function () {\n    Util.requestAnimFrame(function () {\n      DomEvent.on(this._container, 'transitionend', this._fireToggleEvents, this)\n      if (!Browser.any3d) {\n        Util.requestAnimFrame(this._fireToggleEvents, this)\n      }\n    }, this)\n  },\n  _fireToggleEvents: function () {\n    DomEvent.off(this._container, 'transitionend', this._fireToggleEvents, this)\n  },\n  _getViewRange: function () {\n    const viewer = this.viewer\n    const camera = viewer.scene.camera\n    const range = camera.computeViewRectangle()\n    const west = (range.west / Math.PI) * 180\n    const east = (range.east / Math.PI) * 180\n    const north = (range.north / Math.PI) * 180\n    const south = (range.south / Math.PI) * 180\n    const bounds = new LatLngBounds(new LatLng(north, west), new LatLng(south, east))\n    return bounds\n  },\n  _getZoomOutRange: function (rect) {\n    let west = rect.getWest()\n    let east = rect.getEast()\n    let north = rect.getNorth()\n    let south = rect.getSouth()\n    const factor = 3.0\n    const xdis = Math.abs(east - west)\n    const ydis = Math.abs(north - south)\n    const xoff = (xdis * (factor - 1)) / 2.0\n    const yoff = (ydis * (factor - 1)) / 2.0\n    west -= xoff\n    east += xoff\n    north += yoff\n    south -= yoff\n    if (west < -180) {\n      west = -180\n    }\n    if (east > 180) {\n      east = 180\n    }\n    if (north > 90) {\n      north = 90\n    }\n    if (south < -90) {\n      south = -90\n    }\n    const bounds = new LatLngBounds(new LatLng(north, west), new LatLng(south, east))\n    return bounds\n  },\n  CLASS_NAME: 'CesiumOverviewMapControl'\n}\n\nexport default CesiumOverviewMapControl\n"],"names":["CesiumOverviewMapControl","init","apply","arguments","prototype","_container","_miniMap","_viewerMoving","_miniMapMoving","_userToggledDisplay","_minimized","vm","viewer","tileLayer","options","position","toggleDisplay","zoomLevelOffset","zoomLevelFixed","centerFixed","zoomControl","zoomAnimation","autoToggleDisplay","minimized","width","height","collapsedWidth","collapsedHeight","aimingRectOptions","color","weight","interactive","shadowRectOptions","opacity","fillOpacity","mapOptions","layer","container","Util","setOptions","_initMap","_showInitView","updateAimingRect","_this","rect","_getViewRange","_aimingRect","setBounds","style","DomEvent","disableClickPropagation","on","stopPropagation","attributionControl","dragging","touchZoom","_isZoomLevelFixed","scrollWheelZoom","doubleClickZoom","boxZoom","crs","CRS","EPSG3857","center","zoom","extend","Map","addLayer","_addToggleButton","whenReady","bind","bounds","rectangle","addTo","_shadowRect","camera","scene","moveEnd","addEventListener","e","zrect","_getZoomOutRange","fitBounds","_setDisplay","_decideMinimized","moveStart","_onMiniMapMoveStarted","_onMiniMapMoving","_onMiniMapMoved","_toggleDisplayButton","_createButton","_toggleButtonInitialTitleText","_toggleDisplayButtonClicked","undefined","$vc","lang","overviewmap","hidden","html","title","className","fn","context","link","DomUtil","create","innerHTML","href","stop","preventDefault","_minimize","_restore","minimize","show","display","_onToggle","replace","lastAimingRect","getBounds","sw","latLngToContainerPoint","getSouthWest","ne","getNorthEast","_lastAimingRectPosition","LatLngBounds","containerPointToLatLng","setStyle","west","getWest","east","getEast","north","getNorth","south","getSouth","destination","Cesium","Rectangle","fromDegrees","orientation","heading","Math","toRadians","pitch","roll","setView","_isDefined","_isInteger","contains","value","requestAnimFrame","_fireToggleEvents","Browser","any3d","off","range","computeViewRectangle","PI","LatLng","factor","xdis","abs","ydis","xoff","yoff","CLASS_NAME"],"mappings":"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"}