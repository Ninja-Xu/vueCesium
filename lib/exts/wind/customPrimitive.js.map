{"version":3,"file":"customPrimitive.js","sources":["src/exts/wind/customPrimitive.js"],"sourcesContent":["class CustomPrimitive {\n  constructor (options) {\n    this.commandType = options.commandType\n\n    this.geometry = options.geometry\n    this.attributeLocations = options.attributeLocations\n    this.primitiveType = options.primitiveType\n\n    this.uniformMap = options.uniformMap\n\n    this.vertexShaderSource = options.vertexShaderSource\n    this.fragmentShaderSource = options.fragmentShaderSource\n\n    this.rawRenderState = options.rawRenderState\n    this.framebuffer = options.framebuffer\n\n    this.outputTexture = options.outputTexture\n\n    this.autoClear = Cesium.defaultValue(options.autoClear, false)\n    this.preExecute = options.preExecute\n\n    this.show = true\n    this.commandToExecute = undefined\n    this.clearCommand = undefined\n    if (this.autoClear) {\n      this.clearCommand = new Cesium.ClearCommand({\n        color: new Cesium.Color(0.0, 0.0, 0.0, 0.0),\n        depth: 1.0,\n        framebuffer: this.framebuffer,\n        pass: Cesium.Pass.OPAQUE\n      })\n    }\n  }\n\n  createCommand (context) {\n    switch (this.commandType) {\n      case 'Draw': {\n        const vertexArray = Cesium.VertexArray.fromGeometry({\n          context: context,\n          geometry: this.geometry,\n          attributeLocations: this.attributeLocations,\n          bufferUsage: Cesium.BufferUsage.STATIC_DRAW\n        })\n\n        const shaderProgram = Cesium.ShaderProgram.fromCache({\n          context: context,\n          attributeLocations: this.attributeLocations,\n          vertexShaderSource: this.vertexShaderSource,\n          fragmentShaderSource: this.fragmentShaderSource\n        })\n\n        const renderState = Cesium.RenderState.fromCache(this.rawRenderState)\n        return new Cesium.DrawCommand({\n          owner: this,\n          vertexArray: vertexArray,\n          primitiveType: this.primitiveType,\n          uniformMap: this.uniformMap,\n          modelMatrix: Cesium.Matrix4.IDENTITY,\n          shaderProgram: shaderProgram,\n          framebuffer: this.framebuffer,\n          renderState: renderState,\n          pass: Cesium.Pass.OPAQUE\n        })\n      }\n      case 'Compute': {\n        return new Cesium.ComputeCommand({\n          owner: this,\n          fragmentShaderSource: this.fragmentShaderSource,\n          uniformMap: this.uniformMap,\n          outputTexture: this.outputTexture,\n          persists: true\n        })\n      }\n    }\n  }\n\n  setGeometry (context, geometry) {\n    this.geometry = geometry\n    const vertexArray = Cesium.VertexArray.fromGeometry({\n      context: context,\n      geometry: this.geometry,\n      attributeLocations: this.attributeLocations,\n      bufferUsage: Cesium.BufferUsage.STATIC_DRAW\n    })\n    this.commandToExecute.vertexArray = vertexArray\n  }\n\n  update (frameState) {\n    if (!this.show) {\n      return\n    }\n\n    if (!Cesium.defined(this.commandToExecute)) {\n      this.commandToExecute = this.createCommand(frameState.context)\n    }\n\n    if (Cesium.defined(this.preExecute)) {\n      this.preExecute()\n    }\n\n    if (Cesium.defined(this.clearCommand)) {\n      frameState.commandList.push(this.clearCommand)\n    }\n    frameState.commandList.push(this.commandToExecute)\n  }\n\n  isDestroyed () {\n    return false\n  }\n\n  destroy () {\n    if (Cesium.defined(this.commandToExecute)) {\n      this.commandToExecute.shaderProgram =\n        this.commandToExecute.shaderProgram &&\n        this.commandToExecute.shaderProgram.destroy()\n    }\n    return Cesium.destroyObject(this)\n  }\n}\n\nexport default CustomPrimitive\n"],"names":["CustomPrimitive","options","commandType","geometry","attributeLocations","primitiveType","uniformMap","vertexShaderSource","fragmentShaderSource","rawRenderState","framebuffer","outputTexture","autoClear","Cesium","defaultValue","preExecute","show","commandToExecute","undefined","clearCommand","ClearCommand","color","Color","depth","pass","Pass","OPAQUE","context","vertexArray","VertexArray","fromGeometry","bufferUsage","BufferUsage","STATIC_DRAW","shaderProgram","ShaderProgram","fromCache","renderState","RenderState","DrawCommand","owner","modelMatrix","Matrix4","IDENTITY","ComputeCommand","persists","frameState","defined","createCommand","commandList","push","destroy","destroyObject"],"mappings":"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"}