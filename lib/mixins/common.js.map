{"version":3,"file":"common.js","sources":["src/mixins/common.js"],"sourcesContent":["import services from './services'\nimport nameClassMap from '../utils/nameClassMap'\nimport { isFunction } from '../utils/util'\nimport * as allProps from '../mixins/mixinProps'\n\nconst VM_PROP = 'vm'\n\nconst graphics = [\n  'billboard',\n  'box',\n  'corridor',\n  'cylinder',\n  'ellipse',\n  'ellipsoid',\n  'label',\n  'model',\n  'tileset',\n  'path',\n  'plane',\n  'point',\n  'polygon',\n  'polyline',\n  'polylineVolume',\n  'rectangle',\n  'wall'\n]\n/**\n * Get the parent component. 获取 vc-viewer 组件。\n * @param {VueComponent} cmp.\n */\nconst getVcParent = (cmp) => {\n  const parentVm = cmp.$parent\n  return !parentVm.cesiumClass && parentVm.$options.name !== 'vc-viewer' ? getVcParent(parentVm) : parentVm\n}\n\n/**\n * @vueMethods\n */\nconst methods = {\n  /**\n   * Load components asynchronously. 异步加载组件。\n   * @returns {Promise<Object>} { Cesium, viewer, cesiumObject }\n   */\n  async load () {\n    // Returns if it is already loaded. 如果已经加载则返回。\n    if (this._mounted) {\n      return false\n    }\n\n    await this.beforeLoad()\n\n    const { createCesiumObject, mount, setPropWatchers } = this\n    const $parent = getVcParent(this)\n    const Cesium = (this.Cesium = $parent.Cesium)\n    const viewer = (this.viewer = $parent.viewer)\n    // If you call the unload method to unload the component, the Cesium object of the parent component may be unloaded. You need to load the parent component first.\n    // 如果调用过 unload 方法卸载组件，父组件的 Cesium 对象可能会被卸载 需要先加载父组件。\n    if (!$parent.cesiumObject && !this.nowaiting) {\n      return $parent.load()\n    }\n    // Register vue Watchers. 注册 Vue 侦听器。\n    setPropWatchers(true)\n    const that = this\n    return createCesiumObject().then(async (cesiumObject) => {\n      that.originInstance = cesiumObject\n      // Load the created Cesium object. 加载创建的 Cesium 对象。\n      return mount().then(() => {\n        $parent.children.push(this)\n        that._mounted = true\n        // Trigger the component's 'ready' event. 触发该组件的 'ready' 事件。\n        that.$emit('ready', { Cesium, viewer, cesiumObject, vm: that })\n        return { Cesium, viewer, cesiumObject, vm: that }\n      })\n    })\n  },\n  /**\n   * Unloading components asynchronously. 异步卸载组件。\n   * @returns {Promise<Boolean>} returns true on success and false on failure. 成功返回 true，失败返回 false。\n   */\n  async unload () {\n    await this.beforeUnload()\n\n    // If the component has subcomponents, you need to remove the subcomponents first. 如果该组件带有子组件，需要先移除子组件。\n    for (let i = 0; i < this.children.length; i++) {\n      const vcChildCmp = this.children[i]\n      await vcChildCmp.unload()\n    }\n    const that = this\n    return this._mounted\n      ? this.unmount().then(async () => {\n          // Teardown the watchers. 注销 Vue 侦听器。\n          that.setPropWatchers(false)\n          that.originInstance = undefined\n          that._mounted = false\n          // If the component cannot be rendered without the parent component, the parent component needs to be removed.\n          // 如果该组件的渲染和父组件是绑定在一起的，需要移除父组件。\n          return that.renderByParent && !this.unloadingPromise ? that.$parent.unload() : true\n        })\n      : false\n  },\n  /**\n   * Reload components asynchronously. 异步重载组件.\n   * @returns {Promise<Boolean>} returns true on success and false on failure. 成功返回 true，失败返回 false。\n   */\n  async reload () {\n    const that = this\n    return this.unload().then(() => {\n      return that.load()\n    })\n  },\n  /**\n   * Create Cesium objects asynchronously. 异步创建 Cesium 对象。\n   * @returns {Promise<Object>} return the Cesium object.\n   */\n  async createCesiumObject () {\n    const { $props, cesiumClass, transformProps } = this\n    const options = transformProps($props)\n    return new Cesium[cesiumClass](options)\n  },\n  /**\n   * Register or unregister the vue watchers.\n   * @param {Boolean} register\n   */\n  setPropWatchers (register) {\n    if (register) {\n      const { cesiumClass, transformProp } = this\n      if (!cesiumClass || !Cesium[cesiumClass]) {\n        return\n      }\n      const that = this\n      that.$options.props &&\n        Object.keys(that.$options.props).forEach((vueProp) => {\n          let cesiumProp = vueProp\n          if (vueProp === 'labelStyle' || vueProp === 'wmtsStyle') {\n            cesiumProp = 'style'\n          } else if (vueProp === 'bmKey') {\n            cesiumProp = 'key'\n          }\n          // 如果在vue文件中已经监听了改 props 这儿不再监听了\n          // If you have listened to the props in the vue file, you will not add any more listeners here.\n          if (that.$options.watch && that.$options.watch[vueProp]) {\n            return\n          }\n          const watcherOptions = that.$options.props[vueProp].watcherOptions\n\n          // returns an unwatch function that stops firing the callback\n          const unwatch = that.$watch(\n            vueProp,\n            async (val) => {\n              // Wait for child components to be created.\n              // 等待子组件创建完成。否则在父组件的 `ready` 事件中就改变的属性将不起作用。\n              await that.createPromise\n              const { cesiumObject } = that\n              // Get the writability of the current cesiumobject or the props on its prototype chain to\n              // detect whether the component property responds dynamically or reloads the component when the property changes.\n              // 通过 cesiumObject 对象或它原型链上的 prop 的可写性，以检测属性改变时组件属性是动态响应还是重载组件。\n              const pd = cesiumObject && Object.getOwnPropertyDescriptor(cesiumObject, cesiumProp)\n              const pdProto = cesiumObject && Object.getOwnPropertyDescriptor(Object.getPrototypeOf(cesiumObject), cesiumProp)\n              const hasSetter = (pd && (pd.writable || pd.set)) || (pdProto && (pdProto.writable || pdProto.set))\n              if (hasSetter) {\n                // Attributes are writable and directly respond to changes in attributes.\n                // 属性可写，直接动态响应属性的改变。\n                if (watcherOptions && watcherOptions.cesiumObjectBuilder) {\n                  const newVal = watcherOptions.cesiumObjectBuilder.call(that, val, that.viewer.scene.globe.ellipsoid)\n                  // If an exclude condition has been defined for the object, such as \"_callback\", Cesium will automatically handle it internally and no longer need to be assigned.\n                  // 如果对象已经定义了 exclude 条件，如已经定义了“_callback”，Cesium 内部会自动处理的 不用再赋值了。\n                  if (!(Cesium.defined(cesiumObject[cesiumProp]) && Cesium.defined(cesiumObject[cesiumProp]._callback))) {\n                    cesiumObject[cesiumProp] = newVal\n                  }\n                } else {\n                  cesiumObject[cesiumProp] = transformProp(cesiumProp, val)\n                }\n                return true\n              } else {\n                // The attribute is not writable, and the property is changed indirectly through reloading the component.\n                // 属性不可写，通过重加载组件间接实现改变属性\n                return that.reload()\n              }\n            },\n            { deep: watcherOptions && watcherOptions.deep }\n          )\n          that.unwatchFns.push(unwatch)\n        })\n    } else {\n      // Stops firing the callback.\n      // 注销 watchers。\n      this.unwatchFns.forEach((item) => item())\n      this.unwatchFns = []\n    }\n  },\n  /**\n   * Mount Cesium objects asynchronously. 异步挂载 Cesium 对象，即将 Cesium 对象添加到 viewer 中。虚方法，在各 vue 组件中实现。\n   * @returns {Promise<Boolean>} 操作成功返回 true，失败返回 false。\n   */\n  async mount () {\n    return true\n  },\n  /**\n   * Unmount Cesium objects asynchronously. 异步卸载 Cesium 对象，即将 Cesium 对象从 viewer 移除。虚方法，在各 vue 组件中实现。\n   * @returns {Promise<Boolean>} 操作成功返回 true，失败返回 false。\n   */\n  async unmount () {\n    return true\n  },\n  /**\n   * Get the injected object. 获取注入的对象。主要是为了获取父组件和父组件的 Cesium 对象。\n   * @returns {Object}\n   */\n  getServices () {\n    return services.methods.getServices.call(this)\n  },\n  /**\n   * 将 props 转换为 Cesium 对象\n   * @param {Object} props\n   */\n  transformProps (props) {\n    const { cesiumClass } = this\n    const options = {}\n    const that = this\n    props &&\n      Object.keys(props).forEach((vueProp) => {\n        let cesiumProp = vueProp\n        // The properties of the following Cesium instance objects are HTML or Vue reserved words and require special handling.\n        // 以下 Cesium 实例对象的属性是 HTML 或 Vue 保留字，需要特别处理一下。\n        if (vueProp === 'labelStyle' || vueProp === 'wmtsStyle') {\n          cesiumProp = 'style'\n        } else if (vueProp === 'bmKey') {\n          cesiumProp = 'key'\n        }\n\n        if (\n          graphics.indexOf(cesiumProp) !== -1 &&\n          (getClassName(props[vueProp]) !== 'undefined' && getClassName(props[vueProp]).indexOf('Graphics') === -1) &&\n          (cesiumClass === 'Entity' || cesiumClass.indexOf('DataSource') !== -1)\n        ) {\n          options[cesiumProp] = that.transformProps(props[vueProp])\n        } else {\n          options[cesiumProp] = that.transformProp(vueProp, props[vueProp])\n        }\n      })\n\n    // Remove empty objects to avoid initialization errors when Cesium objects are initialized with null values.\n    // 移除空对象，避免 Cesium 对象初始化时传入空值导致初始化报错。\n    this.removeNullItem(options)\n    return options\n  },\n  transformProp (prop, value) {\n    const { isEmptyObj, cesiumClass } = this\n\n    if (\n      graphics.indexOf(prop) !== -1 &&\n      (getClassName(value) !== 'undefined' && getClassName(value).indexOf('Graphics') === -1) &&\n      (cesiumClass === 'Entity' || cesiumClass.indexOf('DataSource') !== -1)\n    ) {\n      return this.transformProps(value)\n    } else {\n      const cmpName = this.$options.name\n      const propOptions = allProps[prop] && allProps[prop].props[prop]\n      return propOptions && propOptions.watcherOptions && !isEmptyObj(value)\n        ? propOptions.watcherOptions.cesiumObjectBuilder.call(this, value, this.viewer.scene.globe.ellipsoid)\n        : isFunction(value) && (cmpName && (cmpName.indexOf('graphics') !== -1 || cmpName === 'vc-entity'))\n          ? new Cesium.CallbackProperty(value, false)\n          : value\n    }\n  },\n  /**\n   * The action before the component is loaded. 组件加载前的操作。\n   */\n  async beforeLoad () {\n    if (this.$parent.nowaiting) {\n      return true\n    } else {\n      await this.$parent.createPromise\n    }\n  },\n  async beforeUnload () {\n    await this.unloadingPromise\n  },\n  /**\n   * 获取 vc-viewer 组件\n   */\n  getVcParent: getVcParent\n}\n/**\n * VueCesium common minxin\n */\nexport default {\n  VM_PROP,\n  mixins: [services],\n  methods,\n  data () {\n    return {\n      unwatchFns: []\n    }\n  },\n  created () {\n    this._mounted = false\n    this.cesiumClass = this.cesiumClass || nameClassMap[this.$options.name]\n    this.children = []\n    const $parent = getVcParent(this)\n    this._createPromise = new Promise((resolve, reject) => {\n      try {\n        let isLoading = false\n        if (this.$services.viewer) {\n          isLoading = true\n          this.load().then((e) => {\n            resolve(e)\n            isLoading = false\n          })\n        }\n\n        $parent.$on('ready', () => {\n          if (!isLoading) {\n            resolve(this.load())\n          }\n        })\n      } catch (e) {\n        reject(e)\n      }\n    })\n\n    Object.defineProperties(this, {\n      createPromise: {\n        enumerable: true,\n        get: () => this._createPromise\n      },\n      cesiumObject: {\n        enumerable: true,\n        get: () => this.originInstance\n      },\n      mounted: {\n        enumerable: true,\n        get: () => this._mounted\n      }\n    })\n  },\n  beforeDestroy () {\n    this.unloadingPromise = new Promise((resolve, reject) => {\n      this.unload().then(() => {\n        resolve(true)\n        this.unloadingPromise = undefined\n        this.$emit('destroyed', this)\n      })\n    })\n  }\n}\n\nfunction getClassName (objClass) {\n  if (objClass && objClass.constructor) {\n    const strFun = objClass.constructor.toString()\n    let className = strFun.substr(0, strFun.indexOf('('))\n    className = className.replace('function', '')\n    return className.replace(/(^\\s*)|(\\s*$)/gi, '')\n  }\n  return typeof objClass\n}\n"],"names":["VM_PROP","graphics","getVcParent","cmp","parentVm","$parent","cesiumClass","$options","name","methods","load","_mounted","beforeLoad","createCesiumObject","mount","setPropWatchers","Cesium","viewer","cesiumObject","nowaiting","that","then","originInstance","children","push","$emit","vm","unload","beforeUnload","i","length","vcChildCmp","unmount","undefined","renderByParent","unloadingPromise","reload","$props","transformProps","options","register","transformProp","props","forEach","vueProp","cesiumProp","watch","watcherOptions","unwatch","$watch","val","createPromise","pd","pdProto","hasSetter","writable","set","cesiumObjectBuilder","newVal","call","scene","globe","ellipsoid","defined","_callback","deep","unwatchFns","item","getServices","services","indexOf","getClassName","removeNullItem","prop","value","isEmptyObj","cmpName","propOptions","allProps","isFunction","CallbackProperty","mixins","data","created","nameClassMap","_createPromise","resolve","reject","isLoading","$services","e","$on","Object","defineProperties","enumerable","get","mounted","beforeDestroy","objClass","constructor","strFun","toString","className","substr","replace"],"mappings":"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"}