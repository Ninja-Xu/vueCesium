{"version":3,"file":"mixinPrimitive.js","sources":["src/mixins/primitives/mixinPrimitive.js"],"sourcesContent":["/**\n * for\n * ClassificationPrimitive\n * GroundPolylinePrimitive\n * GroundPrimitive\n * Model\n * Cesium3DTileset\n * Primitive\n */\nimport cmp from '../virtualCmp'\nimport mergeDescriptors from '../../utils/mergeDescriptors'\nimport bindEvents from '../../utils/bindEvent'\nimport mixinPickEvent from '../event/mixinPickEvent'\n\nconst methods = {\n  async mount () {\n    const { primitives, primitive, registerEvents } = this\n    primitive.readyPromise && primitive.readyPromise.then(primitive => {\n      const listener = this.$listeners.readyPromise\n      listener && this.$emit('readyPromise', primitive)\n    }).otherwise(error => {\n      throw new Cesium.DeveloperError(error)\n    })\n    bindEvents.call(this, primitive, undefined, true)\n    registerEvents(true)\n    primitive._vcParent = primitives\n    return primitives && primitives.add(primitive)\n  },\n  async unmount () {\n    const { primitives, primitive, registerEvents } = this\n    this.childCount = 0\n    this.instances = []\n    bindEvents.call(this, primitive, undefined, false)\n    registerEvents(false)\n    return primitives && primitives.remove(primitive)\n  },\n  async setGeometryInstances (geometryInstance, index) {\n    this.instances.push(geometryInstance)\n    if (index === this.childCount - 1) {\n      const listener = this.$listeners['update:geometryInstances']\n      if (listener) {\n        this.$emit('update:geometryInstances', this.instances)\n      } else {\n        this.primitive.geometryInstances = index === 0 ? geometryInstance : this.instances\n      }\n    }\n    return true\n  },\n  getServices () {\n    const vm = this\n    return mergeDescriptors(cmp.methods.getServices.call(this), {\n      get primitive () {\n        return vm.primitive\n      },\n      get primitiveContainer () {\n        return vm\n      }\n    })\n  }\n}\n\nexport default {\n  data () {\n    return {\n      childCount: 0,\n      instances: []\n    }\n  },\n  props: {\n    enableEvent: {\n      type: Boolean,\n      default: true\n    }\n  },\n  mixins: [cmp, mixinPickEvent],\n  methods,\n  stubVNode: {\n    attrs () {\n      return {\n        class: this.$options.name\n      }\n    }\n  },\n  created () {\n    Object.defineProperties(this, {\n      primitive: {\n        enumerable: true,\n        get: () => this.cesiumObject\n      },\n      primitives: {\n        enumerable: true,\n        get: () => this.$services && this.$services.primitives\n      },\n      groundPrimitives: {\n        enumerable: true,\n        get: () => this.$services && this.$services.groundPrimitives\n      }\n    })\n  }\n}\n"],"names":["methods","mount","primitives","primitive","registerEvents","readyPromise","then","listener","$listeners","$emit","otherwise","error","Cesium","DeveloperError","bindEvents","call","undefined","_vcParent","add","unmount","childCount","instances","remove","setGeometryInstances","geometryInstance","index","push","geometryInstances","getServices","vm","mergeDescriptors","cmp","primitiveContainer","data","props","enableEvent","type","Boolean","default","mixins","mixinPickEvent","stubVNode","attrs","class","$options","name","created","Object","defineProperties","enumerable","get","cesiumObject","$services","groundPrimitives"],"mappings":"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"}