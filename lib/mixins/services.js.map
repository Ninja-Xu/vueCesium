{"version":3,"file":"services.js","sources":["src/mixins/services.js"],"sourcesContent":["import mergeDescriptors from '../utils/mergeDescriptors'\nimport { isEmptyObj } from '../utils/util'\n\nconst SERVICES_PROP = 'services'\n/**\n * 全局注入 provider 的数据\n */\nexport default {\n  inject: {\n    $services: SERVICES_PROP\n  },\n  provide () {\n    return {\n      [SERVICES_PROP]: this.getServices()\n    }\n  },\n  methods: {\n    /**\n     *  获取注入数据。\n     * @returns {Object}\n     * @protected\n     */\n    getServices () {\n      return mergeDescriptors({}, this.$services || {})\n    },\n    /**\n     * 移除对象中的空值。\n     * @param {*} o\n     * @param {*} arr\n     * @param {*} i\n     * @returns {Object}\n     */\n    removeNullItem: removeNullItem,\n    /**\n     * 判断是否是空对象。\n     * @param {*} o\n     * @returns {Boolean}\n     */\n    isEmptyObj: isEmptyObj\n\n  },\n  beforeCreate () {\n    let source = this.$parent\n    while (source) {\n      if (source._provided != null && source._provided[SERVICES_PROP] != null) {\n        break\n      }\n      source = source.$parent\n    }\n    if (source == null || source._provided[SERVICES_PROP] == null) {\n      delete this.$options.inject.$services\n    }\n  }\n}\n\n/**\n * 处理对象。\n * @param {*} o\n */\nfunction proccessObject (o) {\n  for (const attr in o) {\n    if (o[attr] === null || o[attr] === undefined) delete o[attr]\n    else if (typeof o[attr] === 'object') {\n      // this.removeNullItem(o[attr])\n      if (isEmptyObj(o[attr])) delete o[attr]\n    }\n  }\n}\n\n/**\n * 处理数组。\n * @param {*} arr\n */\nfunction processArray (arr) {\n  for (let i = arr.length - 1; i >= 0; i--) {\n    /* if (arr[i] === null || arr[i] === undefined) arr.splice(i, 1);\n            else */ if (\n      typeof arr[i] === 'object'\n    ) {\n      removeNullItem(arr[i], arr, i)\n    }\n  }\n  return arr.length === 0\n}\n\n/**\n  * 移除对象中的空值。\n  * @param {*} o\n  * @param {*} arr\n  * @param {*} i\n  * @returns {Object}\n  */\nfunction removeNullItem (o, arr, i) {\n  const s = {}.toString.call(o)\n  if (s === '[object Array]') {\n    if (processArray(o) === true) {\n      // o也是数组，并且删除完子项，从所属数组中删除\n      // if (arr) arr.splice(i, 1);\n    }\n  } else if (s === '[object Object]') {\n    proccessObject(o)\n    // if (arr&&isEmptyObj(o)) arr.splice(i, 1);\n  }\n}\n"],"names":["SERVICES_PROP","inject","$services","provide","getServices","methods","mergeDescriptors","removeNullItem","isEmptyObj","beforeCreate","source","$parent","_provided","$options","proccessObject","o","attr","undefined","processArray","arr","i","length","s","toString","call"],"mappings":";;;;;;;;;;;;;;;;AAGA,IAAMA,aAAa,GAAG,UAAtB;AACA;AACA;AACA;;AACA,eAAe;AACbC,EAAAA,MAAM,EAAE;AACNC,IAAAA,SAAS,EAAEF;AADL,GADK;AAIbG,EAAAA,OAJa,qBAIF;AACT,+BACGH,aADH,EACmB,KAAKI,WAAL,EADnB;AAGD,GARY;AASbC,EAAAA,OAAO,EAAE;AACP;AACJ;AACA;AACA;AACA;AACID,IAAAA,WANO,yBAMQ;AACb,aAAOE,gBAAgB,CAAC,EAAD,EAAK,KAAKJ,SAAL,IAAkB,EAAvB,CAAvB;AACD,KARM;;AASP;AACJ;AACA;AACA;AACA;AACA;AACA;AACIK,IAAAA,cAAc,EAAEA,cAhBT;;AAiBP;AACJ;AACA;AACA;AACA;AACIC,IAAAA,UAAU,EAAEA;AAtBL,GATI;AAkCbC,EAAAA,YAlCa,0BAkCG;AACd,QAAIC,MAAM,GAAG,KAAKC,OAAlB;;AACA,WAAOD,MAAP,EAAe;AACb,UAAIA,MAAM,CAACE,SAAP,IAAoB,IAApB,IAA4BF,MAAM,CAACE,SAAP,CAAiBZ,aAAjB,KAAmC,IAAnE,EAAyE;AACvE;AACD;;AACDU,MAAAA,MAAM,GAAGA,MAAM,CAACC,OAAhB;AACD;;AACD,QAAID,MAAM,IAAI,IAAV,IAAkBA,MAAM,CAACE,SAAP,CAAiBZ,aAAjB,KAAmC,IAAzD,EAA+D;AAC7D,aAAO,KAAKa,QAAL,CAAcZ,MAAd,CAAqBC,SAA5B;AACD;AACF;AA7CY,CAAf;AAgDA;AACA;AACA;AACA;;AACA,SAASY,cAAT,CAAyBC,CAAzB,EAA4B;AAC1B,OAAK,IAAMC,IAAX,IAAmBD,CAAnB,EAAsB;AACpB,QAAIA,CAAC,CAACC,IAAD,CAAD,KAAY,IAAZ,IAAoBD,CAAC,CAACC,IAAD,CAAD,KAAYC,SAApC,EAA+C,OAAOF,CAAC,CAACC,IAAD,CAAR,CAA/C,KACK,IAAI,QAAOD,CAAC,CAACC,IAAD,CAAR,MAAmB,QAAvB,EAAiC;AACpC;AACA,UAAIR,UAAU,CAACO,CAAC,CAACC,IAAD,CAAF,CAAd,EAAyB,OAAOD,CAAC,CAACC,IAAD,CAAR;AAC1B;AACF;AACF;AAED;AACA;AACA;AACA;;;AACA,SAASE,YAAT,CAAuBC,GAAvB,EAA4B;AAC1B,OAAK,IAAIC,CAAC,GAAGD,GAAG,CAACE,MAAJ,GAAa,CAA1B,EAA6BD,CAAC,IAAI,CAAlC,EAAqCA,CAAC,EAAtC,EAA0C;AACxC;AACJ;AAAoB,QACd,QAAOD,GAAG,CAACC,CAAD,CAAV,MAAkB,QADJ,EAEd;AACAb,MAAAA,cAAc,CAACY,GAAG,CAACC,CAAD,CAAJ,CAAd;AACD;AACF;;AACD,SAAOD,GAAG,CAACE,MAAJ,KAAe,CAAtB;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASd,cAAT,CAAyBQ,CAAzB,EAA4BI,GAA5B,EAAiCC,CAAjC,EAAoC;AAClC,MAAME,CAAC,GAAG,GAAGC,QAAH,CAAYC,IAAZ,CAAiBT,CAAjB,CAAV;;AACA,MAAIO,CAAC,KAAK,gBAAV,EAA4B;AAC1B,QAAIJ,YAAY,CAACH,CAAD,CAAZ,KAAoB,IAAxB,EAA8B;AAI/B,GALD,MAKO,IAAIO,CAAC,KAAK,iBAAV,EAA6B;AAClCR,IAAAA,cAAc,CAACC,CAAD,CAAd,CADkC;AAGnC;AACF;;;;"}