{"version":3,"file":"mixinDraw.js","sources":["src/mixins/tool/mixinDraw.js"],"sourcesContent":["import cmp from '../virtualCmp'\n\nconst props = {\n  mode: {\n    type: Number,\n    default: 1\n  },\n  show: {\n    type: Boolean,\n    default: true\n  },\n  pointColor: {\n    type: String | Object | Array,\n    default: 'rgb(255,229,0)'\n  },\n  pointPixelSize: {\n    type: Number,\n    default: 8\n  },\n  editable: {\n    type: Boolean,\n    default: false\n  },\n  showDrawTip: {\n    type: Boolean,\n    default: true\n  }\n}\nconst watch = {\n  editable(val) {\n    if (!val) {\n      this.showToolbar = false\n    } else {\n      this.drawing = false\n    }\n  },\n  async drawing(val) {\n    let nextTick = false\n    const { polylines, startNew, drawType, getVcParent } = this\n    const polyline = polylines[polylines.length - 1]\n    if (!val && polyline && !polyline.positions.length) {\n      this.polylines.pop()\n      this.showTooltip = false\n    } else if (val) {\n      const drawCmpNames = []\n      switch (drawType) {\n        case 'pointDrawing':\n          drawCmpNames.push('vc-handler-draw-polyline')\n          drawCmpNames.push('vc-handler-draw-polygon')\n          break\n        case 'polylineDrawing':\n          drawCmpNames.push('vc-handler-draw-point')\n          drawCmpNames.push('vc-handler-draw-polygon')\n          break\n        case 'polygonDrawing':\n          drawCmpNames.push('vc-handler-draw-polyline')\n          drawCmpNames.push('vc-handler-draw-point')\n          break\n      }\n      const measureCmpNames = ['vc-measure-height', 'vc-measure-distance', 'vc-measure-area']\n      for (const $node of getVcParent(this).$slots.default || []) {\n        if ($node.componentOptions && drawCmpNames.indexOf($node.componentOptions.tag) !== -1) {\n          $node.child.drawing = false\n          nextTick = true\n        }\n        if ($node.componentOptions && measureCmpNames.indexOf($node.componentOptions.tag) !== -1) {\n          $node.child.measuring = false\n          nextTick = true\n        }\n      }\n\n      startNew()\n      this.showTooltip = true\n    } else {\n      this.showTooltip = false\n    }\n\n    if (!this.showTooltip) {\n      this.tooltipPosition = [0, 0, 0]\n    }\n    nextTick && await this.$nextTick()\n    this.viewer.canvas.setAttribute('style', val ? 'cursor: crosshair' : 'cursor: auto')\n    const listener = this.$listeners.activeEvt\n    listener && this.$emit('activeEvt', { type: drawType, isActive: val })\n  }\n}\n\nconst computed = {\n  points() {\n    const points = []\n    this.polylines.forEach((polyline, index) => {\n      polyline.positions.forEach((position, subIndex) => {\n        const point = {\n          color: this.pointColor,\n          pixelSize: this.pointPixelSize,\n          position: position,\n          polylineIndex: index,\n          positionIndex: subIndex\n        }\n        points.push(point)\n      })\n    })\n    return points\n  }\n}\nconst methods = {\n  async createCesiumObject() {\n    const { viewer } = this\n    const handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas)\n    handler.setInputAction(this.LEFT_CLICK, Cesium.ScreenSpaceEventType.LEFT_CLICK)\n    handler.setInputAction(this.MOUSE_MOVE, Cesium.ScreenSpaceEventType.MOUSE_MOVE)\n    handler.setInputAction(this.RIGHT_CLICK, Cesium.ScreenSpaceEventType.RIGHT_CLICK)\n    this.handler = handler\n    return this.polylines\n  },\n  async mount() {\n    return true\n  },\n  async unload() {\n    return true\n  },\n  LEFT_CLICK(movement) {\n    if (!this.drawing) {\n      return\n    }\n\n    if (this.editingPoint) {\n      this.RIGHT_CLICK(movement)\n      return\n    }\n\n    const { Cesium, viewer, polylines, onDrawingEvt } = this\n    // const cartesian = viewer.scene.pickPosition(movement.position)\n    var pick1 = new Cesium.Cartesian2(movement.position);\n\n    var cartesian = viewer.scene.globe.pick(viewer.camera.getPickRay(pick1), viewer.scene)\n    if (!Cesium.defined(cartesian)) {\n      return\n    }\n    const nIndex = polylines.length - 1\n    const polyline = polylines[nIndex]\n    polyline.positions.push(cartesian)\n    onDrawingEvt(polyline, nIndex)\n  },\n  async MOUSE_MOVE(movement) {\n    if (!this.drawing) {\n      return\n    }\n    const { Cesium, viewer, polylines, onDrawingEvt, drawType } = this\n\n    // const cartesian = viewer.scene.pickPosition(movement.endPosition)\n    var pick1 = new Cesium.Cartesian2(movement.endPosition);\n\n    var cartesian = viewer.scene.globe.pick(viewer.camera.getPickRay(pick1), viewer.scene)\n    if (!Cesium.defined(cartesian)) {\n      return\n    }\n\n    this.tooltipPosition = cartesian\n    this.tooltip = this.$vc.lang.draw.drawingTip1\n    if (!polylines.length) {\n      return\n    }\n    const nIndex = this.editingPoint ? this.editingPoint.polylineIndex : polylines.length - 1\n    const polyline = polylines[nIndex]\n    if (!polyline.positions.length) {\n      return\n    }\n\n    if (polyline.positions.length >= 2) {\n      this.tooltip = this.editingPoint ? this.$vc.lang.draw.drawingTip3 : this.$vc.lang.draw.drawingTip2\n    }\n\n    if (this.editingPoint) {\n      polyline.positions.splice(this.editingPoint.positionIndex, 1, cartesian)\n    } else {\n      if (polyline.positions.length >= 2) {\n        polyline.positions.pop()\n      }\n      polyline.positions.push(cartesian)\n    }\n\n    const listener = this.$listeners.movingEvt\n    listener && this.$emit('movingEvt', movement.endPosition, drawType)\n    onDrawingEvt(polyline, nIndex)\n  },\n  async RIGHT_CLICK(movement) {\n    if (!this.drawing) {\n      return\n    }\n    const { viewer, polylines, mode, startNew, onDrawingEvt } = this\n    if (!polylines.length) {\n      return\n    }\n    const nIndex = this.editingPoint ? this.editingPoint.polylineIndex : polylines.length - 1\n    // const nIndex = polylines.length - 1\n    const polyline = polylines[nIndex]\n    if (polyline.positions.length === 0) {\n      return\n    }\n    // const cartesian = viewer.scene.pickPosition(movement.position)\n    var pick1 = new Cesium.Cartesian2(movement.position);\n\n    var cartesian = viewer.scene.globe.pick(viewer.camera.getPickRay(pick1), viewer.scene)\n    if (!Cesium.defined(cartesian)) {\n      return\n    }\n    if (!this.editingPoint) {\n      if (polyline.positions.length > 1) {\n        polyline.positions.pop()\n      }\n\n      if (mode === 0) {\n        startNew()\n      } else {\n        this.drawing = false\n      }\n    } else {\n      this.editingPoint = undefined\n      this.drawing = false\n    }\n\n    await this.$nextTick()\n    onDrawingEvt(polyline, nIndex, true)\n  },\n  startNew() {\n    const { polylines } = this\n    const poyline = {\n      positions: []\n    }\n    Cesium.defined(polylines) && polylines.push(poyline)\n  },\n  clear() {\n    this.polylines = []\n    this.drawing = false\n  },\n  onDrawingEvt(polyline, index, flag = false) {\n    this.index = index\n    if (!this.depthTest) {\n      const rs = Cesium.RenderState.fromCache({\n        depthMask: true,\n        depthTest: {\n          enabled: false\n        }\n      })\n      this.$refs.pointCollection && (this.$refs.pointCollection.cesiumObject._rsOpaque = rs)\n      if (Cesium.SuperMapImageryProvider) {\n        this.$refs.polylineCollection && (this.$refs.polylineCollection.cesiumObject._opaqueRS = rs)\n      } else {\n        this.$refs.polylineCollection && (this.$refs.polylineCollection.cesiumObject._opaqueRS.depthTest.enabled = false)\n      }\n    }\n    const listener = this.$listeners.drawEvt\n    listener &&\n      this.$emit('drawEvt', {\n        polyline: polyline,\n        type: this.drawType,\n        finished: flag\n      })\n  },\n  pointMouseOver(e) {\n    if (!this.editable) {\n      return\n    }\n\n    if (this.editingPoint) {\n      return\n    }\n\n    e.pickedFeature.primitive.pixelSize = this.pointPixelSize * 2.0\n    this.toolbarPosition = e.pickedFeature.primitive.position\n    this.showToolbar = true\n    this.mouseoverPoint = e.pickedFeature.primitive\n  },\n  pointMouseOut(e) {\n    if (!this.editable) {\n      return\n    }\n    e.pickedFeature.primitive.pixelSize = this.pointPixelSize * 1.0\n    this.toolbarPosition = [0, 0, 0]\n    this.showToolbar = false\n    this.mouseoverPoint = undefined\n  },\n  onEditClick(e) {\n    this.editType = e\n    this.toolbarPosition = [0, 0, 0]\n    this.showToolbar = false\n\n    if (!this.editable) {\n      return\n    }\n\n    this.drawing = false\n\n    if (e === 'delete') {\n      const nIndex = this.mouseoverPoint.polylineIndex\n      const polyline = this.polylines[nIndex]\n      polyline.positions.splice(this.mouseoverPoint.positionIndex, 1)\n    } else if (e === 'insert') {\n      const nIndex = this.mouseoverPoint.polylineIndex\n      const polyline = this.polylines[nIndex]\n      polyline.positions.splice(this.mouseoverPoint.positionIndex, 0, this.mouseoverPoint.position)\n      this.editingPoint = this.mouseoverPoint\n      this.drawing = true\n    } else {\n      this.editingPoint = this.mouseoverPoint\n      this.drawing = true\n    }\n  }\n}\n\nexport default {\n  mixins: [cmp],\n  data() {\n    return {\n      drawing: false,\n      polylines: [],\n      toolbarPosition: [0, 0, 0],\n      showToolbar: false,\n      tooltipPosition: [0, 0, 0],\n      showTooltip: false,\n      tooltip: ''\n    }\n  },\n  props,\n  watch,\n  computed,\n  methods,\n  destroyed() {\n    const { handler } = this\n    if (handler) {\n      handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK)\n      handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)\n      handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)\n      handler.destroy()\n    }\n  }\n}\n"],"names":["props","mode","type","Number","default","show","Boolean","pointColor","String","Object","Array","pointPixelSize","editable","showDrawTip","watch","val","showToolbar","drawing","nextTick","polylines","startNew","drawType","getVcParent","polyline","length","positions","pop","showTooltip","drawCmpNames","push","measureCmpNames","$slots","$node","componentOptions","indexOf","tag","child","measuring","tooltipPosition","$nextTick","viewer","canvas","setAttribute","listener","$listeners","activeEvt","$emit","isActive","computed","points","forEach","index","position","subIndex","point","color","pixelSize","polylineIndex","positionIndex","methods","createCesiumObject","handler","Cesium","ScreenSpaceEventHandler","setInputAction","LEFT_CLICK","ScreenSpaceEventType","MOUSE_MOVE","RIGHT_CLICK","mount","unload","movement","editingPoint","onDrawingEvt","pick1","Cartesian2","cartesian","scene","globe","pick","camera","getPickRay","defined","nIndex","endPosition","tooltip","$vc","lang","draw","drawingTip1","drawingTip3","drawingTip2","splice","movingEvt","undefined","poyline","clear","flag","depthTest","rs","RenderState","fromCache","depthMask","enabled","$refs","pointCollection","cesiumObject","_rsOpaque","SuperMapImageryProvider","polylineCollection","_opaqueRS","drawEvt","finished","pointMouseOver","e","pickedFeature","primitive","toolbarPosition","mouseoverPoint","pointMouseOut","onEditClick","editType","mixins","cmp","data","destroyed","removeInputAction","destroy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,KAAK,GAAG;AACZC,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAEC,MADF;AAEJC,IAAAA,OAAO,EAAE;AAFL,GADM;AAKZC,EAAAA,IAAI,EAAE;AACJH,IAAAA,IAAI,EAAEI,OADF;AAEJF,IAAAA,OAAO,EAAE;AAFL,GALM;AASZG,EAAAA,UAAU,EAAE;AACVL,IAAAA,IAAI,EAAEM,MAAM,GAAGC,MAAT,GAAkBC,KADd;AAEVN,IAAAA,OAAO,EAAE;AAFC,GATA;AAaZO,EAAAA,cAAc,EAAE;AACdT,IAAAA,IAAI,EAAEC,MADQ;AAEdC,IAAAA,OAAO,EAAE;AAFK,GAbJ;AAiBZQ,EAAAA,QAAQ,EAAE;AACRV,IAAAA,IAAI,EAAEI,OADE;AAERF,IAAAA,OAAO,EAAE;AAFD,GAjBE;AAqBZS,EAAAA,WAAW,EAAE;AACXX,IAAAA,IAAI,EAAEI,OADK;AAEXF,IAAAA,OAAO,EAAE;AAFE;AArBD,CAAd;AA0BA,IAAMU,KAAK,GAAG;AACZF,EAAAA,QADY,oBACHG,GADG,EACE;AACZ,QAAI,CAACA,GAAL,EAAU;AACR,WAAKC,WAAL,GAAmB,KAAnB;AACD,KAFD,MAEO;AACL,WAAKC,OAAL,GAAe,KAAf;AACD;AACF,GAPW;AAQNA,EAAAA,OARM,mBAQEF,GARF,EAQO;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACbG,cAAAA,QADa,GACF,KADE;AAETC,cAAAA,SAFS,GAEsC,KAFtC,CAETA,SAFS,EAEEC,QAFF,GAEsC,KAFtC,CAEEA,QAFF,EAEYC,QAFZ,GAEsC,KAFtC,CAEYA,QAFZ,EAEsBC,WAFtB,GAEsC,KAFtC,CAEsBA,WAFtB;AAGXC,cAAAA,QAHW,GAGAJ,SAAS,CAACA,SAAS,CAACK,MAAV,GAAmB,CAApB,CAHT;;AAAA,oBAIb,CAACT,GAAD,IAAQQ,QAAR,IAAoB,CAACA,QAAQ,CAACE,SAAT,CAAmBD,MAJ3B;AAAA;AAAA;AAAA;;AAKf,cAAA,KAAI,CAACL,SAAL,CAAeO,GAAf;;AACA,cAAA,KAAI,CAACC,WAAL,GAAmB,KAAnB;AANe;AAAA;;AAAA;AAAA,mBAONZ,GAPM;AAAA;AAAA;AAAA;;AAQTa,cAAAA,YARS,GAQM,EARN;AAAA,4BASPP,QATO;AAAA,8CAUR,cAVQ,wBAcR,iBAdQ,wBAkBR,gBAlBQ;AAAA;;AAAA;AAWXO,cAAAA,YAAY,CAACC,IAAb,CAAkB,0BAAlB;AACAD,cAAAA,YAAY,CAACC,IAAb,CAAkB,yBAAlB;AAZW;;AAAA;AAeXD,cAAAA,YAAY,CAACC,IAAb,CAAkB,uBAAlB;AACAD,cAAAA,YAAY,CAACC,IAAb,CAAkB,yBAAlB;AAhBW;;AAAA;AAmBXD,cAAAA,YAAY,CAACC,IAAb,CAAkB,0BAAlB;AACAD,cAAAA,YAAY,CAACC,IAAb,CAAkB,uBAAlB;AApBW;;AAAA;AAuBTC,cAAAA,eAvBS,GAuBS,CAAC,mBAAD,EAAsB,qBAAtB,EAA6C,iBAA7C,CAvBT;AAAA,qDAwBKR,WAAW,CAAC,KAAD,CAAX,CAAkBS,MAAlB,CAAyB3B,OAAzB,IAAoC,EAxBzC;;AAAA;AAwBf,oEAA4D;AAAjD4B,kBAAAA,KAAiD;;AAC1D,sBAAIA,KAAK,CAACC,gBAAN,IAA0BL,YAAY,CAACM,OAAb,CAAqBF,KAAK,CAACC,gBAAN,CAAuBE,GAA5C,MAAqD,CAAC,CAApF,EAAuF;AACrFH,oBAAAA,KAAK,CAACI,KAAN,CAAYnB,OAAZ,GAAsB,KAAtB;AACAC,oBAAAA,QAAQ,GAAG,IAAX;AACD;;AACD,sBAAIc,KAAK,CAACC,gBAAN,IAA0BH,eAAe,CAACI,OAAhB,CAAwBF,KAAK,CAACC,gBAAN,CAAuBE,GAA/C,MAAwD,CAAC,CAAvF,EAA0F;AACxFH,oBAAAA,KAAK,CAACI,KAAN,CAAYC,SAAZ,GAAwB,KAAxB;AACAnB,oBAAAA,QAAQ,GAAG,IAAX;AACD;AACF;AAjCc;AAAA;AAAA;AAAA;AAAA;;AAmCfE,cAAAA,QAAQ;AACR,cAAA,KAAI,CAACO,WAAL,GAAmB,IAAnB;AApCe;AAAA;;AAAA;AAsCf,cAAA,KAAI,CAACA,WAAL,GAAmB,KAAnB;;AAtCe;AAyCjB,kBAAI,CAAC,KAAI,CAACA,WAAV,EAAuB;AACrB,gBAAA,KAAI,CAACW,eAAL,GAAuB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAvB;AACD;;AA3CgB,4BA4CjBpB,QA5CiB;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,qBA4CC,KAAI,CAACqB,SAAL,EA5CD;;AAAA;AA6CjB,cAAA,KAAI,CAACC,MAAL,CAAYC,MAAZ,CAAmBC,YAAnB,CAAgC,OAAhC,EAAyC3B,GAAG,GAAG,mBAAH,GAAyB,cAArE;;AACM4B,cAAAA,QA9CW,GA8CA,KAAI,CAACC,UAAL,CAAgBC,SA9ChB;AA+CjBF,cAAAA,QAAQ,IAAI,KAAI,CAACG,KAAL,CAAW,WAAX,EAAwB;AAAE5C,gBAAAA,IAAI,EAAEmB,QAAR;AAAkB0B,gBAAAA,QAAQ,EAAEhC;AAA5B,eAAxB,CAAZ;;AA/CiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgDlB;AAxDW,CAAd;AA2DA,IAAMiC,QAAQ,GAAG;AACfC,EAAAA,MADe,oBACN;AAAA;;AACP,QAAMA,MAAM,GAAG,EAAf;AACA,SAAK9B,SAAL,CAAe+B,OAAf,CAAuB,UAAC3B,QAAD,EAAW4B,KAAX,EAAqB;AAC1C5B,MAAAA,QAAQ,CAACE,SAAT,CAAmByB,OAAnB,CAA2B,UAACE,QAAD,EAAWC,QAAX,EAAwB;AACjD,YAAMC,KAAK,GAAG;AACZC,UAAAA,KAAK,EAAE,MAAI,CAAChD,UADA;AAEZiD,UAAAA,SAAS,EAAE,MAAI,CAAC7C,cAFJ;AAGZyC,UAAAA,QAAQ,EAAEA,QAHE;AAIZK,UAAAA,aAAa,EAAEN,KAJH;AAKZO,UAAAA,aAAa,EAAEL;AALH,SAAd;AAOAJ,QAAAA,MAAM,CAACpB,IAAP,CAAYyB,KAAZ;AACD,OATD;AAUD,KAXD;AAYA,WAAOL,MAAP;AACD;AAhBc,CAAjB;AAkBA,IAAMU,OAAO,GAAG;AACRC,EAAAA,kBADQ,gCACa;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACjBpB,cAAAA,MADiB,GACN,MADM,CACjBA,MADiB;AAEnBqB,cAAAA,OAFmB,GAET,IAAIC,MAAM,CAACC,uBAAX,CAAmCvB,MAAM,CAACC,MAA1C,CAFS;AAGzBoB,cAAAA,OAAO,CAACG,cAAR,CAAuB,MAAI,CAACC,UAA5B,EAAwCH,MAAM,CAACI,oBAAP,CAA4BD,UAApE;AACAJ,cAAAA,OAAO,CAACG,cAAR,CAAuB,MAAI,CAACG,UAA5B,EAAwCL,MAAM,CAACI,oBAAP,CAA4BC,UAApE;AACAN,cAAAA,OAAO,CAACG,cAAR,CAAuB,MAAI,CAACI,WAA5B,EAAyCN,MAAM,CAACI,oBAAP,CAA4BE,WAArE;AACA,cAAA,MAAI,CAACP,OAAL,GAAeA,OAAf;AANyB,gDAOlB,MAAI,CAAC1C,SAPa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQ1B,GATa;AAURkD,EAAAA,KAVQ,mBAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDACL,IADK;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEb,GAZa;AAaRC,EAAAA,MAbQ,oBAaC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDACN,IADM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEd,GAfa;AAgBdL,EAAAA,UAhBc,sBAgBHM,QAhBG,EAgBO;AACnB,QAAI,CAAC,KAAKtD,OAAV,EAAmB;AACjB;AACD;;AAED,QAAI,KAAKuD,YAAT,EAAuB;AACrB,WAAKJ,WAAL,CAAiBG,QAAjB;AACA;AACD;;AAED,QAAQT,MAAR,GAAoD,IAApD,CAAQA,MAAR;AAAA,QAAgBtB,MAAhB,GAAoD,IAApD,CAAgBA,MAAhB;AAAA,QAAwBrB,SAAxB,GAAoD,IAApD,CAAwBA,SAAxB;AAAA,QAAmCsD,YAAnC,GAAoD,IAApD,CAAmCA,YAAnC,CAVmB;;AAYnB,QAAIC,KAAK,GAAG,IAAIZ,MAAM,CAACa,UAAX,CAAsBJ,QAAQ,CAACnB,QAA/B,CAAZ;AAEA,QAAIwB,SAAS,GAAGpC,MAAM,CAACqC,KAAP,CAAaC,KAAb,CAAmBC,IAAnB,CAAwBvC,MAAM,CAACwC,MAAP,CAAcC,UAAd,CAAyBP,KAAzB,CAAxB,EAAyDlC,MAAM,CAACqC,KAAhE,CAAhB;;AACA,QAAI,CAACf,MAAM,CAACoB,OAAP,CAAeN,SAAf,CAAL,EAAgC;AAC9B;AACD;;AACD,QAAMO,MAAM,GAAGhE,SAAS,CAACK,MAAV,GAAmB,CAAlC;AACA,QAAMD,QAAQ,GAAGJ,SAAS,CAACgE,MAAD,CAA1B;AACA5D,IAAAA,QAAQ,CAACE,SAAT,CAAmBI,IAAnB,CAAwB+C,SAAxB;AACAH,IAAAA,YAAY,CAAClD,QAAD,EAAW4D,MAAX,CAAZ;AACD,GAtCa;AAuCRhB,EAAAA,UAvCQ,sBAuCGI,QAvCH,EAuCa;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACpB,MAAI,CAACtD,OADe;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAIjB6C,cAAAA,MAJiB,GAIqC,MAJrC,CAIjBA,MAJiB,EAITtB,MAJS,GAIqC,MAJrC,CAITA,MAJS,EAIDrB,SAJC,GAIqC,MAJrC,CAIDA,SAJC,EAIUsD,YAJV,GAIqC,MAJrC,CAIUA,YAJV,EAIwBpD,QAJxB,GAIqC,MAJrC,CAIwBA,QAJxB;;AAOrBqD,cAAAA,KAPqB,GAOb,IAAIZ,MAAM,CAACa,UAAX,CAAsBJ,QAAQ,CAACa,WAA/B,CAPa;AASrBR,cAAAA,SATqB,GASTpC,MAAM,CAACqC,KAAP,CAAaC,KAAb,CAAmBC,IAAnB,CAAwBvC,MAAM,CAACwC,MAAP,CAAcC,UAAd,CAAyBP,KAAzB,CAAxB,EAAyDlC,MAAM,CAACqC,KAAhE,CATS;;AAAA,kBAUpBf,MAAM,CAACoB,OAAP,CAAeN,SAAf,CAVoB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAczB,cAAA,MAAI,CAACtC,eAAL,GAAuBsC,SAAvB;AACA,cAAA,MAAI,CAACS,OAAL,GAAe,MAAI,CAACC,GAAL,CAASC,IAAT,CAAcC,IAAd,CAAmBC,WAAlC;;AAfyB,kBAgBpBtE,SAAS,CAACK,MAhBU;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAmBnB2D,cAAAA,MAnBmB,GAmBV,MAAI,CAACX,YAAL,GAAoB,MAAI,CAACA,YAAL,CAAkBf,aAAtC,GAAsDtC,SAAS,CAACK,MAAV,GAAmB,CAnB/D;AAoBnBD,cAAAA,QApBmB,GAoBRJ,SAAS,CAACgE,MAAD,CApBD;;AAAA,kBAqBpB5D,QAAQ,CAACE,SAAT,CAAmBD,MArBC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAyBzB,kBAAID,QAAQ,CAACE,SAAT,CAAmBD,MAAnB,IAA6B,CAAjC,EAAoC;AAClC,gBAAA,MAAI,CAAC6D,OAAL,GAAe,MAAI,CAACb,YAAL,GAAoB,MAAI,CAACc,GAAL,CAASC,IAAT,CAAcC,IAAd,CAAmBE,WAAvC,GAAqD,MAAI,CAACJ,GAAL,CAASC,IAAT,CAAcC,IAAd,CAAmBG,WAAvF;AACD;;AAED,kBAAI,MAAI,CAACnB,YAAT,EAAuB;AACrBjD,gBAAAA,QAAQ,CAACE,SAAT,CAAmBmE,MAAnB,CAA0B,MAAI,CAACpB,YAAL,CAAkBd,aAA5C,EAA2D,CAA3D,EAA8DkB,SAA9D;AACD,eAFD,MAEO;AACL,oBAAIrD,QAAQ,CAACE,SAAT,CAAmBD,MAAnB,IAA6B,CAAjC,EAAoC;AAClCD,kBAAAA,QAAQ,CAACE,SAAT,CAAmBC,GAAnB;AACD;;AACDH,gBAAAA,QAAQ,CAACE,SAAT,CAAmBI,IAAnB,CAAwB+C,SAAxB;AACD;;AAEKjC,cAAAA,QAtCmB,GAsCR,MAAI,CAACC,UAAL,CAAgBiD,SAtCR;AAuCzBlD,cAAAA,QAAQ,IAAI,MAAI,CAACG,KAAL,CAAW,WAAX,EAAwByB,QAAQ,CAACa,WAAjC,EAA8C/D,QAA9C,CAAZ;AACAoD,cAAAA,YAAY,CAAClD,QAAD,EAAW4D,MAAX,CAAZ;;AAxCyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyC1B,GAhFa;AAiFRf,EAAAA,WAjFQ,uBAiFIG,QAjFJ,EAiFc;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACrB,MAAI,CAACtD,OADgB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAIlBuB,cAAAA,MAJkB,GAIkC,MAJlC,CAIlBA,MAJkB,EAIVrB,SAJU,GAIkC,MAJlC,CAIVA,SAJU,EAIClB,IAJD,GAIkC,MAJlC,CAICA,IAJD,EAIOmB,QAJP,GAIkC,MAJlC,CAIOA,QAJP,EAIiBqD,YAJjB,GAIkC,MAJlC,CAIiBA,YAJjB;;AAAA,kBAKrBtD,SAAS,CAACK,MALW;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAQpB2D,cAAAA,MARoB,GAQX,MAAI,CAACX,YAAL,GAAoB,MAAI,CAACA,YAAL,CAAkBf,aAAtC,GAAsDtC,SAAS,CAACK,MAAV,GAAmB,CAR9D;;AAUpBD,cAAAA,QAVoB,GAUTJ,SAAS,CAACgE,MAAD,CAVA;;AAAA,oBAWtB5D,QAAQ,CAACE,SAAT,CAAmBD,MAAnB,KAA8B,CAXR;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAc1B;AACIkD,cAAAA,KAfsB,GAed,IAAIZ,MAAM,CAACa,UAAX,CAAsBJ,QAAQ,CAACnB,QAA/B,CAfc;AAiBtBwB,cAAAA,SAjBsB,GAiBVpC,MAAM,CAACqC,KAAP,CAAaC,KAAb,CAAmBC,IAAnB,CAAwBvC,MAAM,CAACwC,MAAP,CAAcC,UAAd,CAAyBP,KAAzB,CAAxB,EAAyDlC,MAAM,CAACqC,KAAhE,CAjBU;;AAAA,kBAkBrBf,MAAM,CAACoB,OAAP,CAAeN,SAAf,CAlBqB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAqB1B,kBAAI,CAAC,MAAI,CAACJ,YAAV,EAAwB;AACtB,oBAAIjD,QAAQ,CAACE,SAAT,CAAmBD,MAAnB,GAA4B,CAAhC,EAAmC;AACjCD,kBAAAA,QAAQ,CAACE,SAAT,CAAmBC,GAAnB;AACD;;AAED,oBAAIzB,IAAI,KAAK,CAAb,EAAgB;AACdmB,kBAAAA,QAAQ;AACT,iBAFD,MAEO;AACL,kBAAA,MAAI,CAACH,OAAL,GAAe,KAAf;AACD;AACF,eAVD,MAUO;AACL,gBAAA,MAAI,CAACuD,YAAL,GAAoBsB,SAApB;AACA,gBAAA,MAAI,CAAC7E,OAAL,GAAe,KAAf;AACD;;AAlCyB;AAAA,qBAoCpB,MAAI,CAACsB,SAAL,EApCoB;;AAAA;AAqC1BkC,cAAAA,YAAY,CAAClD,QAAD,EAAW4D,MAAX,EAAmB,IAAnB,CAAZ;;AArC0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAsC3B,GAvHa;AAwHd/D,EAAAA,QAxHc,sBAwHH;AACT,QAAQD,SAAR,GAAsB,IAAtB,CAAQA,SAAR;AACA,QAAM4E,OAAO,GAAG;AACdtE,MAAAA,SAAS,EAAE;AADG,KAAhB;AAGAqC,IAAAA,MAAM,CAACoB,OAAP,CAAe/D,SAAf,KAA6BA,SAAS,CAACU,IAAV,CAAekE,OAAf,CAA7B;AACD,GA9Ha;AA+HdC,EAAAA,KA/Hc,mBA+HN;AACN,SAAK7E,SAAL,GAAiB,EAAjB;AACA,SAAKF,OAAL,GAAe,KAAf;AACD,GAlIa;AAmIdwD,EAAAA,YAnIc,wBAmIDlD,QAnIC,EAmIS4B,KAnIT,EAmI8B;AAAA,QAAd8C,IAAc,uEAAP,KAAO;AAC1C,SAAK9C,KAAL,GAAaA,KAAb;;AACA,QAAI,CAAC,KAAK+C,SAAV,EAAqB;AACnB,UAAMC,EAAE,GAAGrC,MAAM,CAACsC,WAAP,CAAmBC,SAAnB,CAA6B;AACtCC,QAAAA,SAAS,EAAE,IAD2B;AAEtCJ,QAAAA,SAAS,EAAE;AACTK,UAAAA,OAAO,EAAE;AADA;AAF2B,OAA7B,CAAX;AAMA,WAAKC,KAAL,CAAWC,eAAX,KAA+B,KAAKD,KAAL,CAAWC,eAAX,CAA2BC,YAA3B,CAAwCC,SAAxC,GAAoDR,EAAnF;;AACA,UAAIrC,MAAM,CAAC8C,uBAAX,EAAoC;AAClC,aAAKJ,KAAL,CAAWK,kBAAX,KAAkC,KAAKL,KAAL,CAAWK,kBAAX,CAA8BH,YAA9B,CAA2CI,SAA3C,GAAuDX,EAAzF;AACD,OAFD,MAEO;AACL,aAAKK,KAAL,CAAWK,kBAAX,KAAkC,KAAKL,KAAL,CAAWK,kBAAX,CAA8BH,YAA9B,CAA2CI,SAA3C,CAAqDZ,SAArD,CAA+DK,OAA/D,GAAyE,KAA3G;AACD;AACF;;AACD,QAAM5D,QAAQ,GAAG,KAAKC,UAAL,CAAgBmE,OAAjC;AACApE,IAAAA,QAAQ,IACN,KAAKG,KAAL,CAAW,SAAX,EAAsB;AACpBvB,MAAAA,QAAQ,EAAEA,QADU;AAEpBrB,MAAAA,IAAI,EAAE,KAAKmB,QAFS;AAGpB2F,MAAAA,QAAQ,EAAEf;AAHU,KAAtB,CADF;AAMD,GA1Ja;AA2JdgB,EAAAA,cA3Jc,0BA2JCC,CA3JD,EA2JI;AAChB,QAAI,CAAC,KAAKtG,QAAV,EAAoB;AAClB;AACD;;AAED,QAAI,KAAK4D,YAAT,EAAuB;AACrB;AACD;;AAED0C,IAAAA,CAAC,CAACC,aAAF,CAAgBC,SAAhB,CAA0B5D,SAA1B,GAAsC,KAAK7C,cAAL,GAAsB,GAA5D;AACA,SAAK0G,eAAL,GAAuBH,CAAC,CAACC,aAAF,CAAgBC,SAAhB,CAA0BhE,QAAjD;AACA,SAAKpC,WAAL,GAAmB,IAAnB;AACA,SAAKsG,cAAL,GAAsBJ,CAAC,CAACC,aAAF,CAAgBC,SAAtC;AACD,GAxKa;AAyKdG,EAAAA,aAzKc,yBAyKAL,CAzKA,EAyKG;AACf,QAAI,CAAC,KAAKtG,QAAV,EAAoB;AAClB;AACD;;AACDsG,IAAAA,CAAC,CAACC,aAAF,CAAgBC,SAAhB,CAA0B5D,SAA1B,GAAsC,KAAK7C,cAAL,GAAsB,GAA5D;AACA,SAAK0G,eAAL,GAAuB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAvB;AACA,SAAKrG,WAAL,GAAmB,KAAnB;AACA,SAAKsG,cAAL,GAAsBxB,SAAtB;AACD,GAjLa;AAkLd0B,EAAAA,WAlLc,uBAkLFN,CAlLE,EAkLC;AACb,SAAKO,QAAL,GAAgBP,CAAhB;AACA,SAAKG,eAAL,GAAuB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAvB;AACA,SAAKrG,WAAL,GAAmB,KAAnB;;AAEA,QAAI,CAAC,KAAKJ,QAAV,EAAoB;AAClB;AACD;;AAED,SAAKK,OAAL,GAAe,KAAf;;AAEA,QAAIiG,CAAC,KAAK,QAAV,EAAoB;AAClB,UAAM/B,MAAM,GAAG,KAAKmC,cAAL,CAAoB7D,aAAnC;AACA,UAAMlC,QAAQ,GAAG,KAAKJ,SAAL,CAAegE,MAAf,CAAjB;AACA5D,MAAAA,QAAQ,CAACE,SAAT,CAAmBmE,MAAnB,CAA0B,KAAK0B,cAAL,CAAoB5D,aAA9C,EAA6D,CAA7D;AACD,KAJD,MAIO,IAAIwD,CAAC,KAAK,QAAV,EAAoB;AACzB,UAAM/B,OAAM,GAAG,KAAKmC,cAAL,CAAoB7D,aAAnC;AACA,UAAMlC,SAAQ,GAAG,KAAKJ,SAAL,CAAegE,OAAf,CAAjB;;AACA5D,MAAAA,SAAQ,CAACE,SAAT,CAAmBmE,MAAnB,CAA0B,KAAK0B,cAAL,CAAoB5D,aAA9C,EAA6D,CAA7D,EAAgE,KAAK4D,cAAL,CAAoBlE,QAApF;;AACA,WAAKoB,YAAL,GAAoB,KAAK8C,cAAzB;AACA,WAAKrG,OAAL,GAAe,IAAf;AACD,KANM,MAMA;AACL,WAAKuD,YAAL,GAAoB,KAAK8C,cAAzB;AACA,WAAKrG,OAAL,GAAe,IAAf;AACD;AACF;AA3Ma,CAAhB;AA8MA,gBAAe;AACbyG,EAAAA,MAAM,EAAE,CAACC,GAAD,CADK;AAEbC,EAAAA,IAFa,kBAEN;AACL,WAAO;AACL3G,MAAAA,OAAO,EAAE,KADJ;AAELE,MAAAA,SAAS,EAAE,EAFN;AAGLkG,MAAAA,eAAe,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHZ;AAILrG,MAAAA,WAAW,EAAE,KAJR;AAKLsB,MAAAA,eAAe,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CALZ;AAMLX,MAAAA,WAAW,EAAE,KANR;AAOL0D,MAAAA,OAAO,EAAE;AAPJ,KAAP;AASD,GAZY;AAabrF,EAAAA,KAAK,EAALA,KAba;AAcbc,EAAAA,KAAK,EAALA,KAda;AAebkC,EAAAA,QAAQ,EAARA,QAfa;AAgBbW,EAAAA,OAAO,EAAPA,OAhBa;AAiBbkE,EAAAA,SAjBa,uBAiBD;AACV,QAAQhE,OAAR,GAAoB,IAApB,CAAQA,OAAR;;AACA,QAAIA,OAAJ,EAAa;AACXA,MAAAA,OAAO,CAACiE,iBAAR,CAA0BhE,MAAM,CAACI,oBAAP,CAA4BD,UAAtD;AACAJ,MAAAA,OAAO,CAACiE,iBAAR,CAA0BhE,MAAM,CAACI,oBAAP,CAA4BC,UAAtD;AACAN,MAAAA,OAAO,CAACiE,iBAAR,CAA0BhE,MAAM,CAACI,oBAAP,CAA4BE,WAAtD;AACAP,MAAAA,OAAO,CAACkE,OAAR;AACD;AACF;AAzBY,CAAf;;;;"}