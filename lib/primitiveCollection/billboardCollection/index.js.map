{"version":3,"file":"index.js","sources":["src/components/primitiveCollection/billboardCollection/BillboardCollection.vue?rollup-plugin-vue=script.js","src/components/primitiveCollection/billboardCollection/BillboardCollection.vue","src/components/primitiveCollection/billboardCollection/index.js"],"sourcesContent":["\nimport { differenceBy } from 'lodash-es'\nimport { scene, blendOption, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-billboard',\n  mixins: [scene, blendOption, show, mixinPrimitiveCollection],\n  props: {\n    billboards: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    billboards: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: billboardCollection } = this\n        if (newVal === oldVal) {\n          // 插入新布告板 billboards.push()，修改布告板属性 billboards[i].xxx，或者 vm.$set(vm.billboards, indexOfBillboard, newValue)\n          if (newVal.length === billboardCollection._billboards.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                billboardCollection._billboards[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > billboardCollection._billboards.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedBillboards = differenceBy(newVal, billboardCollection._billboards, 'id')\n            if (addedBillboards.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedBillboards.length; i++) {\n              const billboard = addedBillboards[i]\n              billboard.id = billboard.id || Cesium.createGuid()\n              const billboardTransform = transformProps(billboard)\n              const billboardAdded = billboardCollection.add(billboardTransform)\n              billboardAdded.vcIndex = newVal.indexOf(billboard)\n            }\n          } else if (newVal.length < billboardCollection._billboards.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedBillboards = differenceBy(billboardCollection._billboards, newVal, 'id')\n            for (let i = 0; i < deletedBillboards.length; i++) {\n              const billboard = deletedBillboards[i]\n              billboardCollection.remove(billboard)\n            }\n            let iNull = 0\n            for (let i = 0; i < billboardCollection._billboards.length; i++) {\n              if (billboardCollection._billboards[i]) {\n                billboardCollection._billboards[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 billboard。\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, billboards } = this\n      const options = transformProps($props)\n      const billboardCollection = new Cesium.BillboardCollection(options)\n\n      for (let i = 0; i < billboards.length; i++) {\n        const billboardOptions = billboards[i]\n        billboardOptions.id = Cesium.defined(billboardOptions.id) ? billboardOptions.id : Cesium.createGuid()\n        const billboardOptionsTransform = transformProps(billboardOptions)\n        const billboard = billboardCollection.add(billboardOptionsTransform)\n        for (const prop in billboardOptionsTransform) {\n          if (!billboard[prop]) {\n            billboard[prop] = billboardOptionsTransform[prop]\n          }\n        }\n        billboard.vcIndex = i\n      }\n      return billboardCollection\n    }\n  }\n}\n","<script>\nimport { differenceBy } from 'lodash-es'\nimport { scene, blendOption, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-billboard',\n  mixins: [scene, blendOption, show, mixinPrimitiveCollection],\n  props: {\n    billboards: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    billboards: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: billboardCollection } = this\n        if (newVal === oldVal) {\n          // 插入新布告板 billboards.push()，修改布告板属性 billboards[i].xxx，或者 vm.$set(vm.billboards, indexOfBillboard, newValue)\n          if (newVal.length === billboardCollection._billboards.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                billboardCollection._billboards[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > billboardCollection._billboards.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedBillboards = differenceBy(newVal, billboardCollection._billboards, 'id')\n            if (addedBillboards.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedBillboards.length; i++) {\n              const billboard = addedBillboards[i]\n              billboard.id = billboard.id || Cesium.createGuid()\n              const billboardTransform = transformProps(billboard)\n              const billboardAdded = billboardCollection.add(billboardTransform)\n              billboardAdded.vcIndex = newVal.indexOf(billboard)\n            }\n          } else if (newVal.length < billboardCollection._billboards.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedBillboards = differenceBy(billboardCollection._billboards, newVal, 'id')\n            for (let i = 0; i < deletedBillboards.length; i++) {\n              const billboard = deletedBillboards[i]\n              billboardCollection.remove(billboard)\n            }\n            let iNull = 0\n            for (let i = 0; i < billboardCollection._billboards.length; i++) {\n              if (billboardCollection._billboards[i]) {\n                billboardCollection._billboards[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 billboard。\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, billboards } = this\n      const options = transformProps($props)\n      const billboardCollection = new Cesium.BillboardCollection(options)\n\n      for (let i = 0; i < billboards.length; i++) {\n        const billboardOptions = billboards[i]\n        billboardOptions.id = Cesium.defined(billboardOptions.id) ? billboardOptions.id : Cesium.createGuid()\n        const billboardOptionsTransform = transformProps(billboardOptions)\n        const billboard = billboardCollection.add(billboardOptionsTransform)\n        for (const prop in billboardOptionsTransform) {\n          if (!billboard[prop]) {\n            billboard[prop] = billboardOptionsTransform[prop]\n          }\n        }\n        billboard.vcIndex = i\n      }\n      return billboardCollection\n    }\n  }\n}\n</script>\n","import BillboardCollection from './BillboardCollection.vue'\n\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  plugin.installed = true\n\n  Vue.component(BillboardCollection.name, BillboardCollection)\n}\n\nexport default plugin\n\nexport {\n  BillboardCollection,\n  plugin as install\n}\n"],"names":["name","mixins","scene","blendOption","show","mixinPrimitiveCollection","props","billboards","type","Array","default","watch","handler","newVal","oldVal","mounted","transformProp","transformProps","billboardCollection","collection","length","_billboards","i","options","forEach","prop","addedBillboards","differenceBy","billboard","id","Cesium","createGuid","billboardTransform","billboardAdded","add","vcIndex","indexOf","deletedBillboards","remove","iNull","reload","deep","methods","createCesiumObject","$props","BillboardCollection","billboardOptions","defined","billboardOptionsTransform","plugin","Vue","installed","component"],"mappings":"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"}