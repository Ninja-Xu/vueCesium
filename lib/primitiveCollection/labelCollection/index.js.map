{"version":3,"file":"index.js","sources":["src/components/primitiveCollection/labelCollection/LabelCollection.vue?rollup-plugin-vue=script.js","src/components/primitiveCollection/labelCollection/LabelCollection.vue","src/components/primitiveCollection/labelCollection/index.js"],"sourcesContent":["\nimport { differenceBy } from 'lodash-es'\nimport { scene, blendOption, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-label',\n  mixins: [scene, blendOption, show, mixinPrimitiveCollection],\n  props: {\n    labels: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    labels: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: labelCollection } = this\n        if (newVal === oldVal) {\n          if (newVal.length === labelCollection._labels.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                labelCollection._labels[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > labelCollection._labels.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedLabels = differenceBy(newVal, labelCollection._labels, 'id')\n            if (addedLabels.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedLabels.length; i++) {\n              const label = addedLabels[i]\n              label.id = label.id || Cesium.createGuid()\n              const labelTransform = transformProps(label)\n              const labelAdded = labelCollection.add(labelTransform)\n              labelAdded.vcIndex = newVal.indexOf(label)\n            }\n          } else if (newVal.length < labelCollection._labels.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedLabels = differenceBy(labelCollection._labels, newVal, 'id')\n            for (let i = 0; i < deletedLabels.length; i++) {\n              const label = deletedLabels[i]\n              labelCollection.remove(label)\n            }\n            let iNull = 0\n            for (let i = 0; i < labelCollection._labels.length; i++) {\n              if (labelCollection._labels[i]) {\n                labelCollection._labels[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 label。\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, labels } = this\n      const options = transformProps($props)\n      const labelColletion = new Cesium.LabelCollection(options)\n\n      for (let i = 0; i < labels.length; i++) {\n        const labelOptions = labels[i]\n        labelOptions.id = Cesium.defined(labelOptions.id) ? labelOptions.id : Cesium.createGuid()\n        const labelOptionsTransform = transformProps(labelOptions)\n        const label = labelColletion.add(labelOptionsTransform)\n        for (const prop in labelOptionsTransform) {\n          if (!label[prop]) {\n            label[prop] = labelOptionsTransform[prop]\n          }\n        }\n        label.vcIndex = i\n      }\n      return labelColletion\n    }\n  }\n}\n","<script>\nimport { differenceBy } from 'lodash-es'\nimport { scene, blendOption, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-label',\n  mixins: [scene, blendOption, show, mixinPrimitiveCollection],\n  props: {\n    labels: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    labels: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: labelCollection } = this\n        if (newVal === oldVal) {\n          if (newVal.length === labelCollection._labels.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                labelCollection._labels[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > labelCollection._labels.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedLabels = differenceBy(newVal, labelCollection._labels, 'id')\n            if (addedLabels.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedLabels.length; i++) {\n              const label = addedLabels[i]\n              label.id = label.id || Cesium.createGuid()\n              const labelTransform = transformProps(label)\n              const labelAdded = labelCollection.add(labelTransform)\n              labelAdded.vcIndex = newVal.indexOf(label)\n            }\n          } else if (newVal.length < labelCollection._labels.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedLabels = differenceBy(labelCollection._labels, newVal, 'id')\n            for (let i = 0; i < deletedLabels.length; i++) {\n              const label = deletedLabels[i]\n              labelCollection.remove(label)\n            }\n            let iNull = 0\n            for (let i = 0; i < labelCollection._labels.length; i++) {\n              if (labelCollection._labels[i]) {\n                labelCollection._labels[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 label。\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, labels } = this\n      const options = transformProps($props)\n      const labelColletion = new Cesium.LabelCollection(options)\n\n      for (let i = 0; i < labels.length; i++) {\n        const labelOptions = labels[i]\n        labelOptions.id = Cesium.defined(labelOptions.id) ? labelOptions.id : Cesium.createGuid()\n        const labelOptionsTransform = transformProps(labelOptions)\n        const label = labelColletion.add(labelOptionsTransform)\n        for (const prop in labelOptionsTransform) {\n          if (!label[prop]) {\n            label[prop] = labelOptionsTransform[prop]\n          }\n        }\n        label.vcIndex = i\n      }\n      return labelColletion\n    }\n  }\n}\n</script>\n","import LabelCollection from './LabelCollection.vue'\n\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  plugin.installed = true\n\n  Vue.component(LabelCollection.name, LabelCollection)\n}\n\nexport default plugin\n\nexport {\n  LabelCollection,\n  plugin as install\n}\n"],"names":["name","mixins","scene","blendOption","show","mixinPrimitiveCollection","props","labels","type","Array","default","watch","handler","newVal","oldVal","mounted","transformProp","transformProps","labelCollection","collection","length","_labels","i","options","forEach","prop","addedLabels","differenceBy","label","id","Cesium","createGuid","labelTransform","labelAdded","add","vcIndex","indexOf","deletedLabels","remove","iNull","reload","deep","methods","createCesiumObject","$props","labelColletion","LabelCollection","labelOptions","defined","labelOptionsTransform","plugin","Vue","installed","component"],"mappings":"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"}