{"version":3,"file":"index.js","sources":["src/components/primitiveCollection/pointCollection/PointPrimitiveCollection.vue?rollup-plugin-vue=script.js","src/components/primitiveCollection/pointCollection/PointPrimitiveCollection.vue","src/components/primitiveCollection/pointCollection/index.js"],"sourcesContent":["\nimport { differenceBy } from 'lodash-es'\nimport { blendOption, modelMatrix, debugShowBoundingVolume, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-point',\n  mixins: [blendOption, modelMatrix, debugShowBoundingVolume, show, mixinPrimitiveCollection],\n  props: {\n    points: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    labels: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: pointColletion } = this\n        if (newVal === oldVal) {\n          if (newVal.length === pointColletion._points.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                pointColletion._points[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > pointColletion._points.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedPoints = differenceBy(newVal, pointColletion._points, 'id')\n            if (addedPoints.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedPoints.length; i++) {\n              const point = addedPoints[i]\n              point.id = point.id || Cesium.createGuid()\n              const pointTransform = transformProps(point)\n              const pointAdded = pointColletion.add(pointTransform)\n              pointAdded.vcIndex = newVal.indexOf(point)\n            }\n          } else if (newVal.length < pointColletion._points.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedPoints = differenceBy(pointColletion._points, newVal, 'id')\n            for (let i = 0; i < deletedPoints.length; i++) {\n              const point = deletedPoints[i]\n              pointColletion.remove(point)\n            }\n            let iNull = 0\n            for (let i = 0; i < pointColletion._points.length; i++) {\n              if (pointColletion._points[i]) {\n                pointColletion._points[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 point。\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, points } = this\n      const options = transformProps($props)\n      const pointColletion = new Cesium.PointPrimitiveCollection(options)\n\n      for (let i = 0; i < points.length; i++) {\n        const pointOptions = points[i]\n        pointOptions.id = Cesium.defined(pointOptions.id) ? pointOptions.id : Cesium.createGuid()\n        const pointOptionsTransform = transformProps(pointOptions)\n        const point = pointColletion.add(pointOptionsTransform)\n        for (const prop in pointOptionsTransform) {\n          if (!point[prop]) {\n            point[prop] = pointOptionsTransform[prop]\n          }\n        }\n        point.vcIndex = i\n      }\n      return pointColletion\n    }\n  }\n}\n","<script>\nimport { differenceBy } from 'lodash-es'\nimport { blendOption, modelMatrix, debugShowBoundingVolume, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-point',\n  mixins: [blendOption, modelMatrix, debugShowBoundingVolume, show, mixinPrimitiveCollection],\n  props: {\n    points: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    labels: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: pointColletion } = this\n        if (newVal === oldVal) {\n          if (newVal.length === pointColletion._points.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                pointColletion._points[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > pointColletion._points.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedPoints = differenceBy(newVal, pointColletion._points, 'id')\n            if (addedPoints.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedPoints.length; i++) {\n              const point = addedPoints[i]\n              point.id = point.id || Cesium.createGuid()\n              const pointTransform = transformProps(point)\n              const pointAdded = pointColletion.add(pointTransform)\n              pointAdded.vcIndex = newVal.indexOf(point)\n            }\n          } else if (newVal.length < pointColletion._points.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedPoints = differenceBy(pointColletion._points, newVal, 'id')\n            for (let i = 0; i < deletedPoints.length; i++) {\n              const point = deletedPoints[i]\n              pointColletion.remove(point)\n            }\n            let iNull = 0\n            for (let i = 0; i < pointColletion._points.length; i++) {\n              if (pointColletion._points[i]) {\n                pointColletion._points[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 point。\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, points } = this\n      const options = transformProps($props)\n      const pointColletion = new Cesium.PointPrimitiveCollection(options)\n\n      for (let i = 0; i < points.length; i++) {\n        const pointOptions = points[i]\n        pointOptions.id = Cesium.defined(pointOptions.id) ? pointOptions.id : Cesium.createGuid()\n        const pointOptionsTransform = transformProps(pointOptions)\n        const point = pointColletion.add(pointOptionsTransform)\n        for (const prop in pointOptionsTransform) {\n          if (!point[prop]) {\n            point[prop] = pointOptionsTransform[prop]\n          }\n        }\n        point.vcIndex = i\n      }\n      return pointColletion\n    }\n  }\n}\n</script>\n","import PointPrimitiveCollection from './PointPrimitiveCollection.vue'\n\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  plugin.installed = true\n\n  Vue.component(PointPrimitiveCollection.name, PointPrimitiveCollection)\n}\n\nexport default plugin\n\nexport {\n  PointPrimitiveCollection,\n  plugin as install\n}\n"],"names":["name","mixins","blendOption","modelMatrix","debugShowBoundingVolume","show","mixinPrimitiveCollection","props","points","type","Array","default","watch","labels","handler","newVal","oldVal","mounted","transformProp","transformProps","pointColletion","collection","length","_points","i","options","forEach","prop","addedPoints","differenceBy","point","id","Cesium","createGuid","pointTransform","pointAdded","add","vcIndex","indexOf","deletedPoints","remove","iNull","reload","deep","methods","createCesiumObject","$props","PointPrimitiveCollection","pointOptions","defined","pointOptionsTransform","plugin","Vue","installed","component"],"mappings":"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"}