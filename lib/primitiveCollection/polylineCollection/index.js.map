{"version":3,"file":"index.js","sources":["src/components/primitiveCollection/polylineCollection/PolylineCollection.vue?rollup-plugin-vue=script.js","src/components/primitiveCollection/polylineCollection/PolylineCollection.vue","src/components/primitiveCollection/polylineCollection/index.js"],"sourcesContent":["\nimport { differenceBy } from 'lodash-es'\nimport { modelMatrix, debugShowBoundingVolume, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-polyline',\n  mixins: [modelMatrix, debugShowBoundingVolume, show, mixinPrimitiveCollection],\n  props: {\n    polylines: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    polylines: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: polylineCollection } = this\n        if (newVal === oldVal) {\n          if (newVal.length === polylineCollection._polylines.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                polylineCollection._polylines[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > polylineCollection._polylines.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedPolylines = differenceBy(newVal, polylineCollection._polylines, 'id')\n            if (addedPolylines.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedPolylines.length; i++) {\n              const polyline = addedPolylines[i]\n              polyline.id = polyline.id || Cesium.createGuid()\n              const polylineTransform = transformProps(polyline)\n              const polylineAdded = polylineCollection.add(polylineTransform)\n              polylineAdded.vcIndex = newVal.indexOf(polyline)\n            }\n          } else if (newVal.length < polylineCollection._polylines.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedPolylines = differenceBy(polylineCollection._polylines, newVal, 'id')\n            for (let i = 0; i < deletedPolylines.length; i++) {\n              const polyline = deletedPolylines[i]\n              polylineCollection.remove(polyline)\n            }\n            let iNull = 0\n            for (let i = 0; i < polylineCollection._polylines.length; i++) {\n              if (polylineCollection._polylines[i]) {\n                polylineCollection._polylines[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 polyline\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, polylines } = this\n      const options = transformProps($props)\n      const polylineCollection = new Cesium.PolylineCollection(options)\n\n      for (let i = 0; i < polylines.length; i++) {\n        const polylineOptions = polylines[i]\n        polylineOptions.id = Cesium.defined(polylineOptions.id) ? polylineOptions.id : Cesium.createGuid()\n        const polylineOptionsTransform = transformProps(polylineOptions)\n        const polyline = polylineCollection.add(polylineOptionsTransform)\n        for (const prop in polylineOptionsTransform) {\n          if (!polyline[prop]) {\n            polyline[prop] = polylineOptionsTransform[prop]\n          }\n        }\n        polyline.vcIndex = i\n      }\n\n      return polylineCollection\n    }\n  }\n}\n","<script>\nimport { differenceBy } from 'lodash-es'\nimport { modelMatrix, debugShowBoundingVolume, show } from '../../../mixins/mixinProps'\nimport mixinPrimitiveCollection from '../../../mixins/primitives/mixinPrimitiveCollection'\n\nexport default {\n  name: 'vc-collection-primitive-polyline',\n  mixins: [modelMatrix, debugShowBoundingVolume, show, mixinPrimitiveCollection],\n  props: {\n    polylines: {\n      type: Array,\n      default: () => []\n    }\n  },\n  watch: {\n    polylines: {\n      /**\n       * https://cn.vuejs.org/v2/guide/reactivity.html#检测变化的注意事项\n       */\n      handler: function (newVal, oldVal) {\n        if (!this.mounted) {\n          return\n        }\n        const { transformProp, transformProps, collection: polylineCollection } = this\n        if (newVal === oldVal) {\n          if (newVal.length === polylineCollection._polylines.length) {\n            // 认为是修改了某个对象\n            for (let i = 0; i < newVal.length; i++) {\n              const options = newVal[i]\n              Object.keys(options).forEach(prop => {\n                polylineCollection._polylines[i][prop] = transformProp(prop, options[prop])\n              })\n            }\n          } else if (newVal.length > polylineCollection._polylines.length) {\n            // 认为是插入了新对象 push unshift splice\n            const addedPolylines = differenceBy(newVal, polylineCollection._polylines, 'id')\n            if (addedPolylines.length === 0) {\n              // warn 请使用唯一 id\n            }\n            for (let i = 0; i < addedPolylines.length; i++) {\n              const polyline = addedPolylines[i]\n              polyline.id = polyline.id || Cesium.createGuid()\n              const polylineTransform = transformProps(polyline)\n              const polylineAdded = polylineCollection.add(polylineTransform)\n              polylineAdded.vcIndex = newVal.indexOf(polyline)\n            }\n          } else if (newVal.length < polylineCollection._polylines.length) {\n            // 认为是删除了对象 pop splice shift\n            const deletedPolylines = differenceBy(polylineCollection._polylines, newVal, 'id')\n            for (let i = 0; i < deletedPolylines.length; i++) {\n              const polyline = deletedPolylines[i]\n              polylineCollection.remove(polyline)\n            }\n            let iNull = 0\n            for (let i = 0; i < polylineCollection._polylines.length; i++) {\n              if (polylineCollection._polylines[i]) {\n                polylineCollection._polylines[i].vcIndex = i - iNull\n              } else {\n                iNull++\n              }\n            }\n          }\n        } else {\n          // 认为是赋新值\n          this.reload()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    /**\n     *  重写 createCesiumObject 方法，支持用数组加载大量 polyline\n     */\n    async createCesiumObject () {\n      const { $props, transformProps, polylines } = this\n      const options = transformProps($props)\n      const polylineCollection = new Cesium.PolylineCollection(options)\n\n      for (let i = 0; i < polylines.length; i++) {\n        const polylineOptions = polylines[i]\n        polylineOptions.id = Cesium.defined(polylineOptions.id) ? polylineOptions.id : Cesium.createGuid()\n        const polylineOptionsTransform = transformProps(polylineOptions)\n        const polyline = polylineCollection.add(polylineOptionsTransform)\n        for (const prop in polylineOptionsTransform) {\n          if (!polyline[prop]) {\n            polyline[prop] = polylineOptionsTransform[prop]\n          }\n        }\n        polyline.vcIndex = i\n      }\n\n      return polylineCollection\n    }\n  }\n}\n</script>\n","import PolylineCollection from './PolylineCollection.vue'\n\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  plugin.installed = true\n\n  Vue.component(PolylineCollection.name, PolylineCollection)\n}\n\nexport default plugin\n\nexport {\n  PolylineCollection,\n  plugin as install\n}\n"],"names":["name","mixins","modelMatrix","debugShowBoundingVolume","show","mixinPrimitiveCollection","props","polylines","type","Array","default","watch","handler","newVal","oldVal","mounted","transformProp","transformProps","polylineCollection","collection","length","_polylines","i","options","forEach","prop","addedPolylines","differenceBy","polyline","id","Cesium","createGuid","polylineTransform","polylineAdded","add","vcIndex","indexOf","deletedPolylines","remove","iNull","reload","deep","methods","createCesiumObject","$props","PolylineCollection","polylineOptions","defined","polylineOptionsTransform","plugin","Vue","installed","component"],"mappings":"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"}