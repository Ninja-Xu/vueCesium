{"version":3,"file":"index.js","sources":["src/components/viewer/loadUtil.js","src/components/viewer/Viewer.vue?rollup-plugin-vue=script.js","src/components/viewer/Viewer.vue","src/components/viewer/index.js"],"sourcesContent":["/**\n * 加载Mars3D平台CDN资源文件，\n * 这些文件可以从  http://mars3d.cn/download/lib.rar  下载后放在本地项目目录引入。\n * @param {string} libpath 根目录，如：http://mars3d.cn/lib/\n * @return {*}\n */\nexport function getMars3dConfig (libpath) {\n  const libsConfig = {\n    'font-awesome': [libpath + 'fonts/font-awesome/css/font-awesome.min.css'],\n    haoutil: [libpath + 'hao/haoutil.js'],\n    turf: [libpath + 'turf/turf.min.js'],\n    'mars3d-space': [\n      // 卫星插件\n      libpath + 'mars3d/plugins/space/mars3d-space.js'\n    ],\n    'mars3d-echarts': [\n      // echarts支持插件\n      libpath + 'echarts/echarts.min.js',\n      libpath + 'echarts/echarts-gl.min.js',\n      libpath + 'mars3d/plugins/echarts/mars3d-echarts.js'\n    ],\n    'mars3d-mapv': [\n      // mapv支持插件\n      libpath + 'mapV/mapv.min.js',\n      libpath + 'mars3d/plugins/mapv/mars3d-mapv.js'\n    ],\n    'mars3d-heatmap': [\n      // heatmap热力图支持插件\n      libpath + 'mars3d/plugins/heatmap/heatmap.min.js',\n      libpath + 'mars3d/plugins/heatmap/mars3d-heatmap.js'\n    ],\n    'mars3d-wind': [\n      // 风场图层插件\n      libpath + 'mars3d/plugins/wind/netcdfjs.js', // m10_windLayer解析nc\n      libpath + 'mars3d/plugins/wind/mars3d-wind.js'\n    ],\n    mars3d: [\n      // 三维地球“主库”\n      libpath + 'Cesium/Widgets/widgets.css', // cesium\n      libpath + 'Cesium/Cesium.js',\n      libpath + 'mars3d/mars3d.css', // mars3d\n      libpath + 'mars3d/mars3d.js'\n    ]\n  }\n  return libsConfig\n}\n","//\n//\n//\n//\n//\n//\n\nimport bindEvents from '../../utils/bindEvent.js'\nimport { Events } from '../../utils/events'\nimport services from '../../mixins/services'\nimport mergeDescriptors from '../../utils/mergeDescriptors.js'\nimport { dirname, isArray } from '../../utils/util.js'\nimport { getMars3dConfig } from './loadUtil'\n\nlet loadLibs = []\n\nexport default {\n  name: 'vc-viewer',\n  mixins: [services],\n  props: {\n    cesiumPath: String,\n    animation: {\n      type: Boolean,\n      default: false\n    },\n    baseLayerPicker: {\n      type: Boolean,\n      default: false\n    },\n    fullscreenButton: {\n      type: Boolean,\n      default: false\n    },\n    vrButton: {\n      type: Boolean,\n      default: false\n    },\n    geocoder: {\n      type: [Boolean, Array],\n      default: false\n    },\n    homeButton: {\n      type: Boolean,\n      default: false\n    },\n    infoBox: {\n      type: Boolean,\n      default: true\n    },\n    sceneModePicker: {\n      type: Boolean,\n      default: false\n    },\n    selectionIndicator: {\n      type: Boolean,\n      default: true\n    },\n    timeline: {\n      type: Boolean,\n      default: false\n    },\n    navigationHelpButton: {\n      type: Boolean,\n      default: false\n    },\n\n    navigationInstructionsInitiallyVisible: {\n      type: Boolean,\n      default: false\n    },\n    scene3DOnly: {\n      type: Boolean,\n      default: false\n    },\n    shouldAnimate: {\n      type: Boolean,\n      default: false\n    },\n    clockViewModel: Object,\n    selectedImageryProviderViewModel: Object,\n    imageryProviderViewModels: Object,\n    selectedTerrainProviderViewModel: Object,\n    terrainProviderViewModels: Object,\n    imageryProvider: Object,\n    terrainProvider: Object,\n    skyBox: [Object, Boolean],\n    skyAtmosphere: [Object, Boolean],\n    fullscreenElement: {\n      type: [Element, String]\n    },\n    useDefaultRenderLoop: {\n      type: Boolean,\n      default: true\n    },\n    targetFrameRate: Number,\n    showRenderLoopErrors: {\n      type: Boolean,\n      default: true\n    },\n    automaticallyTrackDataSourceClocks: {\n      type: Boolean,\n      default: true\n    },\n    contextOptions: Object,\n    sceneMode: {\n      type: Number,\n      default: 3\n    },\n    mapProjection: Object,\n    globe: Object,\n    orderIndependentTranslucency: {\n      type: Boolean,\n      default: true\n    },\n    creditContainer: [Element, String],\n    creditViewport: [Element, String],\n    dataSources: Object,\n    terrainExaggeration: {\n      type: Number,\n      default: 1.0\n    },\n    shadows: {\n      type: Boolean,\n      default: false\n    },\n    terrainShadows: {\n      type: Number,\n      default: 3\n    },\n    mapMode2D: {\n      type: Number,\n      default: 1\n    },\n    projectionPicker: {\n      type: Boolean,\n      default: false\n    },\n    requestRenderMode: {\n      type: Boolean,\n      default: false\n    },\n    maximumRenderTimeChange: {\n      type: Number,\n      default: 0.0\n    },\n    logo: {\n      type: Boolean,\n      default: true\n    },\n    accessToken: String,\n    camera: {\n      type: Object,\n      default: function () {\n        return {\n          position: {\n            lng: 105,\n            lat: 29.999999999999993,\n            height: 19059568.497290563\n          },\n          heading: 360,\n          pitch: -90,\n          roll: 0\n        }\n      }\n    },\n    navigation: {\n      // for supermap\n      type: Boolean,\n      default: false\n    },\n    TZcode: {\n      type: String\n      // default: new Date().getTimezoneOffset() === 0 ? 'UTC' : 'UTC' + '+' + -(new Date().getTimezoneOffset() / 60)\n    },\n    UTCoffset: {\n      type: Number\n      // default: -new Date().getTimezoneOffset()\n    },\n    removeCesiumScript: {\n      type: Boolean,\n      default: true\n    },\n    autoSortImageryLayers: {\n      type: Boolean,\n      default: true\n    }\n  },\n  watch: {\n    selectionIndicator (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.selectionIndicator) && !viewer.selectionIndicator.isDestroyed() && !val) {\n        const selectionIndicatorContainer = viewer.selectionIndicator.container\n        viewerContainer.removeChild(selectionIndicatorContainer)\n        viewer.selectionIndicator.destroy()\n        viewer._selectionIndicator = undefined\n      } else if (!Cesium.defined(viewer.selectionIndicator) || viewer.selectionIndicator.isDestroyed()) {\n        const selectionIndicatorContainer = document.createElement('div')\n        selectionIndicatorContainer.className = 'cesium-viewer-selectionIndicatorContainer'\n        viewerContainer.appendChild(selectionIndicatorContainer)\n        const selectionIndicator = new Cesium.SelectionIndicator(selectionIndicatorContainer, viewer.scene)\n        viewer._selectionIndicator = selectionIndicator\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    infoBox (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.infoBox) && !viewer.infoBox.isDestroyed() && !val) {\n        const infoBoxContainer = viewer.infoBox.container\n        viewerContainer.removeChild(infoBoxContainer)\n        viewer.infoBox.destroy()\n        viewer._infoBox = undefined\n      } else if (!Cesium.defined(viewer.infoBox) || viewer.infoBox.isDestroyed()) {\n        const infoBoxContainer = document.createElement('div')\n        infoBoxContainer.className = 'cesium-viewer-infoBoxContainer'\n        viewerContainer.appendChild(infoBoxContainer)\n        const infoBox = new Cesium.InfoBox(infoBoxContainer)\n        const infoBoxViewModel = infoBox.viewModel\n        viewer._eventHelper.add(infoBoxViewModel.cameraClicked, viewer._onInfoBoxCameraClicked, viewer)\n        viewer._eventHelper.add(infoBoxViewModel.closeClicked, viewer._onInfoBoxClockClicked, viewer)\n        const events = ['cameraClicked', 'closeClicked']\n        infoBoxViewModel && bindEvents.call(this, infoBoxViewModel, events, true)\n        viewer._infoBox = infoBox\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    geocoder (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.geocoder) && !viewer.geocoder.isDestroyed() && !val) {\n        const geocoderContainer = viewer.geocoder.container\n        toolbar.removeChild(geocoderContainer)\n        viewer.geocoder.destroy()\n        viewer._geocoder = undefined\n      } else if (!Cesium.defined(viewer.geocoder) || viewer.geocoder.isDestroyed()) {\n        const geocoderContainer = document.createElement('div')\n        geocoderContainer.className = 'cesium-viewer-geocoderContainer'\n        toolbar.appendChild(geocoderContainer)\n        const geocoder = new Cesium.Geocoder({\n          container: geocoderContainer,\n          geocoderServices: Cesium.defined(this.geocoder)\n            ? Array.isArray(this.geocoder)\n                ? this.geocoder\n                : [this.geocoder]\n            : undefined,\n          scene: viewer.scene,\n          viewer: viewer\n        })\n        viewer._eventHelper.add(geocoder.viewModel.search.beforeExecute, viewer._clearObjects, viewer)\n        viewer._geocoder = geocoder\n        resizeToolbar(toolbar, geocoderContainer)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    homeButton (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.homeButton) && !viewer.homeButton.isDestroyed() && !val) {\n        viewer.homeButton.destroy()\n        viewer._homeButton = undefined\n      } else if (!Cesium.defined(viewer.homeButton) || viewer.homeButton.isDestroyed()) {\n        const homeButton = new Cesium.HomeButton(toolbar, viewer.scene)\n        if (Cesium.defined(viewer.geocoder)) {\n          viewer._eventHelper.add(homeButton.viewModel.command.afterExecute, function () {\n            const viewModel = viewer.geocoder.viewModel\n            viewModel.searchText = ''\n            if (viewModel.isSearchInProgress) {\n              viewModel.search()\n            }\n          })\n        }\n        viewer._eventHelper.add(homeButton.viewModel.command.beforeExecute, viewer._clearTrackedObject, viewer)\n        viewer._homeButton = homeButton\n        resizeToolbar(toolbar, homeButton)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    sceneModePicker (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.sceneModePicker) && !viewer.sceneModePicker.isDestroyed() && !val) {\n        viewer.sceneModePicker.destroy()\n        viewer._sceneModePicker = undefined\n      } else if (!Cesium.defined(viewer.sceneModePicker) || viewer.sceneModePicker.isDestroyed()) {\n        if (this.sceneModePicker === true && this.scene3DOnly) {\n          throw new Cesium.DeveloperError('options.sceneModePicker is not available when options.scene3DOnly is set to true.')\n        }\n        if (!this.scene3DOnly && this.sceneModePicker === true) {\n          const sceneModePicker = new Cesium.SceneModePicker(toolbar, viewer.scene)\n          viewer._sceneModePicker = sceneModePicker\n          resizeToolbar(toolbar, sceneModePicker)\n        }\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    projectionPicker (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.projectionPicker) && !viewer.projectionPicker.isDestroyed() && !val) {\n        viewer.projectionPicker.destroy()\n        viewer._projectionPicker = undefined\n      } else if (!Cesium.defined(viewer.projectionPicker) || viewer.projectionPicker.isDestroyed()) {\n        const projectionPicker = new Cesium.ProjectionPicker(toolbar, viewer.scene)\n        viewer._projectionPicker = projectionPicker\n        resizeToolbar(toolbar, projectionPicker)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    baseLayerPicker (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.baseLayerPicker) && !viewer.baseLayerPicker.isDestroyed() && !val) {\n        viewer.baseLayerPicker.destroy()\n        viewer._baseLayerPicker = undefined\n        viewer.imageryLayers.remove(viewer.imageryLayers.get(viewer.imageryLayers.length - 1))\n      } else if (!Cesium.defined(viewer.baseLayerPicker) || viewer.baseLayerPicker.isDestroyed()) {\n        const createBaseLayerPicker =\n          (!Cesium.defined(viewer.globe) || this.globe !== false) &&\n          (!Cesium.defined(viewer.baseLayerPicker) || this.baseLayerPicker !== false)\n\n        if (createBaseLayerPicker && Cesium.defined(this.imageryProvider)) {\n          throw new Cesium.DeveloperError(`options.imageryProvider is not available when using the BaseLayerPicker widget.\nEither specify options.selectedImageryProviderViewModel instead or set options.baseLayerPicker to false.`)\n        }\n        if (!createBaseLayerPicker && Cesium.defined(this.selectedImageryProviderViewModel)) {\n          throw new Cesium.DeveloperError(`options.selectedImageryProviderViewModel is not available when not using the BaseLayerPicker widget.\nEither specify options.imageryProvider instead or set options.baseLayerPicker to true.`)\n        }\n        if (createBaseLayerPicker && Cesium.defined(this.terrainProvider)) {\n          throw new Cesium.DeveloperError(`options.terrainProvider is not available when using the BaseLayerPicker widget.\nEither specify options.selectedTerrainProviderViewModel instead or set options.baseLayerPicker to false.`)\n        }\n        if (!createBaseLayerPicker && Cesium.defined(this.selectedTerrainProviderViewModel)) {\n          throw new Cesium.DeveloperError(`options.selectedTerrainProviderViewModel is not available when not using the BaseLayerPicker widget.\nEither specify options.terrainProvider instead or set options.baseLayerPicker to true.`)\n        }\n        if (createBaseLayerPicker) {\n          const imageryProviderViewModels = Cesium.defaultValue(\n            this.imageryProviderViewModels,\n            Cesium.createDefaultImageryProviderViewModels()\n          )\n          const terrainProviderViewModels = Cesium.defaultValue(\n            this.terrainProviderViewModels,\n            Cesium.createDefaultTerrainProviderViewModels()\n          )\n          const baseLayerPicker = new Cesium.BaseLayerPicker(toolbar, {\n            globe: viewer.scene.globe,\n            imageryProviderViewModels: imageryProviderViewModels,\n            selectedImageryProviderViewModel: imageryProviderViewModels[0],\n            terrainProviderViewModels: terrainProviderViewModels,\n            selectedTerrainProviderViewModel: terrainProviderViewModels[0]\n          })\n          const elements = toolbar.getElementsByClassName('cesium-baseLayerPicker-dropDown')\n\n          const baseLayerPickerDropDown = elements[0]\n          viewer._baseLayerPickerDropDown = baseLayerPickerDropDown\n          viewer._baseLayerPicker = baseLayerPicker\n          viewer.imageryLayers.raiseToTop(viewer.imageryLayers.get(0))\n          resizeToolbar(toolbar, baseLayerPicker)\n        }\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    navigationHelpButton (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.navigationHelpButton) && !viewer.navigationHelpButton.isDestroyed() && !val) {\n        viewer.navigationHelpButton.destroy()\n        viewer._navigationHelpButton = undefined\n      } else if (!Cesium.defined(viewer.navigationHelpButton) || viewer.navigationHelpButton.isDestroyed()) {\n        let showNavHelp = true\n        try {\n          if (Cesium.defined(window.localStorage)) {\n            const hasSeenNavHelp = window.localStorage.getItem('cesium-hasSeenNavHelp')\n            if (Cesium.defined(hasSeenNavHelp) && Boolean(hasSeenNavHelp)) {\n              showNavHelp = false\n            } else {\n              window.localStorage.setItem('cesium-hasSeenNavHelp', 'true')\n            }\n          }\n        } catch (e) {}\n        const navigationHelpButton = new Cesium.NavigationHelpButton({\n          container: toolbar,\n          instructionsInitiallyVisible: Cesium.defaultValue(this.navigationInstructionsInitiallyVisible, showNavHelp)\n        })\n        viewer._navigationHelpButton = navigationHelpButton\n        resizeToolbar(toolbar, navigationHelpButton)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    animation (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.animation) && !viewer.animation.isDestroyed() && !val) {\n        const animationContainer = viewer.animation.container\n        viewerContainer.removeChild(animationContainer)\n        viewer.animation.destroy()\n        viewer._animation = undefined\n      } else if (!Cesium.defined(viewer.animation) || viewer.animation.isDestroyed()) {\n        const animationContainer = document.createElement('div')\n        animationContainer.className = 'cesium-viewer-animationContainer'\n        this.viewerContainer.appendChild(animationContainer)\n        const animation = new Cesium.Animation(animationContainer, new Cesium.AnimationViewModel(viewer.clockViewModel))\n        animation.viewModel.dateFormatter = this.localeDateTimeFormatter\n        animation.viewModel.timeFormatter = this.localeTimeFormatter\n        viewer._animation = animation\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n\n    timeline (val) {\n      const { viewer, viewerContainer, onTimelineScrubfunction } = this\n      if (Cesium.defined(viewer.timeline) && !viewer.timeline.isDestroyed() && !val) {\n        const timelineContainer = viewer.timeline.container\n        viewerContainer.removeChild(timelineContainer)\n        viewer.timeline.destroy()\n        viewer._timeline = undefined\n      } else if (!Cesium.defined(viewer.timeline) || viewer.timeline.isDestroyed()) {\n        const timelineContainer = document.createElement('div')\n        timelineContainer.className = 'cesium-viewer-timelineContainer'\n        viewerContainer.appendChild(timelineContainer)\n        const timeline = new Cesium.Timeline(timelineContainer, viewer.clock)\n        const that = this\n        timeline.makeLabel = (time) => {\n          return that.localeDateTimeFormatter(time)\n        }\n        timeline.addEventListener('settime', onTimelineScrubfunction, false)\n        timeline.zoomTo(viewer.clock.startTime, viewer.clock.stopTime)\n        viewer._timeline = timeline\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    fullscreenButton (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.fullscreenButton) && !viewer.fullscreenButton.isDestroyed() && !val) {\n        const fullscreenContainer = viewer.fullscreenButton.container\n        viewerContainer.removeChild(fullscreenContainer)\n        viewer.fullscreenButton.destroy()\n        viewer._fullscreenButton = undefined\n      } else if (!Cesium.defined(viewer.fullscreenButton) || viewer.fullscreenButton.isDestroyed()) {\n        const fullscreenContainer = document.createElement('div')\n        fullscreenContainer.className = 'cesium-viewer-fullscreenContainer'\n        viewerContainer.appendChild(fullscreenContainer)\n        const fullscreenButton = new Cesium.FullscreenButton(fullscreenContainer, this.$refs.viewer)\n        viewer._fullscreenButton = fullscreenButton\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    fullscreenElement (val) {\n      const { viewer } = this\n      if (!Cesium.defined(viewer.fullscreenButton)) {\n        return\n      }\n      if (Cesium.defined(val)) {\n        this.viewer.fullscreenButton.viewModel.fullscreenElement = val\n      }\n    },\n    vrButton (val) {\n      const { viewer, enableVRUI, viewerContainer } = this\n      if (Cesium.defined(viewer.vrButton) && !viewer.vrButton.isDestroyed() && !val) {\n        const vrContainer = viewer.vrButton.container\n        viewerContainer.removeChild(vrContainer)\n        viewer.vrButton.destroy()\n        viewer._vrButton = undefined\n      } else if (!Cesium.defined(viewer.vrButton) || viewer.vrButton.isDestroyed()) {\n        const vrContainer = document.createElement('div')\n        vrContainer.className = 'cesium-viewer-vrContainer'\n        viewerContainer.appendChild(vrContainer)\n        const vrButton = new Cesium.VRButton(vrContainer, viewer.scene, viewerContainer)\n        const viewModelCommand = vrButton.viewModel._command\n        vrButton.viewModel._command = function (VRButtonViewModel) {\n          viewModelCommand()\n          enableVRUI(viewer, VRButtonViewModel.isVRMode)\n        }\n        viewer._vrButton = vrButton\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    useDefaultRenderLoop (val) {\n      this.viewer.useDefaultRenderLoop = val\n    },\n    sceneMode (val) {\n      const { viewer } = this\n      if (\n        Cesium.SceneMode.COLUMBUS_VIEW === val ||\n        Cesium.SceneMode.MORPHING === val ||\n        Cesium.SceneMode.SCENE2D === val ||\n        Cesium.SceneMode.SCENE3D === val\n      ) {\n        viewer.scene.mode = val\n      }\n    },\n    shouldAnimate (val) {\n      const { viewer } = this\n      viewer.clock.shouldAnimate = val\n    },\n    terrainExaggeration (val) {\n      const { viewer } = this\n      viewer.scene._terrainExaggeration = val\n    },\n    shadows (val) {\n      const { viewer } = this\n      viewer.scene.shadowMap.enabled = val\n    },\n    terrainProvider (val) {\n      const { viewer } = this\n      viewer.terrainProvider = val\n    },\n    camera: {\n      handler (val) {\n        this.setCamera(val)\n      },\n      deep: true\n    },\n    imageryProvider (val, oldvalue) {\n      const { viewer } = this\n      if (Cesium.defined(val)) {\n        for (let i = 0; i < viewer.imageryLayers.length; i++) {\n          viewer.imageryLayers[i].imageryProvider === oldvalue && viewer.imageryLayers.remove(viewer.imageryLayers[i])\n        }\n        viewer.imageryLayers.addImageryProvider(val)\n      }\n    }\n  },\n  methods: {\n    onTimelineScrubfunction (e) {\n      const clock = e.clock\n      clock.currentTime = e.timeJulian\n      clock.shouldAnimate = false\n    },\n    resizeToolbar (parent, child) {\n      Array.prototype.slice.call(parent.children).forEach((element) => {\n        switch (element.className) {\n          case 'cesium-viewer-geocoderContainer':\n            element.customIndex = 1\n            break\n          case 'cesium-button cesium-toolbar-button cesium-home-button':\n            element.customIndex = 2\n            break\n          case 'cesium-sceneModePicker-wrapper cesium-toolbar-button':\n            element.customIndex = 3\n            break\n          case 'cesium-projectionPicker-wrapper cesium-toolbar-button':\n            element.customIndex = 4\n            break\n          case 'cesium-button cesium-toolbar-button':\n          case 'cesium-baseLayerPicker-dropDown':\n            element.customIndex = 5\n            break\n          case 'cesium-navigationHelpButton-wrapper':\n            element.customIndex = 6\n            break\n        }\n      })\n      const arr = []\n      Array.prototype.slice.call(parent.children).forEach((element) => {\n        arr.push(element)\n      })\n      arr.sort(function (a, b) {\n        return a.customIndex - b.customIndex\n      })\n      for (let i = 0; i < arr.length; i++) {\n        parent.appendChild(arr[i])\n      }\n    },\n    enableVRUI (viewer, enabled) {\n      const geocoder = viewer._geocoder\n      const homeButton = viewer._homeButton\n      const sceneModePicker = viewer._sceneModePicker\n      const projectionPicker = viewer._projectionPicker\n      const baseLayerPicker = viewer._baseLayerPicker\n      const animation = viewer._animation\n      const timeline = viewer._timeline\n      const fullscreenButton = viewer._fullscreenButton\n      const infoBox = viewer._infoBox\n      const selectionIndicator = viewer._selectionIndicator\n      const visibility = enabled ? 'hidden' : 'visible'\n      if (Cesium.defined(geocoder)) {\n        geocoder.container.style.visibility = visibility\n      }\n      if (Cesium.defined(homeButton)) {\n        homeButton.container.style.visibility = visibility\n      }\n      if (Cesium.defined(sceneModePicker)) {\n        sceneModePicker.container.style.visibility = visibility\n      }\n      if (Cesium.defined(projectionPicker)) {\n        projectionPicker.container.style.visibility = visibility\n      }\n      if (Cesium.defined(baseLayerPicker)) {\n        baseLayerPicker.container.style.visibility = visibility\n      }\n      if (Cesium.defined(animation)) {\n        animation.container.style.visibility = visibility\n      }\n      if (Cesium.defined(timeline)) {\n        timeline.container.style.visibility = visibility\n      }\n      if (Cesium.defined(fullscreenButton) && fullscreenButton.viewModel.isFullscreenEnabled) {\n        fullscreenButton.container.style.visibility = visibility\n      }\n      if (Cesium.defined(infoBox)) {\n        infoBox.container.style.visibility = visibility\n      }\n      if (Cesium.defined(selectionIndicator)) {\n        selectionIndicator.container.style.visibility = visibility\n      }\n      if (viewer._container) {\n        const right = enabled || !Cesium.defined(fullscreenButton) ? 0 : fullscreenButton.container.clientWidth\n        viewer._vrButton.container.style.right = right + 'px'\n        viewer.forceResize()\n      }\n    },\n    init () {\n      this.Cesium = Cesium\n      const $el = this.$refs.viewer\n      const accessToken = this.accessToken\n        ? this.accessToken\n        : typeof this._Cesium !== 'undefined' && Object.prototype.hasOwnProperty.call(this._Cesium(), 'accessToken')\n          ? this._Cesium().accessToken\n          : this.accessToken\n\n      Cesium.Ion.defaultAccessToken = accessToken\n      const {\n        animation,\n        baseLayerPicker,\n        fullscreenButton,\n        vrButton,\n        geocoder,\n        homeButton,\n        infoBox,\n        sceneModePicker,\n        selectionIndicator,\n        timeline,\n        navigationHelpButton,\n        navigationInstructionsInitiallyVisible,\n        scene3DOnly,\n        shouldAnimate,\n        clockViewModel,\n        selectedImageryProviderViewModel,\n        imageryProviderViewModels,\n        selectedTerrainProviderViewModel,\n        terrainProviderViewModels,\n        imageryProvider,\n        terrainProvider,\n        skyBox,\n        skyAtmosphere,\n        fullscreenElement,\n        useDefaultRenderLoop,\n        targetFrameRate,\n        showRenderLoopErrors,\n        automaticallyTrackDataSourceClocks,\n        contextOptions,\n        sceneMode,\n        mapProjection,\n        globe,\n        orderIndependentTranslucency,\n        creditContainer,\n        creditViewport,\n        dataSources,\n        terrainExaggeration,\n        shadows,\n        terrainShadows,\n        mapMode2D,\n        projectionPicker,\n        requestRenderMode,\n        maximumRenderTimeChange,\n        navigation,\n        registerEvents\n      } = this\n      const url = Cesium.buildModuleUrl('Assets/Textures/NaturalEarthII')\n      const options = {\n        animation,\n        baseLayerPicker,\n        fullscreenButton,\n        vrButton,\n        geocoder,\n        homeButton,\n        infoBox,\n        sceneModePicker,\n        selectionIndicator,\n        timeline,\n        navigationHelpButton,\n        navigationInstructionsInitiallyVisible,\n        scene3DOnly,\n        shouldAnimate,\n        clockViewModel,\n        selectedImageryProviderViewModel,\n        imageryProviderViewModels,\n        selectedTerrainProviderViewModel,\n        terrainProviderViewModels,\n        imageryProvider: this.isEmptyObj(imageryProvider)\n          ? Cesium.defined(Cesium.TileMapServiceImageryProvider)\n              ? new Cesium.TileMapServiceImageryProvider({\n                  url: url\n                })\n              : Cesium.createTileMapServiceImageryProvider({ url: url })\n          : imageryProvider,\n        terrainProvider,\n        skyBox,\n        skyAtmosphere,\n        fullscreenElement: this.isEmptyObj(fullscreenElement) ? $el : fullscreenElement,\n        useDefaultRenderLoop,\n        targetFrameRate,\n        showRenderLoopErrors,\n        automaticallyTrackDataSourceClocks,\n        contextOptions,\n        sceneMode,\n        mapProjection,\n        globe,\n        orderIndependentTranslucency,\n        creditContainer,\n        creditViewport,\n        dataSources,\n        terrainExaggeration,\n        shadows,\n        terrainShadows,\n        mapMode2D,\n        projectionPicker,\n        requestRenderMode,\n        maximumRenderTimeChange,\n        navigation\n      }\n      this.removeNullItem(options)\n\n      if (Cesium.VERSION >= '1.83') {\n        delete options.terrainExaggeration\n      }\n      let viewer = {}\n      if (globalThis.mars3d) {\n        this.map = new mars3d.Map($el.id, options)\n        viewer = this.map?._viewer\n      } else if (globalThis.DC) {\n        this.dcViewer = new DC.Viewer($el.id, options)\n        viewer = this.dcViewer?.delegate\n      } else if (globalThis.XE) {\n        this.earth = new globalThis.XE.Earth($el, options)\n        viewer = this.earth?.czm.viewer\n      } else {\n        viewer = new Cesium.Viewer($el, options)\n      }\n\n      this.viewer = viewer\n\n      if (Cesium.VERSION >= '1.83') {\n        viewer.scene.globe.terrainExaggeration = terrainExaggeration\n      }\n\n      if (Cesium.defined(this.camera)) {\n        this.setCamera(this.camera)\n      }\n\n      const that = this\n      const listener = that.$listeners['update:camera']\n      listener &&\n        viewer.camera.changed.addEventListener(() => {\n          const cartographic = viewer.camera.positionCartographic\n          let camera\n          if (that.camera.position.lng) {\n            camera = {\n              position: {\n                lng: Cesium.Math.toDegrees(cartographic.longitude),\n                lat: Cesium.Math.toDegrees(cartographic.latitude),\n                height: cartographic.height\n              },\n              heading: Cesium.Math.toDegrees(viewer.camera.heading || 360),\n              pitch: Cesium.Math.toDegrees(viewer.camera.pitch || -90),\n              roll: Cesium.Math.toDegrees(viewer.camera.roll || 0)\n            }\n          } else {\n            camera = {\n              position: {\n                x: viewer.camera.position.x,\n                y: viewer.camera.position.y,\n                z: viewer.camera.position.z\n              },\n              heading: viewer.camera.heading || 2 * Math.PI,\n              pitch: viewer.camera.pitch || -Math.PI / 2,\n              roll: viewer.camera.roll || 0\n            }\n          }\n\n          if (listener) {\n            that.$emit('update:camera', camera)\n          }\n        })\n      if (Cesium.defined(viewer.animation)) {\n        viewer.animation.viewModel.dateFormatter = this.localeDateTimeFormatter\n        viewer.animation.viewModel.timeFormatter = this.localeTimeFormatter\n      }\n      if (Cesium.defined(viewer.timeline)) {\n        viewer.timeline.makeLabel = (time) => {\n          return that.localeDateTimeFormatter(time)\n        }\n        viewer.timeline.zoomTo(viewer.clock.startTime, viewer.clock.stopTime)\n      }\n      this.viewerContainer = viewer._element\n      if (Cesium.defined(Cesium.SuperMapImageryProvider) && !this.logo) {\n        const credit = viewer.scene.frameState.creditDisplay\n        credit.container.removeChild(credit._imageContainer)\n      }\n      if (!this.logo) {\n        viewer.cesiumWidget.creditContainer.style.display = 'none'\n      }\n      viewer.widgetResized = new Cesium.Event()\n      viewer.imageryLayers.layerAdded.addEventListener(this.layerAdded)\n      registerEvents(true)\n      // globalThis.XE\n      //   ? this.$emit('ready', { Cesium, viewer, earth: this.earth, vm: this })\n      //   : this.$emit('ready', { Cesium, viewer, vm: this })\n      const readyObj = {\n        Cesium,\n        viewer,\n        vm: this\n      }\n      if (globalThis.XE) {\n        Object.assign(readyObj, {\n          earth: this.earth\n        })\n      } else if (globalThis.mars3d) {\n        Object.assign(readyObj, {\n          map: this.map\n        })\n      } else if (globalThis.DC) {\n        Object.assign(readyObj, {\n          dcViewer: this.dcViewer\n        })\n      }\n\n      const listenerReady = this.$listeners.ready\n      listenerReady && this.$emit('ready', readyObj)\n      this._mounted = true\n      return { Cesium, viewer, vm: this }\n    },\n    setCamera (val) {\n      const { viewer } = this\n      const position = val.position\n      if (position.lng && position.lat) {\n        viewer.camera.setView({\n          destination: Cesium.Cartesian3.fromDegrees(\n            position.lng,\n            position.lat,\n            position.height || 0,\n            viewer.scene.globe.ellipsoid\n          ),\n          orientation: {\n            heading: Cesium.Math.toRadians(val.heading || 360),\n            pitch: Cesium.Math.toRadians(val.pitch || -90),\n            roll: Cesium.Math.toRadians(val.roll || 0)\n          }\n        })\n      } else if (position.x && position.y && position.z) {\n        viewer.camera.setView({\n          destination: new Cesium.Cartesian3(position.x, position.y, position.z),\n          orientation: {\n            heading: val.heading || 2 * Math.PI,\n            pitch: val.pitch || -Math.PI / 2,\n            roll: val.roll || 0\n          }\n        })\n      }\n    },\n    layerAdded (layer) {\n      const { viewer, autoSortImageryLayers } = this\n      if (viewer.baseLayerPicker) {\n        viewer.imageryLayers.raiseToTop(layer)\n      }\n      // 维护影像图层顺序\n      if (autoSortImageryLayers) {\n        layer.sortOrder = Cesium.defined(layer.sortOrder) ? layer.sortOrder : 9999\n        viewer.imageryLayers._layers.sort((a, b) => a.sortOrder - b.sortOrder)\n        viewer.imageryLayers._update()\n      }\n    },\n    localeDateTimeFormatter (date, viewModel, ignoredate) {\n      const { JulianDate } = Cesium\n      let TZCode\n      if (this.UTCoffset) {\n        date = JulianDate.addMinutes(date, this.UTCoffset, new JulianDate())\n        const offset = new Date().getTimezoneOffset() - this.UTCOffset\n        TZCode = offset === 0 ? 'UTC' : 'UTC' + '+' + -(offset / 60)\n      } else {\n        TZCode = new Date().getTimezoneOffset() === 0 ? 'UTC' : 'UTC' + '+' + -(new Date().getTimezoneOffset() / 60)\n      }\n      const jsDate = JulianDate.toDate(date)\n      const timeString = jsDate\n        .toLocaleString(this.$vc.lang.isoName, {\n          hour: 'numeric',\n          minute: 'numeric',\n          second: 'numeric',\n          hour12: false\n        })\n        .replace(/,/g, '')\n      const dateString = jsDate\n        .toLocaleString(this.$vc.lang.isoName, {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric'\n        })\n        .replace(/,/g, '')\n\n      if (!ignoredate && (viewModel || jsDate.getHours() + jsDate.getMinutes() === 0)) {\n        return dateString\n      }\n\n      this.TZCode && (TZCode = this.TZCode)\n\n      return ignoredate ? `${timeString} ${TZCode}` : `${dateString} ${timeString} ${TZCode}`\n    },\n    localeTimeFormatter (time, viewModel) {\n      return this.localeDateTimeFormatter(time, viewModel, true)\n    },\n    registerEvents (flag) {\n      const { viewer } = this\n      bindEvents.call(this, viewer, undefined, flag)\n      const that = this\n      Events['viewer-property-events'].forEach((eventName) => {\n        const instance =\n          isArray(eventName.name) && viewer[eventName.name[0]]\n            ? viewer[eventName.name[0]][eventName.name[1]]\n            : viewer[eventName.name]\n        instance && bindEvents.call(that, instance, eventName.events, flag)\n      })\n      const handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas)\n      Events['viewer-mouse-events'].forEach((eventName) => {\n        const listener = that.$listeners[eventName] || that.$listeners[eventName.toLowerCase()]\n        if (flag) {\n          listener && handler.setInputAction(listener.fns, Cesium.ScreenSpaceEventType[eventName])\n        } else {\n          listener && handler.removeInputAction(Cesium.ScreenSpaceEventType[eventName])\n        }\n      })\n    },\n    getServices () {\n      const vm = this\n      return mergeDescriptors(\n        {},\n        {\n          get viewerContainer () {\n            return vm\n          },\n          get Cesium () {\n            return vm.Cesium\n          },\n          get viewer () {\n            return vm.viewer\n          },\n          get dataSources () {\n            return vm.dataSources\n          },\n          get entities () {\n            return vm.entities\n          },\n          get imageryLayers () {\n            return vm.imageryLayers\n          },\n          get primitives () {\n            return vm.primitives\n          },\n          get groundPrimitives () {\n            return vm.groundPrimitives\n          },\n          get postProcessStages () {\n            return vm.postProcessStages\n          }\n        }\n      )\n    },\n    async getCesiumScript () {\n      if (!globalThis.Cesium) {\n        let cesiumPath = this.cesiumPath\n          ? this.cesiumPath\n          : typeof this._Cesium !== 'undefined' && Object.prototype.hasOwnProperty.call(this._Cesium(), 'cesiumPath')\n            ? this._Cesium().cesiumPath\n            : 'https://cdn.jsdelivr.net/npm/cesium@latest/Build/Cesium/Cesium.js'\n\n        const dirName = dirname(cesiumPath)\n        if (!cesiumPath?.includes('.js')) {\n          // 认为是mars3d\n          if (cesiumPath?.lastIndexOf('/') !== cesiumPath.length - 1) {\n            cesiumPath += '/'\n          }\n          const libsConfig = getMars3dConfig(cesiumPath)\n          const include = this.$vc.cfg?.include || 'mars3d'\n          const arrInclude = include.split(',')\n          const keys = {}\n          for (let i = 0, len = arrInclude.length; i < len; i++) {\n            const key = arrInclude[i]\n            if (keys[key]) {\n              // 规避重复引入lib\n              continue\n            }\n            keys[key] = true\n            loadLibs.push(...libsConfig[key])\n          }\n        } else if (cesiumPath.includes('dc.base')) {\n          loadLibs.push(cesiumPath)\n          loadLibs.push(cesiumPath.replace('dc.base', 'dc.core'))\n          loadLibs.push(cesiumPath.replace('dc.base', 'dc.core').replace('.js', '.css'))\n        } else if (cesiumPath.includes('/XbsjEarth.js')) {\n          loadLibs.push(cesiumPath)\n        } else {\n          loadLibs.push(cesiumPath)\n          loadLibs.push(`${dirName}/Widgets/widgets.css`)\n        }\n\n        const secondaryLibs = loadLibs\n        if (!cesiumPath?.includes('.js')) {\n          // mars3d 必须要等 Cesium 先初始化\n          const primaryLib = loadLibs.find((v) => v.includes('Cesium.js'))\n          await loadScript(primaryLib)\n          secondaryLibs.splice(secondaryLibs.indexOf(primaryLib), 1)\n        }\n\n        const scriptLoadPromises = []\n        secondaryLibs.forEach((url) => {\n          // eslint-disable-next-line prefer-regex-literals\n          const cssExpr = new RegExp('\\\\.css')\n          if (cssExpr.test(url)) {\n            scriptLoadPromises.push(loadLink(url))\n          } else {\n            scriptLoadPromises.push(loadScript(url))\n          }\n        })\n\n        return Promise.all(scriptLoadPromises).then(() => {\n          if (globalThis.Cesium) {\n            const listener = this.$listeners.cesiumReady\n            listener && this.$emit('cesiumReady', globalThis.Cesium)\n            return globalThis.Cesium\n          } else if (globalThis.XE) {\n            // 兼容 cesiumlab earthsdk\n            return globalThis.XE.ready().then(() => {\n              // resolve(globalThis.Cesium)\n              const listener = this.$listeners.cesiumReady\n              listener && this.$emit('cesiumReady', globalThis.Cesium)\n              return globalThis.Cesium\n            })\n          } else if (globalThis.DC) {\n            // 兼容  dc-sdk\n            globalThis.DC.use(globalThis.DcCore.default)\n            globalThis.DC.baseUrl = `${dirName}/resources/`\n            globalThis.DC.ready(() => {\n              globalThis.Cesium = globalThis.DC.Namespace.Cesium\n\n              const listener = this.$listeners.cesiumReady\n              listener && this.$emit('cesiumReady', globalThis.DC)\n              return globalThis.Cesium\n            })\n            return globalThis.Cesium\n          } else {\n            this._reject(new Error('VueCesium ERROR: ' + 'Error loading CesiumJS!'))\n          }\n        })\n      } else {\n        return Promise.resolve(globalThis.Cesium)\n      }\n    },\n    async beforeInit () {\n      // Make sure to add only one CesiumJS script tag\n      // 保证只添加一个CesiumJS标签\n      this.$vc.scriptPromise = this.$vc.scriptPromise || this.getCesiumScript()\n      await this.$vc.scriptPromise\n    },\n    async beforeLoad () {\n      const listener = this.$listeners.beforeLoad\n      listener && this.$emit('beforeLoad', this)\n      // Make sure to add only one CesiumJS script tag\n      // 保证只添加一个CesiumJS标签\n      this.$vc.scriptPromise = this.$vc.scriptPromise || this.getCesiumScript()\n      await this.$vc.scriptPromise\n    },\n    async load () {\n      if (this._mounted) {\n        return false\n      }\n      await this.beforeLoad()\n      return this.init()\n    },\n    async reload () {\n      return this.unload().then(() => {\n        return this.load()\n      })\n    },\n    async unload () {\n      if (!this._mounted) {\n        return false\n      }\n\n      let unloadingResolve\n      this.$vc.viewerUnloadingPromise = new Promise((resolve, reject) => {\n        unloadingResolve = resolve\n      })\n\n      // If the component has subcomponents, you need to remove the subcomponents first. 如果该组件带有子组件，需要先移除子组件。\n      for (let i = 0; i < this.children.length; i++) {\n        const vcChildCmp = this.children[i]\n        await vcChildCmp.unload()\n      }\n\n      const { viewer, earth, map, dcViewer, removeCesiumScript, registerEvents } = this\n\n      if (globalThis.Cesium) {\n        viewer.imageryLayers.layerAdded.removeEventListener(this.layerAdded)\n        registerEvents(false)\n      }\n\n      this.$vc._screenSpaceEventHandler && this.$vc._screenSpaceEventHandler.destroy()\n      this.$vc._screenSpaceEventHandler = undefined\n\n      if (globalThis.XE) {\n        earth && earth.destroy()\n      } else if (globalThis.mars3d) {\n        map && map.destroy()\n      } else if (globalThis.DC) {\n        dcViewer && dcViewer.destroy()\n      } else {\n        viewer && viewer.destroy()\n      }\n\n      this.viewer = undefined\n      this._mounted = false\n\n      if (removeCesiumScript && globalThis.Cesium) {\n        const scripts = document.getElementsByTagName('script')\n        const removeScripts = []\n        for (const script of scripts) {\n          script.src.indexOf('/Cesium.js') > -1 && removeScripts.push(script)\n          script.src.indexOf('/Workers/zlib.min.js') > -1 && removeScripts.push(script)\n          if (globalThis.XE) {\n            script.src.indexOf('/rxjs.umd.min.js') > -1 && removeScripts.push(script)\n            script.src.indexOf('/XbsjCesium.js') > -1 && removeScripts.push(script)\n            script.src.indexOf('/viewerCesiumNavigationMixin.js') > -1 && removeScripts.push(script)\n            script.src.indexOf('/XbsjEarth.js') > -1 && removeScripts.push(script)\n          }\n\n          loadLibs.includes(script.src) && !removeScripts.includes(script) && removeScripts.push(script)\n        }\n\n        const links = document.getElementsByTagName('link')\n        for (const link of links) {\n          link.href.includes('Widgets/widgets.css') && !removeScripts.includes(link) && removeScripts.push(link)\n          loadLibs.includes(link.href) && !removeScripts.includes(link) && removeScripts.push(link)\n        }\n        removeScripts.forEach((script) => {\n          script.parentNode && script.parentNode.removeChild(script)\n        })\n        globalThis.Cesium && (globalThis.Cesium = undefined)\n        globalThis.XbsjCesium && (globalThis.XbsjCesium = undefined)\n        globalThis.XbsjEarth && (globalThis.XbsjEarth = undefined)\n        globalThis.XE && (globalThis.XE = undefined)\n        globalThis.mars3d && (globalThis.mars3d = undefined)\n        globalThis.DC && (globalThis.DC = undefined)\n        globalThis.DcCore && (globalThis.DcCore = undefined)\n        this.$vc.scriptPromise = undefined\n        loadLibs = []\n      }\n\n      const listener = this.$listeners.destroyed\n      listener && this.$emit('destroyed', this)\n      unloadingResolve(true)\n      this.$vc.viewerUnloadingPromise = undefined\n      return true\n    }\n  },\n  async mounted () {\n    try {\n      await this.$vc.viewerUnloadingPromise\n      this._resolve(this.load())\n    } catch (e) {\n      this._reject(e)\n    }\n  },\n  created () {\n    this.children = []\n    this._mounted = false\n    // this._createPromise = Promise.resolve(this.beforeInit())\n    // 注释上面方法，测试发现在切换路由时，实测 Vue 生命周期是先触发新组件的 created，再触发旧组件的 destroyed，再触发新组件的 mounted 。\n    // 逻辑就是先创建新的 然后销毁旧的，但虽然销毁的是旧的 还是会把新的给影响。\n    // 因此 viewer 组件的加载方式还是放 mounted，这样就先销毁旧的再加载新的。\n    // 但为了外部能取得 createPromise，_createPromise的初始化还是要放created中。\n    const that = this\n    this._createPromise = new Promise((resolve, reject) => {\n      that._resolve = resolve\n      that._reject = reject\n    })\n\n    Object.defineProperties(this, {\n      createPromise: {\n        enumerable: true,\n        get: () => this._createPromise\n      },\n      cesiumObject: {\n        enumerable: true,\n        get: () => this.viewer\n      },\n      dataSources: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.dataSources\n      },\n      entities: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.entities\n      },\n      imageryLayers: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.imageryLayers\n      },\n      primitives: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.scene.primitives\n      },\n      groundPrimitives: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.scene.groundPrimitives\n      },\n      postProcessStages: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.scene.postProcessStages\n      }\n    })\n  },\n  destroyed () {\n    this.unload()\n  }\n}\n\nconst loadScript = (src) => {\n  const $script = document.createElement('script')\n  $script.async = true\n  $script.src = src\n  document.body.appendChild($script)\n  return new Promise((resolve, reject) => {\n    $script.onload = () => {\n      resolve(true)\n    }\n  })\n}\n\nconst loadLink = (src) => {\n  const $link = document.createElement('link')\n  $link.rel = 'stylesheet'\n  $link.href = src\n  document.head.appendChild($link)\n  return new Promise((resolve, reject) => {\n    $link.onload = () => {\n      resolve(true)\n    }\n  })\n}\n","<template>\n  <div id=\"cesiumContainer\" ref=\"viewer\" style=\"width:100%; height:100%;\">\n    <slot></slot>\n  </div>\n</template>\n\n<script>\nimport bindEvents from '../../utils/bindEvent.js'\nimport { Events } from '../../utils/events'\nimport services from '../../mixins/services'\nimport mergeDescriptors from '../../utils/mergeDescriptors.js'\nimport { dirname, isArray } from '../../utils/util.js'\nimport { getMars3dConfig } from './loadUtil'\n\nlet loadLibs = []\n\nexport default {\n  name: 'vc-viewer',\n  mixins: [services],\n  props: {\n    cesiumPath: String,\n    animation: {\n      type: Boolean,\n      default: false\n    },\n    baseLayerPicker: {\n      type: Boolean,\n      default: false\n    },\n    fullscreenButton: {\n      type: Boolean,\n      default: false\n    },\n    vrButton: {\n      type: Boolean,\n      default: false\n    },\n    geocoder: {\n      type: [Boolean, Array],\n      default: false\n    },\n    homeButton: {\n      type: Boolean,\n      default: false\n    },\n    infoBox: {\n      type: Boolean,\n      default: true\n    },\n    sceneModePicker: {\n      type: Boolean,\n      default: false\n    },\n    selectionIndicator: {\n      type: Boolean,\n      default: true\n    },\n    timeline: {\n      type: Boolean,\n      default: false\n    },\n    navigationHelpButton: {\n      type: Boolean,\n      default: false\n    },\n\n    navigationInstructionsInitiallyVisible: {\n      type: Boolean,\n      default: false\n    },\n    scene3DOnly: {\n      type: Boolean,\n      default: false\n    },\n    shouldAnimate: {\n      type: Boolean,\n      default: false\n    },\n    clockViewModel: Object,\n    selectedImageryProviderViewModel: Object,\n    imageryProviderViewModels: Object,\n    selectedTerrainProviderViewModel: Object,\n    terrainProviderViewModels: Object,\n    imageryProvider: Object,\n    terrainProvider: Object,\n    skyBox: [Object, Boolean],\n    skyAtmosphere: [Object, Boolean],\n    fullscreenElement: {\n      type: [Element, String]\n    },\n    useDefaultRenderLoop: {\n      type: Boolean,\n      default: true\n    },\n    targetFrameRate: Number,\n    showRenderLoopErrors: {\n      type: Boolean,\n      default: true\n    },\n    automaticallyTrackDataSourceClocks: {\n      type: Boolean,\n      default: true\n    },\n    contextOptions: Object,\n    sceneMode: {\n      type: Number,\n      default: 3\n    },\n    mapProjection: Object,\n    globe: Object,\n    orderIndependentTranslucency: {\n      type: Boolean,\n      default: true\n    },\n    creditContainer: [Element, String],\n    creditViewport: [Element, String],\n    dataSources: Object,\n    terrainExaggeration: {\n      type: Number,\n      default: 1.0\n    },\n    shadows: {\n      type: Boolean,\n      default: false\n    },\n    terrainShadows: {\n      type: Number,\n      default: 3\n    },\n    mapMode2D: {\n      type: Number,\n      default: 1\n    },\n    projectionPicker: {\n      type: Boolean,\n      default: false\n    },\n    requestRenderMode: {\n      type: Boolean,\n      default: false\n    },\n    maximumRenderTimeChange: {\n      type: Number,\n      default: 0.0\n    },\n    logo: {\n      type: Boolean,\n      default: true\n    },\n    accessToken: String,\n    camera: {\n      type: Object,\n      default: function () {\n        return {\n          position: {\n            lng: 105,\n            lat: 29.999999999999993,\n            height: 19059568.497290563\n          },\n          heading: 360,\n          pitch: -90,\n          roll: 0\n        }\n      }\n    },\n    navigation: {\n      // for supermap\n      type: Boolean,\n      default: false\n    },\n    TZcode: {\n      type: String\n      // default: new Date().getTimezoneOffset() === 0 ? 'UTC' : 'UTC' + '+' + -(new Date().getTimezoneOffset() / 60)\n    },\n    UTCoffset: {\n      type: Number\n      // default: -new Date().getTimezoneOffset()\n    },\n    removeCesiumScript: {\n      type: Boolean,\n      default: true\n    },\n    autoSortImageryLayers: {\n      type: Boolean,\n      default: true\n    }\n  },\n  watch: {\n    selectionIndicator (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.selectionIndicator) && !viewer.selectionIndicator.isDestroyed() && !val) {\n        const selectionIndicatorContainer = viewer.selectionIndicator.container\n        viewerContainer.removeChild(selectionIndicatorContainer)\n        viewer.selectionIndicator.destroy()\n        viewer._selectionIndicator = undefined\n      } else if (!Cesium.defined(viewer.selectionIndicator) || viewer.selectionIndicator.isDestroyed()) {\n        const selectionIndicatorContainer = document.createElement('div')\n        selectionIndicatorContainer.className = 'cesium-viewer-selectionIndicatorContainer'\n        viewerContainer.appendChild(selectionIndicatorContainer)\n        const selectionIndicator = new Cesium.SelectionIndicator(selectionIndicatorContainer, viewer.scene)\n        viewer._selectionIndicator = selectionIndicator\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    infoBox (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.infoBox) && !viewer.infoBox.isDestroyed() && !val) {\n        const infoBoxContainer = viewer.infoBox.container\n        viewerContainer.removeChild(infoBoxContainer)\n        viewer.infoBox.destroy()\n        viewer._infoBox = undefined\n      } else if (!Cesium.defined(viewer.infoBox) || viewer.infoBox.isDestroyed()) {\n        const infoBoxContainer = document.createElement('div')\n        infoBoxContainer.className = 'cesium-viewer-infoBoxContainer'\n        viewerContainer.appendChild(infoBoxContainer)\n        const infoBox = new Cesium.InfoBox(infoBoxContainer)\n        const infoBoxViewModel = infoBox.viewModel\n        viewer._eventHelper.add(infoBoxViewModel.cameraClicked, viewer._onInfoBoxCameraClicked, viewer)\n        viewer._eventHelper.add(infoBoxViewModel.closeClicked, viewer._onInfoBoxClockClicked, viewer)\n        const events = ['cameraClicked', 'closeClicked']\n        infoBoxViewModel && bindEvents.call(this, infoBoxViewModel, events, true)\n        viewer._infoBox = infoBox\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    geocoder (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.geocoder) && !viewer.geocoder.isDestroyed() && !val) {\n        const geocoderContainer = viewer.geocoder.container\n        toolbar.removeChild(geocoderContainer)\n        viewer.geocoder.destroy()\n        viewer._geocoder = undefined\n      } else if (!Cesium.defined(viewer.geocoder) || viewer.geocoder.isDestroyed()) {\n        const geocoderContainer = document.createElement('div')\n        geocoderContainer.className = 'cesium-viewer-geocoderContainer'\n        toolbar.appendChild(geocoderContainer)\n        const geocoder = new Cesium.Geocoder({\n          container: geocoderContainer,\n          geocoderServices: Cesium.defined(this.geocoder)\n            ? Array.isArray(this.geocoder)\n                ? this.geocoder\n                : [this.geocoder]\n            : undefined,\n          scene: viewer.scene,\n          viewer: viewer\n        })\n        viewer._eventHelper.add(geocoder.viewModel.search.beforeExecute, viewer._clearObjects, viewer)\n        viewer._geocoder = geocoder\n        resizeToolbar(toolbar, geocoderContainer)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    homeButton (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.homeButton) && !viewer.homeButton.isDestroyed() && !val) {\n        viewer.homeButton.destroy()\n        viewer._homeButton = undefined\n      } else if (!Cesium.defined(viewer.homeButton) || viewer.homeButton.isDestroyed()) {\n        const homeButton = new Cesium.HomeButton(toolbar, viewer.scene)\n        if (Cesium.defined(viewer.geocoder)) {\n          viewer._eventHelper.add(homeButton.viewModel.command.afterExecute, function () {\n            const viewModel = viewer.geocoder.viewModel\n            viewModel.searchText = ''\n            if (viewModel.isSearchInProgress) {\n              viewModel.search()\n            }\n          })\n        }\n        viewer._eventHelper.add(homeButton.viewModel.command.beforeExecute, viewer._clearTrackedObject, viewer)\n        viewer._homeButton = homeButton\n        resizeToolbar(toolbar, homeButton)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    sceneModePicker (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.sceneModePicker) && !viewer.sceneModePicker.isDestroyed() && !val) {\n        viewer.sceneModePicker.destroy()\n        viewer._sceneModePicker = undefined\n      } else if (!Cesium.defined(viewer.sceneModePicker) || viewer.sceneModePicker.isDestroyed()) {\n        if (this.sceneModePicker === true && this.scene3DOnly) {\n          throw new Cesium.DeveloperError('options.sceneModePicker is not available when options.scene3DOnly is set to true.')\n        }\n        if (!this.scene3DOnly && this.sceneModePicker === true) {\n          const sceneModePicker = new Cesium.SceneModePicker(toolbar, viewer.scene)\n          viewer._sceneModePicker = sceneModePicker\n          resizeToolbar(toolbar, sceneModePicker)\n        }\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    projectionPicker (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.projectionPicker) && !viewer.projectionPicker.isDestroyed() && !val) {\n        viewer.projectionPicker.destroy()\n        viewer._projectionPicker = undefined\n      } else if (!Cesium.defined(viewer.projectionPicker) || viewer.projectionPicker.isDestroyed()) {\n        const projectionPicker = new Cesium.ProjectionPicker(toolbar, viewer.scene)\n        viewer._projectionPicker = projectionPicker\n        resizeToolbar(toolbar, projectionPicker)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    baseLayerPicker (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.baseLayerPicker) && !viewer.baseLayerPicker.isDestroyed() && !val) {\n        viewer.baseLayerPicker.destroy()\n        viewer._baseLayerPicker = undefined\n        viewer.imageryLayers.remove(viewer.imageryLayers.get(viewer.imageryLayers.length - 1))\n      } else if (!Cesium.defined(viewer.baseLayerPicker) || viewer.baseLayerPicker.isDestroyed()) {\n        const createBaseLayerPicker =\n          (!Cesium.defined(viewer.globe) || this.globe !== false) &&\n          (!Cesium.defined(viewer.baseLayerPicker) || this.baseLayerPicker !== false)\n\n        if (createBaseLayerPicker && Cesium.defined(this.imageryProvider)) {\n          throw new Cesium.DeveloperError(`options.imageryProvider is not available when using the BaseLayerPicker widget.\nEither specify options.selectedImageryProviderViewModel instead or set options.baseLayerPicker to false.`)\n        }\n        if (!createBaseLayerPicker && Cesium.defined(this.selectedImageryProviderViewModel)) {\n          throw new Cesium.DeveloperError(`options.selectedImageryProviderViewModel is not available when not using the BaseLayerPicker widget.\nEither specify options.imageryProvider instead or set options.baseLayerPicker to true.`)\n        }\n        if (createBaseLayerPicker && Cesium.defined(this.terrainProvider)) {\n          throw new Cesium.DeveloperError(`options.terrainProvider is not available when using the BaseLayerPicker widget.\nEither specify options.selectedTerrainProviderViewModel instead or set options.baseLayerPicker to false.`)\n        }\n        if (!createBaseLayerPicker && Cesium.defined(this.selectedTerrainProviderViewModel)) {\n          throw new Cesium.DeveloperError(`options.selectedTerrainProviderViewModel is not available when not using the BaseLayerPicker widget.\nEither specify options.terrainProvider instead or set options.baseLayerPicker to true.`)\n        }\n        if (createBaseLayerPicker) {\n          const imageryProviderViewModels = Cesium.defaultValue(\n            this.imageryProviderViewModels,\n            Cesium.createDefaultImageryProviderViewModels()\n          )\n          const terrainProviderViewModels = Cesium.defaultValue(\n            this.terrainProviderViewModels,\n            Cesium.createDefaultTerrainProviderViewModels()\n          )\n          const baseLayerPicker = new Cesium.BaseLayerPicker(toolbar, {\n            globe: viewer.scene.globe,\n            imageryProviderViewModels: imageryProviderViewModels,\n            selectedImageryProviderViewModel: imageryProviderViewModels[0],\n            terrainProviderViewModels: terrainProviderViewModels,\n            selectedTerrainProviderViewModel: terrainProviderViewModels[0]\n          })\n          const elements = toolbar.getElementsByClassName('cesium-baseLayerPicker-dropDown')\n\n          const baseLayerPickerDropDown = elements[0]\n          viewer._baseLayerPickerDropDown = baseLayerPickerDropDown\n          viewer._baseLayerPicker = baseLayerPicker\n          viewer.imageryLayers.raiseToTop(viewer.imageryLayers.get(0))\n          resizeToolbar(toolbar, baseLayerPicker)\n        }\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    navigationHelpButton (val) {\n      const { viewer, resizeToolbar } = this\n      const toolbar = viewer._toolbar\n      if (Cesium.defined(viewer.navigationHelpButton) && !viewer.navigationHelpButton.isDestroyed() && !val) {\n        viewer.navigationHelpButton.destroy()\n        viewer._navigationHelpButton = undefined\n      } else if (!Cesium.defined(viewer.navigationHelpButton) || viewer.navigationHelpButton.isDestroyed()) {\n        let showNavHelp = true\n        try {\n          if (Cesium.defined(window.localStorage)) {\n            const hasSeenNavHelp = window.localStorage.getItem('cesium-hasSeenNavHelp')\n            if (Cesium.defined(hasSeenNavHelp) && Boolean(hasSeenNavHelp)) {\n              showNavHelp = false\n            } else {\n              window.localStorage.setItem('cesium-hasSeenNavHelp', 'true')\n            }\n          }\n        } catch (e) {}\n        const navigationHelpButton = new Cesium.NavigationHelpButton({\n          container: toolbar,\n          instructionsInitiallyVisible: Cesium.defaultValue(this.navigationInstructionsInitiallyVisible, showNavHelp)\n        })\n        viewer._navigationHelpButton = navigationHelpButton\n        resizeToolbar(toolbar, navigationHelpButton)\n      }\n      viewer.widgetResized.raiseEvent()\n    },\n    animation (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.animation) && !viewer.animation.isDestroyed() && !val) {\n        const animationContainer = viewer.animation.container\n        viewerContainer.removeChild(animationContainer)\n        viewer.animation.destroy()\n        viewer._animation = undefined\n      } else if (!Cesium.defined(viewer.animation) || viewer.animation.isDestroyed()) {\n        const animationContainer = document.createElement('div')\n        animationContainer.className = 'cesium-viewer-animationContainer'\n        this.viewerContainer.appendChild(animationContainer)\n        const animation = new Cesium.Animation(animationContainer, new Cesium.AnimationViewModel(viewer.clockViewModel))\n        animation.viewModel.dateFormatter = this.localeDateTimeFormatter\n        animation.viewModel.timeFormatter = this.localeTimeFormatter\n        viewer._animation = animation\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n\n    timeline (val) {\n      const { viewer, viewerContainer, onTimelineScrubfunction } = this\n      if (Cesium.defined(viewer.timeline) && !viewer.timeline.isDestroyed() && !val) {\n        const timelineContainer = viewer.timeline.container\n        viewerContainer.removeChild(timelineContainer)\n        viewer.timeline.destroy()\n        viewer._timeline = undefined\n      } else if (!Cesium.defined(viewer.timeline) || viewer.timeline.isDestroyed()) {\n        const timelineContainer = document.createElement('div')\n        timelineContainer.className = 'cesium-viewer-timelineContainer'\n        viewerContainer.appendChild(timelineContainer)\n        const timeline = new Cesium.Timeline(timelineContainer, viewer.clock)\n        const that = this\n        timeline.makeLabel = (time) => {\n          return that.localeDateTimeFormatter(time)\n        }\n        timeline.addEventListener('settime', onTimelineScrubfunction, false)\n        timeline.zoomTo(viewer.clock.startTime, viewer.clock.stopTime)\n        viewer._timeline = timeline\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    fullscreenButton (val) {\n      const { viewer, viewerContainer } = this\n      if (Cesium.defined(viewer.fullscreenButton) && !viewer.fullscreenButton.isDestroyed() && !val) {\n        const fullscreenContainer = viewer.fullscreenButton.container\n        viewerContainer.removeChild(fullscreenContainer)\n        viewer.fullscreenButton.destroy()\n        viewer._fullscreenButton = undefined\n      } else if (!Cesium.defined(viewer.fullscreenButton) || viewer.fullscreenButton.isDestroyed()) {\n        const fullscreenContainer = document.createElement('div')\n        fullscreenContainer.className = 'cesium-viewer-fullscreenContainer'\n        viewerContainer.appendChild(fullscreenContainer)\n        const fullscreenButton = new Cesium.FullscreenButton(fullscreenContainer, this.$refs.viewer)\n        viewer._fullscreenButton = fullscreenButton\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    fullscreenElement (val) {\n      const { viewer } = this\n      if (!Cesium.defined(viewer.fullscreenButton)) {\n        return\n      }\n      if (Cesium.defined(val)) {\n        this.viewer.fullscreenButton.viewModel.fullscreenElement = val\n      }\n    },\n    vrButton (val) {\n      const { viewer, enableVRUI, viewerContainer } = this\n      if (Cesium.defined(viewer.vrButton) && !viewer.vrButton.isDestroyed() && !val) {\n        const vrContainer = viewer.vrButton.container\n        viewerContainer.removeChild(vrContainer)\n        viewer.vrButton.destroy()\n        viewer._vrButton = undefined\n      } else if (!Cesium.defined(viewer.vrButton) || viewer.vrButton.isDestroyed()) {\n        const vrContainer = document.createElement('div')\n        vrContainer.className = 'cesium-viewer-vrContainer'\n        viewerContainer.appendChild(vrContainer)\n        const vrButton = new Cesium.VRButton(vrContainer, viewer.scene, viewerContainer)\n        const viewModelCommand = vrButton.viewModel._command\n        vrButton.viewModel._command = function (VRButtonViewModel) {\n          viewModelCommand()\n          enableVRUI(viewer, VRButtonViewModel.isVRMode)\n        }\n        viewer._vrButton = vrButton\n      }\n      viewer.forceResize()\n      viewer.widgetResized.raiseEvent()\n    },\n    useDefaultRenderLoop (val) {\n      this.viewer.useDefaultRenderLoop = val\n    },\n    sceneMode (val) {\n      const { viewer } = this\n      if (\n        Cesium.SceneMode.COLUMBUS_VIEW === val ||\n        Cesium.SceneMode.MORPHING === val ||\n        Cesium.SceneMode.SCENE2D === val ||\n        Cesium.SceneMode.SCENE3D === val\n      ) {\n        viewer.scene.mode = val\n      }\n    },\n    shouldAnimate (val) {\n      const { viewer } = this\n      viewer.clock.shouldAnimate = val\n    },\n    terrainExaggeration (val) {\n      const { viewer } = this\n      viewer.scene._terrainExaggeration = val\n    },\n    shadows (val) {\n      const { viewer } = this\n      viewer.scene.shadowMap.enabled = val\n    },\n    terrainProvider (val) {\n      const { viewer } = this\n      viewer.terrainProvider = val\n    },\n    camera: {\n      handler (val) {\n        this.setCamera(val)\n      },\n      deep: true\n    },\n    imageryProvider (val, oldvalue) {\n      const { viewer } = this\n      if (Cesium.defined(val)) {\n        for (let i = 0; i < viewer.imageryLayers.length; i++) {\n          viewer.imageryLayers[i].imageryProvider === oldvalue && viewer.imageryLayers.remove(viewer.imageryLayers[i])\n        }\n        viewer.imageryLayers.addImageryProvider(val)\n      }\n    }\n  },\n  methods: {\n    onTimelineScrubfunction (e) {\n      const clock = e.clock\n      clock.currentTime = e.timeJulian\n      clock.shouldAnimate = false\n    },\n    resizeToolbar (parent, child) {\n      Array.prototype.slice.call(parent.children).forEach((element) => {\n        switch (element.className) {\n          case 'cesium-viewer-geocoderContainer':\n            element.customIndex = 1\n            break\n          case 'cesium-button cesium-toolbar-button cesium-home-button':\n            element.customIndex = 2\n            break\n          case 'cesium-sceneModePicker-wrapper cesium-toolbar-button':\n            element.customIndex = 3\n            break\n          case 'cesium-projectionPicker-wrapper cesium-toolbar-button':\n            element.customIndex = 4\n            break\n          case 'cesium-button cesium-toolbar-button':\n          case 'cesium-baseLayerPicker-dropDown':\n            element.customIndex = 5\n            break\n          case 'cesium-navigationHelpButton-wrapper':\n            element.customIndex = 6\n            break\n        }\n      })\n      const arr = []\n      Array.prototype.slice.call(parent.children).forEach((element) => {\n        arr.push(element)\n      })\n      arr.sort(function (a, b) {\n        return a.customIndex - b.customIndex\n      })\n      for (let i = 0; i < arr.length; i++) {\n        parent.appendChild(arr[i])\n      }\n    },\n    enableVRUI (viewer, enabled) {\n      const geocoder = viewer._geocoder\n      const homeButton = viewer._homeButton\n      const sceneModePicker = viewer._sceneModePicker\n      const projectionPicker = viewer._projectionPicker\n      const baseLayerPicker = viewer._baseLayerPicker\n      const animation = viewer._animation\n      const timeline = viewer._timeline\n      const fullscreenButton = viewer._fullscreenButton\n      const infoBox = viewer._infoBox\n      const selectionIndicator = viewer._selectionIndicator\n      const visibility = enabled ? 'hidden' : 'visible'\n      if (Cesium.defined(geocoder)) {\n        geocoder.container.style.visibility = visibility\n      }\n      if (Cesium.defined(homeButton)) {\n        homeButton.container.style.visibility = visibility\n      }\n      if (Cesium.defined(sceneModePicker)) {\n        sceneModePicker.container.style.visibility = visibility\n      }\n      if (Cesium.defined(projectionPicker)) {\n        projectionPicker.container.style.visibility = visibility\n      }\n      if (Cesium.defined(baseLayerPicker)) {\n        baseLayerPicker.container.style.visibility = visibility\n      }\n      if (Cesium.defined(animation)) {\n        animation.container.style.visibility = visibility\n      }\n      if (Cesium.defined(timeline)) {\n        timeline.container.style.visibility = visibility\n      }\n      if (Cesium.defined(fullscreenButton) && fullscreenButton.viewModel.isFullscreenEnabled) {\n        fullscreenButton.container.style.visibility = visibility\n      }\n      if (Cesium.defined(infoBox)) {\n        infoBox.container.style.visibility = visibility\n      }\n      if (Cesium.defined(selectionIndicator)) {\n        selectionIndicator.container.style.visibility = visibility\n      }\n      if (viewer._container) {\n        const right = enabled || !Cesium.defined(fullscreenButton) ? 0 : fullscreenButton.container.clientWidth\n        viewer._vrButton.container.style.right = right + 'px'\n        viewer.forceResize()\n      }\n    },\n    init () {\n      this.Cesium = Cesium\n      const $el = this.$refs.viewer\n      const accessToken = this.accessToken\n        ? this.accessToken\n        : typeof this._Cesium !== 'undefined' && Object.prototype.hasOwnProperty.call(this._Cesium(), 'accessToken')\n          ? this._Cesium().accessToken\n          : this.accessToken\n\n      Cesium.Ion.defaultAccessToken = accessToken\n      const {\n        animation,\n        baseLayerPicker,\n        fullscreenButton,\n        vrButton,\n        geocoder,\n        homeButton,\n        infoBox,\n        sceneModePicker,\n        selectionIndicator,\n        timeline,\n        navigationHelpButton,\n        navigationInstructionsInitiallyVisible,\n        scene3DOnly,\n        shouldAnimate,\n        clockViewModel,\n        selectedImageryProviderViewModel,\n        imageryProviderViewModels,\n        selectedTerrainProviderViewModel,\n        terrainProviderViewModels,\n        imageryProvider,\n        terrainProvider,\n        skyBox,\n        skyAtmosphere,\n        fullscreenElement,\n        useDefaultRenderLoop,\n        targetFrameRate,\n        showRenderLoopErrors,\n        automaticallyTrackDataSourceClocks,\n        contextOptions,\n        sceneMode,\n        mapProjection,\n        globe,\n        orderIndependentTranslucency,\n        creditContainer,\n        creditViewport,\n        dataSources,\n        terrainExaggeration,\n        shadows,\n        terrainShadows,\n        mapMode2D,\n        projectionPicker,\n        requestRenderMode,\n        maximumRenderTimeChange,\n        navigation,\n        registerEvents\n      } = this\n      const url = Cesium.buildModuleUrl('Assets/Textures/NaturalEarthII')\n      const options = {\n        animation,\n        baseLayerPicker,\n        fullscreenButton,\n        vrButton,\n        geocoder,\n        homeButton,\n        infoBox,\n        sceneModePicker,\n        selectionIndicator,\n        timeline,\n        navigationHelpButton,\n        navigationInstructionsInitiallyVisible,\n        scene3DOnly,\n        shouldAnimate,\n        clockViewModel,\n        selectedImageryProviderViewModel,\n        imageryProviderViewModels,\n        selectedTerrainProviderViewModel,\n        terrainProviderViewModels,\n        imageryProvider: this.isEmptyObj(imageryProvider)\n          ? Cesium.defined(Cesium.TileMapServiceImageryProvider)\n              ? new Cesium.TileMapServiceImageryProvider({\n                  url: url\n                })\n              : Cesium.createTileMapServiceImageryProvider({ url: url })\n          : imageryProvider,\n        terrainProvider,\n        skyBox,\n        skyAtmosphere,\n        fullscreenElement: this.isEmptyObj(fullscreenElement) ? $el : fullscreenElement,\n        useDefaultRenderLoop,\n        targetFrameRate,\n        showRenderLoopErrors,\n        automaticallyTrackDataSourceClocks,\n        contextOptions,\n        sceneMode,\n        mapProjection,\n        globe,\n        orderIndependentTranslucency,\n        creditContainer,\n        creditViewport,\n        dataSources,\n        terrainExaggeration,\n        shadows,\n        terrainShadows,\n        mapMode2D,\n        projectionPicker,\n        requestRenderMode,\n        maximumRenderTimeChange,\n        navigation\n      }\n      this.removeNullItem(options)\n\n      if (Cesium.VERSION >= '1.83') {\n        delete options.terrainExaggeration\n      }\n      let viewer = {}\n      if (globalThis.mars3d) {\n        this.map = new mars3d.Map($el.id, options)\n        viewer = this.map?._viewer\n      } else if (globalThis.DC) {\n        this.dcViewer = new DC.Viewer($el.id, options)\n        viewer = this.dcViewer?.delegate\n      } else if (globalThis.XE) {\n        this.earth = new globalThis.XE.Earth($el, options)\n        viewer = this.earth?.czm.viewer\n      } else {\n        viewer = new Cesium.Viewer($el, options)\n      }\n\n      this.viewer = viewer\n\n      if (Cesium.VERSION >= '1.83') {\n        viewer.scene.globe.terrainExaggeration = terrainExaggeration\n      }\n\n      if (Cesium.defined(this.camera)) {\n        this.setCamera(this.camera)\n      }\n\n      const that = this\n      const listener = that.$listeners['update:camera']\n      listener &&\n        viewer.camera.changed.addEventListener(() => {\n          const cartographic = viewer.camera.positionCartographic\n          let camera\n          if (that.camera.position.lng) {\n            camera = {\n              position: {\n                lng: Cesium.Math.toDegrees(cartographic.longitude),\n                lat: Cesium.Math.toDegrees(cartographic.latitude),\n                height: cartographic.height\n              },\n              heading: Cesium.Math.toDegrees(viewer.camera.heading || 360),\n              pitch: Cesium.Math.toDegrees(viewer.camera.pitch || -90),\n              roll: Cesium.Math.toDegrees(viewer.camera.roll || 0)\n            }\n          } else {\n            camera = {\n              position: {\n                x: viewer.camera.position.x,\n                y: viewer.camera.position.y,\n                z: viewer.camera.position.z\n              },\n              heading: viewer.camera.heading || 2 * Math.PI,\n              pitch: viewer.camera.pitch || -Math.PI / 2,\n              roll: viewer.camera.roll || 0\n            }\n          }\n\n          if (listener) {\n            that.$emit('update:camera', camera)\n          }\n        })\n      if (Cesium.defined(viewer.animation)) {\n        viewer.animation.viewModel.dateFormatter = this.localeDateTimeFormatter\n        viewer.animation.viewModel.timeFormatter = this.localeTimeFormatter\n      }\n      if (Cesium.defined(viewer.timeline)) {\n        viewer.timeline.makeLabel = (time) => {\n          return that.localeDateTimeFormatter(time)\n        }\n        viewer.timeline.zoomTo(viewer.clock.startTime, viewer.clock.stopTime)\n      }\n      this.viewerContainer = viewer._element\n      if (Cesium.defined(Cesium.SuperMapImageryProvider) && !this.logo) {\n        const credit = viewer.scene.frameState.creditDisplay\n        credit.container.removeChild(credit._imageContainer)\n      }\n      if (!this.logo) {\n        viewer.cesiumWidget.creditContainer.style.display = 'none'\n      }\n      viewer.widgetResized = new Cesium.Event()\n      viewer.imageryLayers.layerAdded.addEventListener(this.layerAdded)\n      registerEvents(true)\n      // globalThis.XE\n      //   ? this.$emit('ready', { Cesium, viewer, earth: this.earth, vm: this })\n      //   : this.$emit('ready', { Cesium, viewer, vm: this })\n      const readyObj = {\n        Cesium,\n        viewer,\n        vm: this\n      }\n      if (globalThis.XE) {\n        Object.assign(readyObj, {\n          earth: this.earth\n        })\n      } else if (globalThis.mars3d) {\n        Object.assign(readyObj, {\n          map: this.map\n        })\n      } else if (globalThis.DC) {\n        Object.assign(readyObj, {\n          dcViewer: this.dcViewer\n        })\n      }\n\n      const listenerReady = this.$listeners.ready\n      listenerReady && this.$emit('ready', readyObj)\n      this._mounted = true\n      return { Cesium, viewer, vm: this }\n    },\n    setCamera (val) {\n      const { viewer } = this\n      const position = val.position\n      if (position.lng && position.lat) {\n        viewer.camera.setView({\n          destination: Cesium.Cartesian3.fromDegrees(\n            position.lng,\n            position.lat,\n            position.height || 0,\n            viewer.scene.globe.ellipsoid\n          ),\n          orientation: {\n            heading: Cesium.Math.toRadians(val.heading || 360),\n            pitch: Cesium.Math.toRadians(val.pitch || -90),\n            roll: Cesium.Math.toRadians(val.roll || 0)\n          }\n        })\n      } else if (position.x && position.y && position.z) {\n        viewer.camera.setView({\n          destination: new Cesium.Cartesian3(position.x, position.y, position.z),\n          orientation: {\n            heading: val.heading || 2 * Math.PI,\n            pitch: val.pitch || -Math.PI / 2,\n            roll: val.roll || 0\n          }\n        })\n      }\n    },\n    layerAdded (layer) {\n      const { viewer, autoSortImageryLayers } = this\n      if (viewer.baseLayerPicker) {\n        viewer.imageryLayers.raiseToTop(layer)\n      }\n      // 维护影像图层顺序\n      if (autoSortImageryLayers) {\n        layer.sortOrder = Cesium.defined(layer.sortOrder) ? layer.sortOrder : 9999\n        viewer.imageryLayers._layers.sort((a, b) => a.sortOrder - b.sortOrder)\n        viewer.imageryLayers._update()\n      }\n    },\n    localeDateTimeFormatter (date, viewModel, ignoredate) {\n      const { JulianDate } = Cesium\n      let TZCode\n      if (this.UTCoffset) {\n        date = JulianDate.addMinutes(date, this.UTCoffset, new JulianDate())\n        const offset = new Date().getTimezoneOffset() - this.UTCOffset\n        TZCode = offset === 0 ? 'UTC' : 'UTC' + '+' + -(offset / 60)\n      } else {\n        TZCode = new Date().getTimezoneOffset() === 0 ? 'UTC' : 'UTC' + '+' + -(new Date().getTimezoneOffset() / 60)\n      }\n      const jsDate = JulianDate.toDate(date)\n      const timeString = jsDate\n        .toLocaleString(this.$vc.lang.isoName, {\n          hour: 'numeric',\n          minute: 'numeric',\n          second: 'numeric',\n          hour12: false\n        })\n        .replace(/,/g, '')\n      const dateString = jsDate\n        .toLocaleString(this.$vc.lang.isoName, {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric'\n        })\n        .replace(/,/g, '')\n\n      if (!ignoredate && (viewModel || jsDate.getHours() + jsDate.getMinutes() === 0)) {\n        return dateString\n      }\n\n      this.TZCode && (TZCode = this.TZCode)\n\n      return ignoredate ? `${timeString} ${TZCode}` : `${dateString} ${timeString} ${TZCode}`\n    },\n    localeTimeFormatter (time, viewModel) {\n      return this.localeDateTimeFormatter(time, viewModel, true)\n    },\n    registerEvents (flag) {\n      const { viewer } = this\n      bindEvents.call(this, viewer, undefined, flag)\n      const that = this\n      Events['viewer-property-events'].forEach((eventName) => {\n        const instance =\n          isArray(eventName.name) && viewer[eventName.name[0]]\n            ? viewer[eventName.name[0]][eventName.name[1]]\n            : viewer[eventName.name]\n        instance && bindEvents.call(that, instance, eventName.events, flag)\n      })\n      const handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas)\n      Events['viewer-mouse-events'].forEach((eventName) => {\n        const listener = that.$listeners[eventName] || that.$listeners[eventName.toLowerCase()]\n        if (flag) {\n          listener && handler.setInputAction(listener.fns, Cesium.ScreenSpaceEventType[eventName])\n        } else {\n          listener && handler.removeInputAction(Cesium.ScreenSpaceEventType[eventName])\n        }\n      })\n    },\n    getServices () {\n      const vm = this\n      return mergeDescriptors(\n        {},\n        {\n          get viewerContainer () {\n            return vm\n          },\n          get Cesium () {\n            return vm.Cesium\n          },\n          get viewer () {\n            return vm.viewer\n          },\n          get dataSources () {\n            return vm.dataSources\n          },\n          get entities () {\n            return vm.entities\n          },\n          get imageryLayers () {\n            return vm.imageryLayers\n          },\n          get primitives () {\n            return vm.primitives\n          },\n          get groundPrimitives () {\n            return vm.groundPrimitives\n          },\n          get postProcessStages () {\n            return vm.postProcessStages\n          }\n        }\n      )\n    },\n    async getCesiumScript () {\n      if (!globalThis.Cesium) {\n        let cesiumPath = this.cesiumPath\n          ? this.cesiumPath\n          : typeof this._Cesium !== 'undefined' && Object.prototype.hasOwnProperty.call(this._Cesium(), 'cesiumPath')\n            ? this._Cesium().cesiumPath\n            : 'https://cdn.jsdelivr.net/npm/cesium@latest/Build/Cesium/Cesium.js'\n\n        const dirName = dirname(cesiumPath)\n        if (!cesiumPath?.includes('.js')) {\n          // 认为是mars3d\n          if (cesiumPath?.lastIndexOf('/') !== cesiumPath.length - 1) {\n            cesiumPath += '/'\n          }\n          const libsConfig = getMars3dConfig(cesiumPath)\n          const include = this.$vc.cfg?.include || 'mars3d'\n          const arrInclude = include.split(',')\n          const keys = {}\n          for (let i = 0, len = arrInclude.length; i < len; i++) {\n            const key = arrInclude[i]\n            if (keys[key]) {\n              // 规避重复引入lib\n              continue\n            }\n            keys[key] = true\n            loadLibs.push(...libsConfig[key])\n          }\n        } else if (cesiumPath.includes('dc.base')) {\n          loadLibs.push(cesiumPath)\n          loadLibs.push(cesiumPath.replace('dc.base', 'dc.core'))\n          loadLibs.push(cesiumPath.replace('dc.base', 'dc.core').replace('.js', '.css'))\n        } else if (cesiumPath.includes('/XbsjEarth.js')) {\n          loadLibs.push(cesiumPath)\n        } else {\n          loadLibs.push(cesiumPath)\n          loadLibs.push(`${dirName}/Widgets/widgets.css`)\n        }\n\n        const secondaryLibs = loadLibs\n        if (!cesiumPath?.includes('.js')) {\n          // mars3d 必须要等 Cesium 先初始化\n          const primaryLib = loadLibs.find((v) => v.includes('Cesium.js'))\n          await loadScript(primaryLib)\n          secondaryLibs.splice(secondaryLibs.indexOf(primaryLib), 1)\n        }\n\n        const scriptLoadPromises = []\n        secondaryLibs.forEach((url) => {\n          // eslint-disable-next-line prefer-regex-literals\n          const cssExpr = new RegExp('\\\\.css')\n          if (cssExpr.test(url)) {\n            scriptLoadPromises.push(loadLink(url))\n          } else {\n            scriptLoadPromises.push(loadScript(url))\n          }\n        })\n\n        return Promise.all(scriptLoadPromises).then(() => {\n          if (globalThis.Cesium) {\n            const listener = this.$listeners.cesiumReady\n            listener && this.$emit('cesiumReady', globalThis.Cesium)\n            return globalThis.Cesium\n          } else if (globalThis.XE) {\n            // 兼容 cesiumlab earthsdk\n            return globalThis.XE.ready().then(() => {\n              // resolve(globalThis.Cesium)\n              const listener = this.$listeners.cesiumReady\n              listener && this.$emit('cesiumReady', globalThis.Cesium)\n              return globalThis.Cesium\n            })\n          } else if (globalThis.DC) {\n            // 兼容  dc-sdk\n            globalThis.DC.use(globalThis.DcCore.default)\n            globalThis.DC.baseUrl = `${dirName}/resources/`\n            globalThis.DC.ready(() => {\n              globalThis.Cesium = globalThis.DC.Namespace.Cesium\n\n              const listener = this.$listeners.cesiumReady\n              listener && this.$emit('cesiumReady', globalThis.DC)\n              return globalThis.Cesium\n            })\n            return globalThis.Cesium\n          } else {\n            this._reject(new Error('VueCesium ERROR: ' + 'Error loading CesiumJS!'))\n          }\n        })\n      } else {\n        return Promise.resolve(globalThis.Cesium)\n      }\n    },\n    async beforeInit () {\n      // Make sure to add only one CesiumJS script tag\n      // 保证只添加一个CesiumJS标签\n      this.$vc.scriptPromise = this.$vc.scriptPromise || this.getCesiumScript()\n      await this.$vc.scriptPromise\n    },\n    async beforeLoad () {\n      const listener = this.$listeners.beforeLoad\n      listener && this.$emit('beforeLoad', this)\n      // Make sure to add only one CesiumJS script tag\n      // 保证只添加一个CesiumJS标签\n      this.$vc.scriptPromise = this.$vc.scriptPromise || this.getCesiumScript()\n      await this.$vc.scriptPromise\n    },\n    async load () {\n      if (this._mounted) {\n        return false\n      }\n      await this.beforeLoad()\n      return this.init()\n    },\n    async reload () {\n      return this.unload().then(() => {\n        return this.load()\n      })\n    },\n    async unload () {\n      if (!this._mounted) {\n        return false\n      }\n\n      let unloadingResolve\n      this.$vc.viewerUnloadingPromise = new Promise((resolve, reject) => {\n        unloadingResolve = resolve\n      })\n\n      // If the component has subcomponents, you need to remove the subcomponents first. 如果该组件带有子组件，需要先移除子组件。\n      for (let i = 0; i < this.children.length; i++) {\n        const vcChildCmp = this.children[i]\n        await vcChildCmp.unload()\n      }\n\n      const { viewer, earth, map, dcViewer, removeCesiumScript, registerEvents } = this\n\n      if (globalThis.Cesium) {\n        viewer.imageryLayers.layerAdded.removeEventListener(this.layerAdded)\n        registerEvents(false)\n      }\n\n      this.$vc._screenSpaceEventHandler && this.$vc._screenSpaceEventHandler.destroy()\n      this.$vc._screenSpaceEventHandler = undefined\n\n      if (globalThis.XE) {\n        earth && earth.destroy()\n      } else if (globalThis.mars3d) {\n        map && map.destroy()\n      } else if (globalThis.DC) {\n        dcViewer && dcViewer.destroy()\n      } else {\n        viewer && viewer.destroy()\n      }\n\n      this.viewer = undefined\n      this._mounted = false\n\n      if (removeCesiumScript && globalThis.Cesium) {\n        const scripts = document.getElementsByTagName('script')\n        const removeScripts = []\n        for (const script of scripts) {\n          script.src.indexOf('/Cesium.js') > -1 && removeScripts.push(script)\n          script.src.indexOf('/Workers/zlib.min.js') > -1 && removeScripts.push(script)\n          if (globalThis.XE) {\n            script.src.indexOf('/rxjs.umd.min.js') > -1 && removeScripts.push(script)\n            script.src.indexOf('/XbsjCesium.js') > -1 && removeScripts.push(script)\n            script.src.indexOf('/viewerCesiumNavigationMixin.js') > -1 && removeScripts.push(script)\n            script.src.indexOf('/XbsjEarth.js') > -1 && removeScripts.push(script)\n          }\n\n          loadLibs.includes(script.src) && !removeScripts.includes(script) && removeScripts.push(script)\n        }\n\n        const links = document.getElementsByTagName('link')\n        for (const link of links) {\n          link.href.includes('Widgets/widgets.css') && !removeScripts.includes(link) && removeScripts.push(link)\n          loadLibs.includes(link.href) && !removeScripts.includes(link) && removeScripts.push(link)\n        }\n        removeScripts.forEach((script) => {\n          script.parentNode && script.parentNode.removeChild(script)\n        })\n        globalThis.Cesium && (globalThis.Cesium = undefined)\n        globalThis.XbsjCesium && (globalThis.XbsjCesium = undefined)\n        globalThis.XbsjEarth && (globalThis.XbsjEarth = undefined)\n        globalThis.XE && (globalThis.XE = undefined)\n        globalThis.mars3d && (globalThis.mars3d = undefined)\n        globalThis.DC && (globalThis.DC = undefined)\n        globalThis.DcCore && (globalThis.DcCore = undefined)\n        this.$vc.scriptPromise = undefined\n        loadLibs = []\n      }\n\n      const listener = this.$listeners.destroyed\n      listener && this.$emit('destroyed', this)\n      unloadingResolve(true)\n      this.$vc.viewerUnloadingPromise = undefined\n      return true\n    }\n  },\n  async mounted () {\n    try {\n      await this.$vc.viewerUnloadingPromise\n      this._resolve(this.load())\n    } catch (e) {\n      this._reject(e)\n    }\n  },\n  created () {\n    this.children = []\n    this._mounted = false\n    // this._createPromise = Promise.resolve(this.beforeInit())\n    // 注释上面方法，测试发现在切换路由时，实测 Vue 生命周期是先触发新组件的 created，再触发旧组件的 destroyed，再触发新组件的 mounted 。\n    // 逻辑就是先创建新的 然后销毁旧的，但虽然销毁的是旧的 还是会把新的给影响。\n    // 因此 viewer 组件的加载方式还是放 mounted，这样就先销毁旧的再加载新的。\n    // 但为了外部能取得 createPromise，_createPromise的初始化还是要放created中。\n    const that = this\n    this._createPromise = new Promise((resolve, reject) => {\n      that._resolve = resolve\n      that._reject = reject\n    })\n\n    Object.defineProperties(this, {\n      createPromise: {\n        enumerable: true,\n        get: () => this._createPromise\n      },\n      cesiumObject: {\n        enumerable: true,\n        get: () => this.viewer\n      },\n      dataSources: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.dataSources\n      },\n      entities: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.entities\n      },\n      imageryLayers: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.imageryLayers\n      },\n      primitives: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.scene.primitives\n      },\n      groundPrimitives: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.scene.groundPrimitives\n      },\n      postProcessStages: {\n        enumerable: true,\n        get: () => this.viewer && this.viewer.scene.postProcessStages\n      }\n    })\n  },\n  destroyed () {\n    this.unload()\n  }\n}\n\nconst loadScript = (src) => {\n  const $script = document.createElement('script')\n  $script.async = true\n  $script.src = src\n  document.body.appendChild($script)\n  return new Promise((resolve, reject) => {\n    $script.onload = () => {\n      resolve(true)\n    }\n  })\n}\n\nconst loadLink = (src) => {\n  const $link = document.createElement('link')\n  $link.rel = 'stylesheet'\n  $link.href = src\n  document.head.appendChild($link)\n  return new Promise((resolve, reject) => {\n    $link.onload = () => {\n      resolve(true)\n    }\n  })\n}\n</script>\n","import Viewer from './Viewer.vue'\nimport lang from '../../exts/lang'\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  const $vc = {\n    VERSION: 'C_PKG_VERSION'\n  }\n  Vue.prototype.$vc = Vue.prototype.$vc || $vc\n  if (!Vue.prototype.$vc.lang) {\n    lang.install($vc, options.lang)\n  }\n\n  plugin.installed = true\n  Vue.prototype._Cesium = () => options\n  Vue.component(Viewer.name, Viewer)\n}\n\nexport default plugin\n\nexport {\n  Viewer,\n  plugin as install\n}\n"],"names":["getMars3dConfig","libpath","libsConfig","haoutil","turf","mars3d","loadLibs","name","mixins","services","props","cesiumPath","String","animation","type","Boolean","default","baseLayerPicker","fullscreenButton","vrButton","geocoder","Array","homeButton","infoBox","sceneModePicker","selectionIndicator","timeline","navigationHelpButton","navigationInstructionsInitiallyVisible","scene3DOnly","shouldAnimate","clockViewModel","Object","selectedImageryProviderViewModel","imageryProviderViewModels","selectedTerrainProviderViewModel","terrainProviderViewModels","imageryProvider","terrainProvider","skyBox","skyAtmosphere","fullscreenElement","Element","useDefaultRenderLoop","targetFrameRate","Number","showRenderLoopErrors","automaticallyTrackDataSourceClocks","contextOptions","sceneMode","mapProjection","globe","orderIndependentTranslucency","creditContainer","creditViewport","dataSources","terrainExaggeration","shadows","terrainShadows","mapMode2D","projectionPicker","requestRenderMode","maximumRenderTimeChange","logo","accessToken","camera","position","lng","lat","height","heading","pitch","roll","navigation","TZcode","UTCoffset","removeCesiumScript","autoSortImageryLayers","watch","val","viewer","viewerContainer","Cesium","defined","isDestroyed","selectionIndicatorContainer","container","removeChild","destroy","_selectionIndicator","undefined","document","createElement","className","appendChild","SelectionIndicator","scene","widgetResized","raiseEvent","infoBoxContainer","_infoBox","InfoBox","infoBoxViewModel","viewModel","_eventHelper","add","cameraClicked","_onInfoBoxCameraClicked","closeClicked","_onInfoBoxClockClicked","events","bindEvents","call","forceResize","resizeToolbar","toolbar","_toolbar","geocoderContainer","_geocoder","Geocoder","geocoderServices","isArray","search","beforeExecute","_clearObjects","_homeButton","HomeButton","command","afterExecute","searchText","isSearchInProgress","_clearTrackedObject","_sceneModePicker","DeveloperError","SceneModePicker","_projectionPicker","ProjectionPicker","_baseLayerPicker","imageryLayers","remove","get","length","createBaseLayerPicker","defaultValue","createDefaultImageryProviderViewModels","createDefaultTerrainProviderViewModels","BaseLayerPicker","elements","getElementsByClassName","baseLayerPickerDropDown","_baseLayerPickerDropDown","raiseToTop","_navigationHelpButton","showNavHelp","window","localStorage","hasSeenNavHelp","getItem","setItem","e","NavigationHelpButton","instructionsInitiallyVisible","animationContainer","_animation","Animation","AnimationViewModel","dateFormatter","localeDateTimeFormatter","timeFormatter","localeTimeFormatter","onTimelineScrubfunction","timelineContainer","_timeline","Timeline","clock","that","makeLabel","time","addEventListener","zoomTo","startTime","stopTime","fullscreenContainer","_fullscreenButton","FullscreenButton","$refs","enableVRUI","vrContainer","_vrButton","VRButton","viewModelCommand","_command","VRButtonViewModel","isVRMode","SceneMode","COLUMBUS_VIEW","MORPHING","SCENE2D","SCENE3D","mode","_terrainExaggeration","shadowMap","enabled","handler","setCamera","deep","oldvalue","i","addImageryProvider","methods","currentTime","timeJulian","parent","child","prototype","slice","children","forEach","element","customIndex","arr","push","sort","a","b","visibility","style","isFullscreenEnabled","_container","right","clientWidth","init","$el","_Cesium","hasOwnProperty","Ion","defaultAccessToken","registerEvents","url","buildModuleUrl","options","isEmptyObj","TileMapServiceImageryProvider","createTileMapServiceImageryProvider","removeNullItem","VERSION","globalThis","map","Map","id","_viewer","DC","dcViewer","Viewer","delegate","XE","earth","Earth","czm","listener","$listeners","changed","cartographic","positionCartographic","Math","toDegrees","longitude","latitude","x","y","z","PI","$emit","_element","SuperMapImageryProvider","credit","frameState","creditDisplay","_imageContainer","cesiumWidget","display","Event","layerAdded","readyObj","vm","listenerReady","ready","_mounted","setView","destination","Cartesian3","fromDegrees","ellipsoid","orientation","toRadians","layer","sortOrder","_layers","_update","date","ignoredate","JulianDate","TZCode","addMinutes","offset","Date","getTimezoneOffset","UTCOffset","jsDate","toDate","timeString","toLocaleString","$vc","lang","isoName","hour","minute","second","hour12","replace","dateString","year","month","day","getHours","getMinutes","flag","Events","eventName","instance","ScreenSpaceEventHandler","canvas","toLowerCase","setInputAction","fns","ScreenSpaceEventType","removeInputAction","getServices","mergeDescriptors","entities","primitives","groundPrimitives","postProcessStages","getCesiumScript","dirName","dirname","includes","lastIndexOf","include","cfg","arrInclude","split","keys","len","key","secondaryLibs","primaryLib","find","v","loadScript","splice","indexOf","scriptLoadPromises","cssExpr","RegExp","test","loadLink","all","then","cesiumReady","use","DcCore","baseUrl","Namespace","_reject","Error","resolve","beforeInit","scriptPromise","beforeLoad","load","reload","unload","viewerUnloadingPromise","reject","unloadingResolve","vcChildCmp","removeEventListener","_screenSpaceEventHandler","scripts","getElementsByTagName","removeScripts","script","src","links","link","href","parentNode","XbsjCesium","XbsjEarth","destroyed","mounted","_resolve","created","_createPromise","defineProperties","createPromise","enumerable","cesiumObject","$script","async","body","onload","$link","rel","head","plugin","Vue","installed","install","component"],"mappings":"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"}